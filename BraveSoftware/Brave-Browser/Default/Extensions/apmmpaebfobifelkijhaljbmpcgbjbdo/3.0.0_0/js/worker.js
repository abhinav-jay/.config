(()=>{const e={__proto__:null},NOP=()=>{};let s;navigator.serviceWorker;let t,r=0;function onMessageError({data:e,source:s}){console.warn("Non-cloneable data",e),s.postMessage(JSON.stringify(e))}const n=[],importScriptsOnce=(...e)=>{(e=e.map(e=>!n.includes(e=`/js/${e}`)&&e).filter(Boolean)).length&&(n.push(...e),importScripts(...e))};Object.assign(e,{compileUsercss:[()=>compileUsercss,"usercss-compiler.js"],nullifyInvalidVars:[()=>metaParser.nullifyInvalidVars,"meta-parser.js"],parseMozFormat:[()=>extractSections,"moz-parser.js","parserlib.js"],parseUsercssMeta:[()=>metaParser.parse,"meta-parser.js"]});for(const s in e)if(Array.isArray(e[s])){const[t,...r]=e[s];e[s]=function(){return importScriptsOnce(...r),(e[s]=t()).apply(this,arguments)}}let o=null;Object.assign(e,{csslint:async(e,s)=>(importScriptsOnce("parserlib.js","csslint.js"),CSSLint.verify(e,s).messages.map(e=>Object.assign(e,{rule:{id:e.rule.id}}))),getCssPropsValues(){importScriptsOnce("parserlib.js");const{css:{GlobalKeywords:e,NamedColors:s,Parser:{AT:t},Properties:r},util:{describeProp:n}}=parserlib,o="<color>",l=RegExp(`${o}|${n(o).replace(/[()|]/g,"\\$&")}|~~~`,"g"),c=/(?:<.+?>|[^-\w<(]+\d*)+/g,i={},cmp=(e,s)=>"-"===e[0]&&"-"!==s[0]?1:e<s?-1:e>s;for(const[e,s]of Object.entries(r))if(-1!==s&&(i[e]=!1),"string"==typeof s){let t="";const r=[],a=s.replace(l,"~~~"),u=n(a),p=u.replace(l,""),g=p.replace(/([-\w]+\().*?\)/g,"z-$1").split(c).sort(cmp);for(let e of g)e.startsWith("z-")&&(e=e.slice(2)),e!==t&&r.push(t=e);u===p&&s===a||r.push(o),r.length&&(i[e]=r)}return{all:i,ats:[...Object.keys(t),"starting-style"].map(e=>`@${"document"===e?"-moz-":""}${e}`).sort(),colors:s,global:e}},getRules:e=>l[e](),metalint(e){importScriptsOnce("meta-parser.js");const s=metaParser.lint(e);return s.errors=s.errors.map(e=>({code:e.code,args:e.args,message:e.message,index:e.index})),s},async stylelint(e){importScriptsOnce("stylelint.js"),stylelint.SugarSSParser.prototype.checkSemicolon=ovrCheckSemicolon;for(const s in e.config.rules)stylelint.rules[s]||delete e.config.rules[s];for(let s=2;--s>=0;){"stylus"===e.mode&&(null==o&&(o=!e.code.includes("{")),e.config.customSyntax=o?"sugarss":"");const t=(await stylelint.lint(e)).results[0],r=t.parseErrors.concat(t.warnings);if(!(o&&s&&r[0]&&"Unnecessary curly bracket (CssSyntaxError)"===r[0].text))return collectStylelintResults(r,e);o=!o}}});const l={csslint:()=>(importScriptsOnce("csslint.js"),CSSLint.getRuleList().map(e=>{const s={};for(const[t,r]of Object.entries(e))"function"!=typeof r&&(s[t]=r);return s})),stylelint(){importScriptsOnce("stylelint.js");const e={},s=/\bpossible:("[^"]*?"|\[[^\]]*?]|\{[^}]*?})/g,t=/"([-\w\s]{3,}?)"/g;for(const[r,n]of Object.entries(stylelint.rules)){const o=`${n()}`,l=[];let c,i;for(;c=s.exec(o);){const e=c[1],s=[];for(;i=t.exec(e);){const e=i[1];e.includes(" ")?s.push(...e.split(/\s+/)):s.push(e)}e.includes("ignoreAtRules")&&s.push("ignoreAtRules"),e.includes("ignoreShorthands")&&s.push("ignoreShorthands"),s.length&&l.push(s)}e[r]=l}return e}};function collectStylelintResults(e,{mode:s}){const t="text/x-less"===s,r=t||"stylus"===s,n=[];for(const s of e){const{rule:e}=s,o=s.text.replace(/^Unexpected\s+/,"").replace(` (${e})`,"");if(r&&o.includes('"//"')||t&&/^unknown at-rule "@[-\w]+:"/.test(o))continue;const{line:l,column:c}=s;n.push({from:{line:l-1,ch:c-1},to:{line:(s.endLine||l)-1,ch:(s.endColumn||c)-1},message:o[0].toUpperCase()+o.slice(1),severity:s.severity,rule:e})}return n}function ovrCheckSemicolon(e){for(;e.length&&";"===e[e.length-1][0];)e.pop()}self.onconnect=function(e){const{lock:n=location.pathname,id:o}=e.data||{},l=this,c=e.ports[0];async function onMessage(e){const s=e.data,{args:n,id:o}=s.id?s:JSON.parse(s);let i,a;r++,t&&(clearTimeout(t),t=0);try{i=("function"==typeof l?l:l[n.shift()]).apply(e,n),i instanceof Promise&&(i=await i)}catch(e){i=void 0,a=e,delete e.source}c.postMessage({id:o,res:i,err:a},e._transfer),--r||t||(t=setTimeout(close,3e5))}s||!n||o||(s=!0,navigator.locks.request(n,()=>new Promise(NOP))),c.onerror=console.error,c.onmessage=onMessage,c.onmessageerror=onMessageError,o&&onMessage(e)}.bind(e)})();