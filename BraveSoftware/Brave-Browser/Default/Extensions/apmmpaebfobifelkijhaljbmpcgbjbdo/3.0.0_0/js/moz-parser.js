(()=>{"use strict";var e={d:(t,s)=>{for(var o in s)e.o(s,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:s[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};e.d(t,{default:()=>extractSections});const s={url:"urls","url-prefix":"urlPrefixes",domain:"domains",regexp:"regexps"};function extractSections({code:e,styleId:t,fast:o=!0}){const r=/([^\\]|^)\\([^\\]|$)/,n=new parserlib.css.Parser({noValidation:!0,starHack:!0,topDocOnly:o}),c=[{code:"",start:0}],a=[],d=[];let i;n.addListener("startstylesheet",()=>{i=n.stream.source.string}),n.addListener("startdocument",e=>{const t=c[c.length-1];let o=i.slice(t.start,e.offset);const n=getLastComment(o),a={code:"",start:e.brace.offset+1};n.includes("AGENT_SHEET")||/==userstyle==/i.test(n)||(n&&(a.code=n+"\n",o=o.slice(0,-n.length)),o=o.match(/^\s*/)[0]+o.trim()),o.trim()&&(t.code=o,doAddSection(t),t.code="");for(const t of e.functions){const{name:e,expr:o}=t,n=s[e.toLowerCase()],c=o&&o.parts[0],{uri:d=(c&&"regexps"===n&&r.test(c.text)?c.text.slice(1,-1):c.string)}=t;(a[n]=a[n]||[]).push(d||"")}c.push(a)}),n.addListener("enddocument",e=>{const t=c.pop(),s=c[c.length-1];t.code+=i.slice(t.start,e.offset),s.start=e.offset+1,doAddSection(t)}),n.addListener("endstylesheet",()=>{const e=c[c.length-1];e.code+=i.slice(e.start),c.forEach(doAddSection)}),n.addListener("error",e=>{a.push(e);const t=e.offset,s=Math.max(i.lastIndexOf("\n",t-5)+1,t-100),o=Math.min(i.indexOf("\n",t-s>5?t:t+5)+1||1e9,t+100);e.context=i.slice(s,o).trim()});try{n.parse(e,{reuseCache:!extractSections.lastStyleId||t===extractSections.lastStyleId})}catch(e){a.push(e)}for(const e of a){for(const[t,s]of Object.entries(e))"object"==typeof s&&delete e[t];e.message=`${e.line}:${e.col} ${e.message}`}return extractSections.lastStyleId=t,{sections:d,errors:a};function doAddSection(e){e.code=e.code.trim(),(e.code||e.urls||e.urlPrefixes||e.domains||e.regexps)&&"@namespace url(http://www.w3.org/1999/xhtml);"!==e.code&&d.push(Object.assign({},e))}function getLastComment(e){let t,s=e.length;for(;s&&(t=e.lastIndexOf("*/",s-2),!(t<0))&&!e.substring(t+2,s).trim();){const o=e.lastIndexOf("*/",t-2);s=e.indexOf("/*",o<0?0:o+2)}return s?e.slice(s):e}}self.extractSections=t.default})();