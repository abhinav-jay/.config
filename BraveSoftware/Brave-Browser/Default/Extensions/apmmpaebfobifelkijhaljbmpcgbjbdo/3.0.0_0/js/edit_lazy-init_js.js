{const t=this;(self.webpackChunkStylus=self.webpackChunkStylus||[]).push([["edit_lazy-init_js"],{7281:(e,s,a)=>{var o=a(2691),n=a(9521),i=a(922),r=a.n(i),c=a(6201),l=a(9250),u=a(6100);const d="uso-variable",f="variable-3 "+d,p="error "+d,h=/^(prop(erty)?|variable-2|string-2)\b/,m=/(^|[^-.\w\u0080-\uFFFF])var\(/iuy,y=/([-\w]*\s*:\s?)?/uy,g=(0,n.tryRegExp)("(?<=a)")?"(?<![-\\w]|#[0-9a-f]*)":"",w=r().mimeModes["text/css"],b=addSuffix(w.documentTypes,"("),{tokenHooks:k}=w,S=k["/"],x=r().hint.css||(()=>{});let P,A,C,v;const W="autocompleteOnTyping",O="editor."+W,T=o.get(O);async function helper(t){const e=t.getCursor(),{line:s,ch:a}=e,{styles:o,text:i}=t.getLineHandle(s),{style:c,index:u}=t.getStyleAtPos({styles:o,pos:a})||{},d="less"===t.doc.mode.helperType,f="stylus"===t.doc.mode.name,p=c&&c.split(" ",1)[0]||"prop?";if(!p||"comment"===p||"string"===p)return x(t);let w,k,S,W=u;for(;(null==w||`${o[W-1]}`.startsWith(p))&&(w=W>2?o[W-2]:0)&&isSameToken(i,c,w);)W-=2;if("#"===i[w]&&testAt(/[0-9a-f]+\b|$|\s/iy,w+1,i))return;for(W=u;(null==k||`${o[W+1]}`.startsWith(p))&&(k=o[W])&&isSameToken(i,c,k);)W+=2;const getTokenState=()=>S||(S=t.getTokenAt(e,!0),S=S.type?S.state.state:p),O=i.slice(w,k),T=i.slice(w,a).trim();let D,I=T.toLowerCase();switch(I[0]){case"!":D="!important".startsWith(I)?["!important"]:[];break;case"@":D=P||(await initCssProps(),P),d&&(D=findAllCssVars(t,T,"\\s*:").concat(D));break;case".":case"#":break;case"-":case"(":D=O.startsWith("--")||testAt(m,a-5,i)?findAllCssVars(t,T):[],O.startsWith("(")?(w++,I=T.slice(1)):I=T;break;case"/":O.startsWith("/*[[")&&O.endsWith("]]*/")&&(w+=4,k-=4,k-="-rgb"===i.slice(k-4,k)?4:0,D=Object.keys(l.default.style.usercssData?.vars||{}).sort(),I=T.slice(4));break;case"u":case"d":case"r":if(/^(variable|tag|error)/.test(p)&&b.some(t=>t.startsWith(I))&&/^(top|documentTypes|atBlock)/.test(getTokenState())){k++,D=b;break}default:{let t;if(f||/prop/.test(getTokenState())){for(;W>0&&!h.test(o[W+1]);)W-=2;const e=o[W];if(e>i.lastIndexOf(";",a-1)){for(;W>0&&h.test(o[W+1]);)W-=2;t=(W<2||o[W]<a)&&i.slice(o[W]||0,e).toLowerCase().match(/([-\w]+)?$/u)[1]}}t&&(/[^-\w]/.test(I)&&(w+=execAt(/[\s:()]*/y,w,i)[0].length,I=I.replace(/^[^\w\s]\s*/,"")),t.startsWith("--")?t="color":I&&t.startsWith(I)&&(t="")),t&&(C||await initCssProps(),t=v.all[t],D=[...new Set([...t||[],...v.global])],k=w+execAt(/(\s*[-a-z(]+)?/iy,w,i)[0].length),!D&&/^(prop(erty|\?)|atom|error|tag)/.test(p)&&/^(block|atBlock_parens|maybeprop)/.test(getTokenState())&&(C||await initCssProps(),"prop?"===p&&(w+=I.length,I=""),D="atBlock_parens"===S?A:C,k-=/[^-\w]$/u.test(O),k+=execAt(y,k,i)[0].length)}}if(!D){const e=f?r().hint.fromList(t,{words:r().hintWords.stylus}):x(t),s=RegExp(g+(I?(0,n.stringAsRegExpStr)(I):"[a-z]")+"[-a-z]+","gi"),a=r().hint.anyword(t,{word:s}).list;D=e?[...new Set(e.list.concat(a))]:a,D.sort()}return D&&{list:/^(--|[#.\w])\S*\s*$|^@/.test(I)?D.filter(t=>t.toLowerCase().startsWith(I)):D,from:{line:s,ch:w+O.match(/^\s*/)[0].length},to:{line:s,ch:k}}}async function initCssProps(){v=await u.worker.getCssPropsValues(),P=v.ats,C=addSuffix(v.all),A=[].concat(...Object.entries(w).map(getMediaKeys).filter(Boolean)).sort();for(const t of Object.values(v.all))t&&"<color>"===t[t.length-1]&&(t.pop(),t.push(...v.colors))}function addSuffix(t,e=": "){return Object.keys(t).sort().map(t=>t+e)}function getMediaKeys([t,e]){return"mediaFeatures"===t&&addSuffix(e)||t.startsWith("media")&&Object.keys(e)}function isSameToken(t,e,s){return!e||"/"!==t[s]&&"*"!==t[s+1]||!e.startsWith(f)&&!e.startsWith(p)}function findAllCssVars(t,e,s=""){const[,a,o]=e.match(/^(--|@)?(\S)?/),n=new RegExp("(?:^|[\\s/;{])("+(a?e:"--")+(o?"":"[a-zA-Z_-￿]")+"[-0-9a-zA-Z_-￿]*)"+s,"g"),i=new Set;return t.eachLine(({text:t})=>{for(let e;e=n.exec(t);)i.add(e[1])}),[...i].sort()}function execAt(t,e,s){return t.lastIndex=e,t.exec(s)}function testAt(t,e,s){return t.lastIndex=Math.max(0,e),t.test(s)}function autocompleteOnTyping(t,[e],s){const a=e.text[e.text.length-1];t.state.completionActive||e.origin&&!e.origin.includes("input")||!a||(t.state.autocompletePicked?t.state.autocompletePicked=!1:s?a.match(/[-a-z!]+$/i)&&(t.state.autocompletePicked=!1,t.options.hintOptions.completeSingle=!1,t.execCommand("autocomplete"),setTimeout(()=>{t.options.hintOptions.completeSingle=!0})):(0,n.debounce)(autocompleteOnTyping,100,t,[e],!0))}function autocompletePicked(t){t.state.autocompletePicked=!0}r().defineOption(W,T,(t,e)=>{t[e?"on":"off"]("changes",autocompleteOnTyping),t[e?"on":"off"]("pick",autocompletePicked)}),o.subscribe(O,(t,e)=>c.default.globalSetOption(W,e),T),r().registerHelper("hint","css",helper),r().registerHelper("hint","stylus",helper),k["/"]=function(t){const e=S.apply(this,arguments);if("comment"===e[1]){const{string:s,start:a,pos:o}=t;if(testAt(/\/\*\[\[/y,a,s)&&testAt(/]]\*\//y,o-4,s)){const t=l.default.style.usercssData?.vars;e[0]=t&&(0,n.hasOwn)(t,s.slice(a+4,o-4).replace(/-rgb$/,""))?f:p}}return e};var D=a(6001),I=a(6308),$=a(9204),H=a(7394);const makeId=()=>l.default.style.id||"new";let z,_;function connectPort(){_=chrome.runtime.connect({name:"draft:"+makeId()})}function updateDraft(t=l.default.dirty.isDirty()){t&&$.API.drafts.put({date:Date.now(),isUsercss:l.default.isUsercss,style:l.default.getValue(!0),si:l.default.makeScrollInfo()},makeId())}connectPort(),async function(){const t=await $.API.drafts.get(makeId());if(!t||t.isUsercss!==l.default.isUsercss||l.default.isSame(t.style))return;let e;const{style:s}=t,onYes=()=>e(!0),onNo=()=>e(!1),a=t.isUsercss?s.sourceCode:(0,H.styleToCss)(s),o=(0,I.t)("draftTitle",(0,I.formatRelativeDate)(t.date)),n=(0,u.showCodeMirrorPopup)(o,"",{value:a,readOnly:!0});n.className+=" danger",n.onClose.add(onNo),n._contents.append((0,D.$create)("p",(0,I.t)("draftAction")),(0,D.$create)(".buttons",[(0,I.t)("confirmYes"),(0,I.t)("confirmNo")].map((t,e)=>(0,D.$create)("button",{textContent:t,onclick:e?onNo:onYes})))),await new Promise(t=>e=t)?(s.id=l.default.style.id,await l.default.replaceStyle(s,t)):$.API.drafts.delete(makeId()).catch(()=>{}),u.helpPopup.close()}().then(()=>{l.default.dirty.onChange(t=>t?connectPort():_.disconnect()),l.default.dirty.onDataChange(t=>(0,n.debounce)(updateDraft,t?z:0)),o.subscribe("editor.autosaveDraft",(t,e)=>{z=(0,n.clamp)(1e3*e|0,1e3,2**32-1);const s=n.debounce.timers.get(updateDraft);s&&(0,n.debounce)(updateDraft,s.delay?z:0)},!0)}),t.on("beforeunload",t=>{let e;l.default.isWindowed&&"visible"===document.visibilityState&&o.get("openEditInWindow")&&-32e3!==screenX&&(screenX>0||outerWidth<screen.availWidth||screenY>0||outerHeight<screen.availHeight||screenX<=-10||outerWidth>=screen.availWidth+10||screenY<=-10||outerHeight>=screen.availHeight+10)&&(e={left:screenX,top:screenY,width:outerWidth,height:outerHeight},o.set("windowPosition",e)),n.sessionStore.windowPos=JSON.stringify(e||{}),$.API.data.set("editorScrollInfo"+l.default.style.id,l.default.makeScrollInfo());const s=document.activeElement;s&&(s.blur(),setTimeout(()=>s.focus())),l.default.dirty.isDirty()&&(t.returnValue=(0,I.t)("styleChangesNotSaved"))})}}])}