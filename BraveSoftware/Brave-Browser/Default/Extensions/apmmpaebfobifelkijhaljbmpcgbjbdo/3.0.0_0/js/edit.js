{const e=this;(self.webpackChunkStylus=self.webpackChunkStylus||[]).push([["edit","js_color_color-picker_css"],{6201:(t,o,n)=>{n.d(o,{default:()=>k});var i=n(6759),s=n(6100),r=n(4435),a=n(9250),l=n(2691);const c=new Set,d=i.CodeMirror.defaults,u={create(e,t){const o=(0,i.CodeMirror)(e,t);return o.display.lineDiv.on("mousewheel",plusMinusOnWheel.bind(o),!0),105!==r.CHROME&&o.display.wrapper.style.removeProperty("clip-path"),o.lastActive=0,c.add(o),o},destroy(e){c.delete(e)},globalSetOption(e,t){d[e]=t,c.size>4&&m.names.includes(e)?m.set(e,t):c.forEach(o=>o.setOption(e,t))}},onCmFocus=e=>{s.rerouteHotkeys.toggle(!1),e.display.wrapper.classList.add("CodeMirror-active"),e.lastActive=Date.now()},onCmBlur=e=>{setTimeout(()=>{s.rerouteHotkeys.toggle(!0);const{wrapper:t}=e.display;t.classList.toggle("CodeMirror-active",t.contains(document.activeElement))})};i.CodeMirror.defineInitHook(e=>{e.on("focus",onCmFocus),e.on("blur",onCmBlur)});const prefToCmOpt=e=>e.startsWith("editor.")&&e.slice(7),p=l.knownKeys.filter(e=>"editor.colorpicker"!==e&&"editor.arrowKeysTraverse"!==e&&prefToCmOpt(e)in i.CodeMirror.defaults),{insertTab:f,insertSoftTab:h}=i.CodeMirror.commands;l.ready.then(()=>{for(const e of p)d[prefToCmOpt(e)]=l.get(e);for(const[e,t]of Object.entries({"editor.tabSize"(e,t){e.setOption("indentUnit",Number(t))},"editor.indentWithTabs"(e,t){i.CodeMirror.commands.insertTab=t?f:h},"editor.matchHighlight"(e,t){const o="token"===t&&/[#.\-\w]/,n=(o||"selection"===t)&&{showToken:o,annotateScrollbar:!0,delay:0,onUpdate:updateMatchHighlightCount};e.setOption("highlightSelectionMatches",n||null)},"editor.selectByTokens"(e,t){e.setOption("configureMouse",t?configureMouseFn:null)}}))i.CodeMirror.defineOption(prefToCmOpt(e),l.get(e),t),p.push(e)}),l.subscribe(p,(e,t)=>{e===i.THEME_KEY&&(0,i.loadCmTheme)(t),u.globalSetOption(prefToCmOpt(e),t)});const m={names:["theme","lineWrapping"],set(e,t){const{observer:o,queue:n}=m;for(const i of c){let s=n.get(i);s||n.set(i,s={}),s[e]=t,o.observe(i.display.wrapper)}},setNow({cm:e,data:t}){e.operation(()=>t.forEach(t=>e.setOption(...t)))},onView(t){const{queue:o,observer:n}=m,i=[];for(const s of t){const t=s.intersectionRatio&&s.intersectionRect;if(!t)continue;const r=s.target.CodeMirror,a=Object.entries(o.get(r)||{});o.delete(r),n.unobserve(s.target),a.every(([e,t])=>r.getOption(e)===t)||(t.bottom>0&&t.top<e.innerHeight?m.setNow({cm:r,data:a}):i.push({cm:r,data:a}))}i.length&&setTimeout(()=>i.forEach(m.setNow))},get observer(){return m._observer||(m._observer=new IntersectionObserver(m.onView,{rootMargin:"150%"}),m.queue=new WeakMap),m._observer}};Object.assign(i.CodeMirror.commands,{commentSelection(e){e.blockComment(e.getCursor("from"),e.getCursor("to"),{fullLines:!1})},minus1:plusMinus.bind(null,-1),minus10:plusMinus.bind(null,-10),minus100:plusMinus.bind(null,-100),plus1:plusMinus.bind(null,1),plus10:plusMinus.bind(null,10),plus100:plusMinus.bind(null,100),toggleEditorFocus(e){e&&(e.hasFocus()?setTimeout(()=>e.display.input.blur()):e.focus())}});for(const e of["nextEditor","prevEditor","save","toggleStyle"])i.CodeMirror.commands[e]=(...t)=>a.default[e](...t);function plusMinus(e,t,o=t.getCursor()){const{line:n,ch:i}=o,{text:s}=t.getLineHandle(n);let r=/[-+\d.%a-z]/iy,a=r.lastIndex=i;r.test(s)||(a+=!a||(r.lastIndex=a-1,r.test(s))?-1:1);do{r.lastIndex=a}while(a>i-20&&(r.test(s)?--a>=0:(++a,0)));r=/[-+]?(\d*\.)?(\d+)/y,r.lastIndex=a,r=r.exec(s),r&&(r[0].includes(".")&&(e/=10),t.replaceRange((+r[0]+e).toFixed(r[1]?r[2].length:0),{line:n,ch:a},{line:n,ch:a+r[0].length},"*incdec"+n+":"+a))}function plusMinusOnWheel(e){e.altKey&&(e.preventDefault(),plusMinus((e.ctrlKey?100:e.shiftKey?10:1)*(e.wheelDeltaY>0?1:-1),this,this.coordsChar({left:e.clientX,top:e.clientY},"window")))}function updateMatchHighlightCount(e,t){e.display.wrapper.dataset.matchHighlightCount=t.matchesonscroll.matches.length}function configureMouseFn(e,t){return"double"===t?{unit:selectTokenOnDoubleclick}:{}}function selectTokenOnDoubleclick(e,t){let{ch:o}=t;const{line:n,sticky:i}=t,{text:s,styles:r}=e.getLineHandle(n),execAt=(e,t)=>(e.lastIndex=t,e.exec(s)),at=(e,t)=>(e.lastIndex=t,e.test(s)),atWord=e=>at(/\w/y,e),atSpace=e=>at(/\s/y,e),a=r.indexOf(o,1);o+=a<0||"before"===i&&atWord(o-1)||atSpace(o+1)?0:1,o=Math.min(s.length,o);const l=e.getTokenTypeAt({line:n,ch:o+("after"===i?1:0)});a>0&&o--;const c=l&&!/^(comment|string)/.test(l),d="number"===l,u=atSpace(o);let p,f,h=d?/[-+\w.%]/y:c?/[-\w@]/y:u?/\s/y:atWord(o)?/\w/y:/[^\w\s]/y,m=o;for(;m&&at(h,m);)m--;return m+=!m&&at(h,m)||c&&at(/[.!#@]/y,m)?0:at(h,m+1),d&&(p=m+execAt(/[+-]?[\d.]+(e\d+)?|$/iy,m)[0].length,f=p>=o,f||(m=p,o=m)),f||(h=c?/[-\w]*/y:new RegExp(h.source+"*","uy"),p=o+execAt(h,o)[0].length),{from:{line:n,ch:m},to:{line:n,ch:p}}}const g="sublimeBookmark",y="CodeMirror-linenumbers",b=Symbol("data"),v=i.CodeMirror.TextMarker.prototype,w={};for(const e of["clear","attachLine","detachLine"])w[e]=function(t){const{cm:o}=this.doc,n=!o.curOp;n&&o.startOperation(),v[e].apply(this,arguments),o.curOp.ownsGroup.delayedCallbacks.push(toggleMark.bind(this,this.lines[0],t)),n&&o.endOperation()};for(const e of["prevBookmark","nextBookmark"]){const t=i.CodeMirror.commands[e];i.CodeMirror.commands[e]=e=>{e.setSelection=e.jumpToPos,t(e),delete e.setSelection}}function onGutterClick(e,t,o,n){switch(o===y&&n.button){case 0:{const[o]=e.findMarks({line:t,ch:0},{line:t,ch:1e9},e=>e[g]);e.setCursor(o?o.find(-1):{line:t,ch:0}),e.execCommand("toggleBookmark");break}case 1:e.execCommand("selectBookmarks")}}function onGutterContextMenu(e,t,o,n){o===y&&(e.execCommand(n.ctrlKey?"prevBookmark":"nextBookmark"),n.preventDefault())}function onMarkAdded(e,t){t[g]&&(t.inclusiveRight=!0,Object.assign(t,w),toggleMark.call(t,!0,t[b]=t.lines[0]))}function toggleMark(e,t=this[b]){if(this.doc[e?"addLineClass":"removeLineClass"](t,"gutter","gutter-bookmark"),e){const e=this.doc.cm.state.sublimeBookmarks;e.includes(this)||e.push(this)}}i.CodeMirror.defineInitHook(e=>{e.on("gutterClick",onGutterClick),e.on("gutterContextMenu",onGutterContextMenu),e.on("markerAdded",onMarkAdded)});const k=u},9250:(t,o,n)=>{n.d(o,{default:()=>m,failRegexp:()=>failRegexp});var i=n(6001),s=n(6308),r=n(2691),a=n(9521);const l=function(){const e=new Map,t=new Set,o=new Set,notifyChange=n=>{const i=e.size>0,s=i!==n;s&&t.forEach(e=>e(i)),(s||i)&&o.forEach(e=>e(i))};return{add(t,o){const n=e.size>0,i=e.get(t);if(i){if("remove"!==i.type)return;i.savedValue===o?e.delete(t):(i.newValue=o,i.type="modify")}else e.set(t,{type:"add",newValue:o});notifyChange(n)},clear(t){e.size&&(t?e.delete(t):(e.clear(),1))&&notifyChange(!0)},has:t=>e.has(t),isDirty:()=>e.size>0,modify(t,o,n){const i=e.size>0,s=e.get(t);if(s)if("modify"===s.type)s.savedValue===n?e.delete(t):s.newValue=n;else{if("add"!==s.type)return;s.newValue=n}else{if(o===n)return;e.set(t,{type:"modify",savedValue:o,newValue:n})}notifyChange(i)},onChange(e,o=!0){t[o?"add":"delete"](e)},onDataChange(e,t=!0){o[t?"add":"delete"](e)},remove(t,o){const n=e.size>0,i=e.get(t);if(i)if("add"===i.type)e.delete(t);else{if("modify"!==i.type)return;i.type="remove"}else e.set(t,{type:"remove",savedValue:o});notifyChange(n)}}}(),c=matchMedia("(max-width: 850px)"),d=new Set,u=[];let p,f=!1;const h=self.editor={dirty:l,isUsercss:!1,isWindowed:!1,livePreviewLazy:e=>(0,a.debounce)(e,1e3*r.get("editor.livePreview.delay")),mqCompact:c,nameTarget:"name",ppDemo:{stylus:"https://stylus-lang.com/try.html",less:"https://lesscss.org/less-preview/"},regexps:d,saving:!1,scrollInfo:{},get style(){return p},set style(e){p=e},applyScrollInfo(e,t=h.scrollInfo.cms?.[0]){if(t&&t.sel){const o={sublimeBookmark:!0,clearWhenEmpty:!1},n=e.state.sublimeBookmarks=[];for(const i of t.bookmarks)n.push(e.markText(i.from,i.to,o));e.setSelections(...t.sel,{scroll:!1}),Object.assign(e.display.scroller,t.scroll),Object.assign(e.doc,t.scroll)}},cancel:()=>location.assign("/manage.html"),makeScrollInfo:()=>({scrollY:e.scrollY,cms:h.getEditors().map(e=>({bookmarks:(e.state.sublimeBookmarks||[]).map(e=>e.find()),focus:e.hasFocus(),height:e.display.wrapper.style.height.replace("100vh",""),parentHeight:e.display.wrapper.parentElement.offsetHeight,scroll:(0,a.mapObj)(e.doc,null,["scrollLeft","scrollTop"]),sel:[e.doc.sel.ranges,e.doc.sel.primIndex]}))}),async save(){l.isDirty()&&(h.saving=!0,await h.saveImpl())},toggleRegexp(e,t){let o;"regexp"===t?(e.on("input",validateRegexp),1===d.add(e).size&&(o=!1)):(e.setCustomValidity(""),e.off("input",validateRegexp),d.delete(e)&&!d.size&&(o=!0)),null!=o&&((0,i.$)("#testRE").hidden=o)},toggleStyle(e=!p.enabled){(0,i.$)("#enabled").checked=e,h.updateEnabledness(e)},updateClass(){i.$.rootCL.toggle("is-new-style",!h.style.id)},updateDirty(){const e=l.isDirty();f!==e&&(f=e,document.body.classList.toggle("dirty",e),(0,i.$)("#save-button").disabled=!e),h.updateTitle()},updateEnabledness(e){l.modify("enabled",p.enabled,e),p.enabled=e,h.updateLivePreview()},updateName(e){if(h){if(e){const{value:e}=(0,i.$)("#name");l.modify("name",p[h.nameTarget]||p.name,e),p[h.nameTarget]=e}h.updateTitle()}},updateTitle(e=h.dirty.isDirty()){const{customName:t,name:o}=h.style;document.title=`${e?"* ":""}${t||o||(0,s.t)("styleMissingName")} - Stylus`},updateToc(e){const{sections:t}=h;u.el||(u.el=(0,i.$)("#toc"),u.elDetails=u.el.closest("details"),u.title=(0,i.$)("#toc-title").dataset);let o=0;for(const e of t)o+=!e.removed;if((+u.title.num||1)!==o&&(o>1?u.title.num=o:delete u.title.num),!u.elDetails.open)return;e||(e=t);const n=t.indexOf(e[0]),r=u.el.children[n];if(n>=0&&(!e.focus||!r))for(let e=r,o=n;o<t.length;o++){const n=t[o].tocEntry;if(!(0,a.deepEqual)(n,u[o])){e||(e=u.el.appendChild((0,i.$create)("li",{tabIndex:0}))),e.tabIndex=n.removed?-1:0,u[o]=Object.assign({},n);const t=e.textContent=(0,a.clipString)(n.label)||(null==n.target?(0,s.t)("appliesToEverything"):(0,a.clipString)(n.target)+(n.numTargets>1?", ...":""));t.length>30&&(e.title=t)}e=e.nextElementSibling}for(;u.length>t.length;)u.el.lastElementChild.remove(),u.length--;if(e.focus){const e="current",t=(0,i.$)("."+e,u.el),o=r||u.el.children[n];t&&t!==o&&t.classList.remove(e),o.classList.add(e)}},useSavedStyle(e){p.id!==e.id&&history.replaceState({},"",`?id=${e.id}`),a.sessionStore.justEditedStyleId=e.id,Object.assign(p,e),h.updateClass(),h.updateMeta()}};function toggleCompact(e){i.$.rootCL.toggle("compact-layout",e.matches)}function failRegexp(e){try{new RegExp(e),e=""}catch(t){e=t.message.split("/:").pop().trim()}return e}function validateRegexp({target:e}){let t=failRegexp(e.value);t&&(t=(0,s.t)("styleBadRegexp")+"\n"+t),e.title!==t&&(e.title=t,e.setCustomValidity(t))}c.on("change",toggleCompact),toggleCompact(c);const m=h},1501:(t,o,n)=>{n(4404);var i=n(6001),s=n(6308),r=n(2691),a=n(922),l=n.n(a),c=n(9030),d=n(9250);function CompactHeader(){const{isUsercss:e}=d.default,t=(0,i.$create)({style:(0,c.important)("\n      top: 0;\n      height: 1px;\n      position: absolute;\n      visibility: hidden;\n    ")}),o=e?(0,i.$)(".CodeMirror-scroll"):document.body,n=new IntersectionObserver(function(t){const n=(0,i.$)("#header"),s=!t.pop().intersectionRatio;e||(o.style.paddingTop=s?n.offsetHeight+"px":""),n.classList.toggle("sticky",s)},{root:e?o:void 0}),s=(0,i.$)("h1 a");function onCompactToggled(e){for(const t of(0,i.$$)("details[data-pref]"))t.open=!e.matches&&(t.classList.contains("ignore-pref")?t.open:r.get(t.dataset.pref));e.matches?(n.observe(t),(0,i.$)("#basic-info-name").after(s)):(n.disconnect(),(0,i.$)("h1").append(s))}o.appendChild(t),onCompactToggled(d.default.mqCompact),d.default.mqCompact.on("change",onCompactToggled)}var u=n(6759),p=n(9521),f=n(6100);let h;async function beautify(e,t=!0){h||(h=(await n.e("vendor-overwrites_beautify_beautify-css-mod_js").then(n.bind(n,6281))).default);const o=r.get("editor.indentWithTabs"),i=Object.assign(r.defaults["editor.beautify"],r.get("editor.beautify"));i.indent_size=o?1:r.get("editor.tabSize"),i.indent_char=o?"\t":" ",t&&(t=createBeautifyUI(e,i));for(const o of e)setTimeout(beautifyEditor,0,o,i,t)}function beautifyEditor(t,o,n){const s=o.translate_positions=[].concat.apply([],t.doc.sel.ranges.map(e=>[Object.assign({},e.anchor),Object.assign({},e.head)])),r=t.getValue(),a=h(r,o);if(a!==r){t.beautifyChange&&t.beautifyChange[t.changeGeneration()]||(t.beautifyChange={}),t.setValue(a);const o=[];for(let e=0;e<s.length;e+=2)o.push({anchor:s[e],head:s[e+1]});const{scrollX:r,scrollY:l}=e;t.setSelections(o),e.scrollTo(r,l),t.beautifyChange[t.changeGeneration()]=!0,n&&((0,i.$)('button[role="close"]',n).disabled=!1)}}function createBeautifyUI(t,o){const n=f.helpPopup.show((0,s.t)("styleBeautify"),(0,i.$create)([(0,i.$create)(".beautify-options",[$createOption(".selector1,","selector_separator_newline"),$createOption(".selector2","newline_before_open_brace"),$createOption("{","newline_after_open_brace"),$createOption("border: none;","newline_between_properties",!0),$createOption("display: block;","newline_before_close_brace",!0),$createOption("}","newline_between_rules"),$createLabeledCheckbox("space_around_combinator","","selector + selector","selector+selector"),$createLabeledCheckbox("space_around_cmp","",'[attribute = "1"]','[attribute="1"]'),$createLabeledCheckbox("preserve_newlines","styleBeautifyPreserveNewlines"),$createLabeledCheckbox("indent_conditional","styleBeautifyIndentConditional"),d.default.isUsercss&&$createLabeledCheckbox("indent_mozdoc","","... @-moz-document")]),(0,i.$create)("p.beautify-hint",[(0,i.$create)("span",(0,s.t)("styleBeautifyHint")+" "),(0,f.createHotkeyInput)("editor.beautify.hotkey",{buttons:!1,onDone:()=>(0,c.moveFocus)(n,0)})]),(0,i.$create)(".buttons",[(0,i.$create)("button",{"attr:role":"close",onclick:f.helpPopup.close},(0,s.t)("confirmClose")),(0,i.$create)("button",{"attr:role":"undo",onclick(){let o=!1;for(const n of t){const t=n.beautifyChange;if(!t||!t[n.changeGeneration()])continue;delete t[n.changeGeneration()];const{scrollX:i,scrollY:s}=e;n.undo(),n.scrollIntoView(n.getCursor()),e.scrollTo(i,s),o|=t[n.changeGeneration()]}this.disabled=!o}},(0,s.t)(1===t.length?"undo":"undoGlobal"))])]),{className:"wide"});return(0,i.$)(".beautify-options").onchange=({target:e})=>{const n="checkbox"===e.type?e.checked:e.selectedIndex>0,i=e.closest("[newline]");i?i.setAttribute("newline",n):e._&&(e._.node.textContent=e._[n?"text":"textOff"]),o[e.dataset.option]=n,r.set("editor.beautify",Object.assign({},o,{translate_positions:void 0})),beautify(t,!1)},n;function $createOption(e,t,n){const s=o[t];return(0,i.$create)("div",{"attr:newline":s},[(0,i.$create)("span",n?{"attr:indent":""}:{},e),(0,i.$create)("div.select-wrapper",[(0,i.$create)("select",{"data-option":t},[(0,i.$create)("option",{selected:!s}," "),(0,i.$create)("option",{selected:s},"\\n")])])])}function $createLabeledCheckbox(e,t,n,r){const a=!1!==o[e],l=r&&document.createTextNode(a?n:r);return(0,i.$create)("label",{style:"display: block; clear: both;"},[(0,i.$create)("input",{type:"checkbox","data-option":e,_:r&&{node:l,text:n,textOff:r},checked:a}),t?(0,s.t)(t):l||n])}}function initBeautifyButton(e,t){e.onclick=e.oncontextmenu=e=>{e.preventDefault(),beautify(t||d.default.getEditors(),"click"===e.type)}}function EditorHeader(){initBeautifyButton((0,i.$)("#beautify")),initNameArea(),(0,c.setupLivePrefs)(),e.on("load",()=>{r.subscribe("editor.keyMap",showHotkeyInTooltip,!0),e.on("showHotkeyInTooltip",showHotkeyInTooltip)},{once:!0});for(const e of(0,i.$$)("#header details"))e.on("contextmenu",peekDetails)}function findKeyForCommand(e,t){"string"==typeof t&&(t=u.CodeMirror.keyMap[t]);let o=Object.keys(t).find(o=>t[o]===e);if(o)return o;for(const n of Array.isArray(t.fallthrough)?t.fallthrough:[t.fallthrough])if(o=n&&findKeyForCommand(e,n),o)return o;return""}function initNameArea(){const e=(0,i.$)("#name"),t=(0,i.$)("#reset-name"),o=d.default.style.updateUrl||d.default.isUsercss;d.default.nameTarget=o?"customName":"name",e.placeholder=(0,s.t)(d.default.isUsercss?"usercssEditorNamePlaceholder":"styleMissingName"),e.title=o?(0,s.t)("customNameHint"):"",e.on("input",()=>{d.default.updateName(!0),t.hidden=!d.default.style.customName}),t.hidden=!d.default.style.customName,t.onclick=()=>{(0,c.setInputValue)(e,d.default.style.name),d.default.style.customName=null,t.hidden=!0};const n=(0,i.$)("#enabled");n.onchange=()=>d.default.updateEnabledness(n.checked)}async function peekDetails(e){for(e.preventDefault(),this.open=!0;this.matches(":hover, :active");)await(0,p.sleep)(500),await new Promise(e=>this.on("mouseleave",e,{once:!0}));this.open=!1}function showHotkeyInTooltip(e,t=r.get("editor.keyMap")){for(const e of(0,i.$$)("[data-hotkey-tooltip]"))if(e._hotkeyTooltipKeyMap!==t){e._hotkeyTooltipKeyMap=t;const o=e._hotkeyTooltipTitle=e._hotkeyTooltipTitle||e.title,n=e.dataset.hotkeyTooltip,i="="===n[0]?n.slice(1):findKeyForCommand(n,t)||findKeyForCommand(n,u.extraKeys),s=o+(o&&i?"\n":"")+(i||"");e.title!==s&&(e.title=s)}}u.CodeMirror.commands.beautify=e=>{beautify(e.display.wrapper.parentElement.contains(document.activeElement)?[e]:d.default.getEditors(),!1)},r.subscribe("editor.beautify.hotkey",(e,t)=>{for(const[e,t]of Object.entries(u.extraKeys))if("beautify"===t){delete u.extraKeys[e];break}t&&(u.extraKeys[t]="beautify")},!0);var m=n(7868),g=n(7394);location.hash&&history.replaceState(history.state,"",location.href.split("#")[0]);const y=new URLSearchParams(location.search);let b=+y.get("id");const v=function({style:e=makeNewStyleObj(),isUC:t,si:o,template:n}){if(Object.assign(d.default,{style:e,template:n,isUsercss:t,scrollInfo:o||{}}),d.default.updateClass(),d.default.updateTitle(!1),i.$.rootCL.add(t?"usercss":"sectioned"),p.sessionStore.justEditedStyleId=b||"",null===b){y.delete("id");const e=`${y}`;history.replaceState({},"",location.pathname+(e?"?":"")+e)}(0,u.loadCmTheme)()}(r.clientData);function makeNewStyleObj(){b=null;const e=(0,p.tryURL)(y.get("url-prefix")),t=y.get("name")||e.hostname,o=e.pathname||"/";return{id:b,enabled:!0,name:t?t+("/"===o?"":(0,p.clipString)(o.replace(/\.(html?|aspx?|cgi|php)$/,""))):y.get("domain")||"?",sections:[g.toSection([...y],{code:""})]}}var w=n(9204),k=n(4523);async function handleExternalUpdate({style:t,reason:o}){if("editPreview"!==o&&"editPreviewEnd"!==o)if("editSave"===o&&d.default.saving)d.default.saving=!1;else{if("toggle"===o)return d.default.dirty.isDirty()?d.default.toggleStyle(t.enabled):(Object.assign(d.default.style,t),d.default.updateLivePreview()),void d.default.updateMeta();if(t=await w.API.styles.get(t.id),"config"===o){for(const e in d.default.style)e in t||delete d.default.style[e];delete t.sourceCode,delete t.sections,delete t.name,delete t.enabled,Object.assign(d.default.style,t),d.default.updateLivePreview()}else await d.default.replaceStyle(t);e.dispatchEvent(new Event("styleSettings"))}}(0,w.onExtension)(e=>{const{style:t}=e;switch(e.method){case"styleUpdated":d.default.style.id===t.id&&handleExternalUpdate(e);break;case"styleDeleted":d.default.style.id===t.id&&(0,k.closeCurrentTab)()}});for(const[t,o,n]of[["#options",function(e){const t=Object.keys(u.CodeMirror.keyMap).map(e=>({value:e,name:e.replace(/^(pc|mac)(.+)/,(e,t,o)=>o.toLowerCase()+"-"+("mac"===t?"Mac":"PC"))})).sort((e,t)=>e.name<t.name?-1:e.name>t.name&&1),o=document.createDocumentFragment();let n,a=o;t.forEach(({value:e,name:l},c)=>{n=l.includes("-")?n:l;const d=t[c+1]&&t[c+1].name.startsWith(n);d&&a===o&&(a=o.appendChild((0,i.$create)("optgroup",{label:l.split("-")[0]})));const u=a.appendChild((0,i.$create)("option",{value:e},l));e===r.defaults["editor.keyMap"]&&(u.dataset.default="",u.title=(0,s.t)("defaultTheme")),d||(a=o)});const l=(0,i.$)("#editor\\.keyMap",e);l.textContent="",l.appendChild(o),(0,i.$)("#editor\\.theme",e).append((0,i.$create)("option",{value:"default"},(0,s.t)("defaultTheme")),...Object.keys(u.THEMES).map(e=>(0,i.$create)("option",e))),(0,i.$)("#colorpicker-settings",e).onclick=function(e){e.preventDefault();const t=this.getBoundingClientRect(),o=(0,f.createHotkeyInput)("editor.colorpicker.hotkey",{onDone:f.helpPopup.close}),n=f.helpPopup.show((0,s.t)("helpKeyMapHotkey"),o);n.style=`top: ${t.bottom}px; left: ${t.left}px; right: auto;`,(0,i.$)("input",n).focus()},(0,c.setupLivePrefs)(e),r.subscribe("editor.linter",d.default.updateLinterSwitch,!0)},"editorSettings"],["#styleOpts",function(t){const PASS=e=>e,{style:o}=d.default,n=(0,i.$)("#config\\.autosave",t),s=(0,i.$)("#ss-save",t),a=(0,i.$)("#ss-updatable",t),l=new Map,u=[function(e,t,o){return initInput(e,t,Boolean(o),{dom:"checked"})}(a,"updatable",(0,p.tryURL)(o.updateUrl).href),initInput("#ss-update-url","updateUrl","",{validate:e=>(a.disabled=!e.value||!e.validity.valid,e.validity.valid)}),(f="ss-scheme",h="preferScheme",m="none",(0,i.$)(`#${f}`,t).oninput=e=>{e.target.checked&&autosave(e.target,{key:h})},()=>{const e=o[h]||m;(0,i.$)(`[name="${f}"][value="${e}"]`,t).checked=!0}),initArea("inclusions"),initArea("exclusions")];var f,h,m;function autosave(e,o){l.set(e,o),t.classList.add("dirty"),s.disabled=!1,n.checked&&(0,p.debounce)(save,500)}function initArea(e){return initInput(`#ss-${e}`,e,[],{get:textToList,set:e=>e.join("\n"),validate(e){const t=e.value;e.rows=t.match(/^/gm).length+!t.endsWith("\n")}})}function initInput(e,n,s,{dom:r="value",get:a=PASS,set:l=PASS,validate:c=PASS}={}){return"string"==typeof e&&(e=(0,i.$)(e,t)),e.oninput=()=>{!1!==c(e)&&autosave(e,{dom:r,get:a,key:n})},()=>{let t=o[n];t=l(null!=t?t:s),e[r]!==t&&(e[r]=t,c(e))}}function save(){l.forEach(saveValue),l.clear(),t.classList.remove("dirty"),s.disabled=!0}function saveValue({dom:e="value",get:t=PASS,key:n},i){return w.API.styles.config(o.id,n,t(i[e]))}function textToList(e){return e.split(/\n/).map(e=>e.trim()).filter(Boolean)}function update(){u.forEach(e=>e())}update(),r.subscribe("schemeSwitcher.enabled",(e,o)=>{(0,i.$)("#ss-scheme-off",t).hidden="never"!==o},!0),e.on("styleSettings",update),s.onclick=save,(0,c.setupLivePrefs)(t)},"styleSettings"]]){const e=(0,i.$)(t,s.template.body),r=new MutationObserver(()=>{r.disconnect(),e.append((0,i.$create)("main",s.template[n])),s.template[n]=void 0,o(e)});r.observe(e,{attributes:!0,attributeFilter:["open"]})}var C=n(6201);const x=/^!?\s*==userstyle==\s*$/i;class ${constructor(e,t,o){const n=this,a=this.el=s.template.section.cloneNode(!0),l=this.elLabel=(0,i.$)(".code-label",a),c=this.targetsEl=(0,i.$)(".applies-to",a),u=this.cm=a.CodeMirror=C.default.create(e=>{const t=e.style,n=d.default.loading?t.height=o?o.height:"100vh":t.height;a.style.setProperty("--cm-height",n),c[r.get("editor.targetsFirst")?"after":"before"](e)},{value:e.code});this.elLabelText=l.lastChild,u.el=a,u.editorSection=this,a.me=this,u.setSize=$.onSetSize,this.genId=t,this.id=t(),this.changeListeners=new Set,this.changeGeneration=u.changeGeneration(),this.removed=!1,this.tocEntry={label:"",get removed(){return n.removed}},this.targets=[],this.targetsListEl=(0,i.$)(".applies-to-list",a),this.targetsEl.on("change",this),this.targetsEl.on("input",this),this.targetsEl.on("click",this),u.on("changes",$.onCmChanges),g.forEachProp(e,this.addTarget.bind(this)),this.targets.length||this.addTarget(),d.default.applyScrollInfo(u,o),initBeautifyButton((0,i.$)(".beautify-section",a),[u]),r.subscribe("editor.toc.expanded",this.updateTocPrefToggled.bind(this),!0),new E(u),this.updateTocEntry()}getModel(){const e=this.targets.map(e=>e.type&&[e.type,e.value]);return g.toSection(e,{code:this.cm.getValue()})}remove(){m.disableForEditor(this.cm),this.el.classList.add("removed"),this.removed=!0,this.targets.forEach(e=>e.remove())}render(){this.cm.refresh()}destroy(){C.default.destroy(this.cm)}restore(){m.enableForEditor(this.cm),this.el.classList.remove("removed"),this.removed=!1,this.targets.forEach(e=>e.restore()),this.cm.refresh()}onChange(e){this.changeListeners.add(e)}emitChange(e){for(const t of this.changeListeners)t.call(this,e)}off(e){this.changeListeners.delete(e)}updateTocEntry(e,t=this){const o=t.tocEntry;let n;if("code"===e||!e){const e=t.getLabelFromComment();o.label!==e&&(o.label=t.elLabelText.textContent=e,n=!0)}if(!o.label){const e=t.targets[0],i=e.type?e.value:null;o.target!==i&&(o.target=i,n=!0),o.numTargets!==t.targets.length&&(o.numTargets=t.targets.length,n=!0)}n&&d.default.updateToc([t])}updateTocEntryLazy(){(0,p.debounce)(this.updateTocEntry,0,"",this)}updateTocFocus(e){d.default.updateToc({focus:!0,0:e?this.me:this})}updateTocPrefToggled(e,t){this.el[t?"on":"off"]("focusin",this.updateTocFocus),t&&this.el.contains(document.activeElement)&&this.updateTocFocus()}getLabelFromComment(){let e,t,o="";return this.cm.eachLine(({text:n})=>{let i=0;if(!e){if(i=n.search(/\S/),i<0)return;if(e="/"===n[i]&&"*"===n[i+1],!e)return!0;i+=2}const r=n.indexOf("*/",i);return n=n.slice(i,r>=0?r:n.length),o=(0,f.trimCommentLabel)(n),t=this.elUC,o&&x.test(n)?t?t=null:this.elLabelText.after(t=this.elUC=s.template.usercssSection.cloneNode(!0)):t&&(t.remove(),t=this.elUC=!1),null!=t&&this.elLabel.classList.toggle("warn",t),r>=0||o}),o}handleEvent(e){const t=e.target,o=t.classList,n=t.closest(".applies-to-item"),r=n&&n.me;let a;switch(e.type){case"click":if(o.contains("add-applies-to"))(0,i.$)("input",this.addTarget(r.type,"",r).el).focus();else if(o.contains("remove-applies-to"))this.removeTarget(r);else if(!this.ati&&(a=t.closest("label"))){const e=(0,i.$)("#editor\\.targetsFirst",s.template.editorSettings.firstChild||document).closest("label").cloneNode(!0);(this.ati=f.helpPopup.show(e,a.title,{"data-id":"ati"})).onClose.add(()=>delete this.ati),(0,c.setupLivePrefs)(e)}break;case"change":t===r.selectEl&&r.onSelectChange();break;case"input":t===r.valueEl&&r.onValueChange()}}addTarget(e,t,o){const{targets:n}=this,i=new S(this,e,t);return n.splice(o?n.indexOf(o)+1:n.length,0,i),this.targetsListEl.insertBefore(i.el,o?o.el.nextSibling:null),d.default.dirty.add(i,i),n.length>1&&!n[0].type&&this.removeTarget(n[0]),o&&requestAnimationFrame(()=>this.shrinkBy1()),this.el.style.setProperty("--targets",n.length),this.emitChange("apply"),i}removeTarget(e){const{targets:t}=this;t.splice(t.indexOf(e),1),d.default.dirty.remove(e,e),e.remove(),e.el.remove(),t.length||this.addTarget(),this.el.style.setProperty("--targets",t.length),this.emitChange("apply")}shrinkBy1(){const{cm:e,el:t}=this,o=e.display.wrapper,n=o.offsetHeight,i=t.parentElement.offsetHeight;t.offsetHeight>i&&n>Math.min(i/2,e.display.sizer.offsetHeight+30)&&(o.style.height=(n-this.targetsEl.offsetHeight/(this.targets.length||1)|0)+"px")}static onCmChanges(e){const t=e.changeGeneration(),o=e.editorSection;d.default.dirty.modify(`section.${o.id}.code`,o.changeGeneration,t),o.changeGeneration=t,o.emitChange("code"),o.updateTocEntryLazy()}static onSetSize(e,t){const o=this;l().prototype.setSize.call(o,e,t),o.el.style.setProperty("--cm-height",o.display.wrapper.style.height)}}class S{constructor(e,t="",o=""){this.id=e.genId(),this.el=s.template.appliesTo.cloneNode(!0),this.el.me=this,this.section=e,this.dirt=`section.${e.id}.apply.${this.id}`,this.selectEl=(0,i.$)(".applies-type",this.el),this.valueEl=(0,i.$)(".applies-value",this.el),d.default.toggleRegexp(this.valueEl,t),this.type=this.selectEl.value=t,this.value=this.valueEl.value=o,this.restore(),this.toggleAll()}remove(){this.type&&(d.default.toggleRegexp(this.valueEl),d.default.dirty.remove(`${this.dirt}.type`,this.type),d.default.dirty.remove(`${this.dirt}.value`,this.value))}restore(){this.type&&(d.default.dirty.add(`${this.dirt}.type`,this.type),d.default.dirty.add(`${this.dirt}.value`,this.value))}toggleAll(){(0,i.toggleDataset)(this.section.targetsEl,"all",!this.type)}onSelectChange(){const e=this.section,t=this.selectEl.value;d.default.dirty.modify(`${this.dirt}.type`,this.type,t),d.default.toggleRegexp(this.valueEl,t),this.type=t,this.toggleAll(),e.emitChange("apply"),e.updateTocEntry("apply")}onValueChange(){const e=this.valueEl.value;d.default.dirty.modify(`${this.dirt}.value`,this.value,e),this.value=e,this.section.emitChange("apply"),this.section.updateTocEntry("apply")}}class E{constructor(e){const t=this.wrapper=e.display.wrapper,o=s.template.resizeGrip.cloneNode(!0);t.classList.add("resize-grip-enabled"),t.appendChild(o),this.cm=e,this.lastClickTime=0,this.lastHeight=0,this.minHeight=0,this.lastY=0,o.on("mousedown",{me:this,handleEvent:E.onMouseDown}),this.onResize={me:this,handleEvent:E.resize},this.onStop={me:this,handleEvent:E.resizeStop}}static onMouseDown(e){const t=this.me;if(t.lastHeight=t.wrapper.offsetHeight,t.lastY=e.clientY,0===e.button){if(e.preventDefault(),Date.now()-t.lastClickTime<500)return t.lastClickTime=0,void t.toggleSectionHeight();t.lastClickTime=Date.now(),t.minHeight=t.cm.defaultTextHeight()+t.cm.display.lineDiv.offsetParent.offsetTop+t.wrapper.offsetHeight-t.wrapper.clientHeight,document.body.classList.add("resizing-v"),document.on("mousemove",t.onResize),document.on("mouseup",t.onStop)}}static resize(e){const t=this.me,o=Math.max(t.minHeight,t.lastHeight+e.clientY-t.lastY);o!==t.lastHeight&&(t.cm.setSize(null,o),t.lastHeight=o,t.lastY=e.clientY)}static resizeStop(){const e=this.me;document.off("mouseup",e.onStop),document.off("mousemove",e.onResize),document.body.classList.remove("resizing-v")}toggleSectionHeight(){const{cm:t,wrapper:o}=this;if(t.state.toggleHeightSaved)t.setSize(null,t.state.toggleHeightSaved),t.state.toggleHeightSaved=0;else{const n=(0,i.$)("#sections").getBoundingClientRect().top+e.scrollY+parseFloat(getComputedStyle((0,i.$)("#sections")).paddingBottom),s=o.parentNode,r=s.clientHeight-o.offsetHeight;t.state.toggleHeightSaved=o.clientHeight,t.setSize(null,e.innerHeight-r-n);const a=s.getBoundingClientRect();(a.top<0||a.bottom>e.innerHeight)&&e.scrollBy(0,a.top)}}}function SectionsEditor(){const{style:t,dirty:o}=d.default,n=(0,i.$)("#sections"),a=[],l=new IntersectionObserver(function(t){for(const o of t){const t=o.intersectionRatio&&o.intersectionRect;if(t){l.unobserve(o.target);const n=o.target.CodeMirror;t.bottom>0&&t.top<e.innerHeight?refreshOnViewNow(n):setTimeout(refreshOnViewNow,0,n)}}},{rootMargin:"100%"}),h=d.default.livePreviewLazy.bind(null,function(){d.default.livePreview(getModel())});let y,b,v,k=0,C="";return updateMeta(),f.rerouteHotkeys.toggle(!0),(0,i.$)("#to-mozilla").on("click",function(){const e=(0,f.showCodeMirrorPopup)((0,s.t)("styleToMozillaFormatTitle"),"",{readOnly:!0});e.codebox.setValue(d.default.getValue()),e.codebox.execCommand("selectAll")}),(0,i.$)("#to-mozilla-help").on("click",function(e){e.preventDefault(),f.helpPopup.show((0,s.t)("styleMozillaFormatHeading"),(0,s.t)("styleToMozillaFormatHelp"))}),(0,i.$)("#from-mozilla").on("click",()=>showMozillaFormatImport()),document.on("wheel",function(t){t.shiftKey&&t.ctrlKey&&!t.altKey&&!t.metaKey&&(e.scrollBy(0,t.deltaX||t.deltaY),t.preventDefault())},{passive:!1}),u.extraKeys["Shift-Ctrl-Wheel"]="scrollWindow",r.subscribe("editor.arrowKeysTraverse",(e,t)=>{for(const{cm:e}of a)handleKeydownSetup(e,t);v=t},!0),r.subscribe("editor.targetsFirst",(e,t)=>{for(const e of a)(t?e.elLabel:e.targetsEl.nextSibling).after(e.targetsEl)}),Object.assign(d.default,{sections:a,closestVisible:function(t){const o=a[0].cm.defaultTextHeight(),i=2*o,s=t instanceof u.CodeMirror?t:t instanceof Node&&getAssociatedEditor(t)||getLastActivatedEditor();if(t===s&&(t=document.body),t instanceof Node&&s){const{wrapper:o}=s.display;if(!n.contains(t)||o.closest(".section").contains(t)){const t=o.getBoundingClientRect();if(t.top<e.innerHeight-i&&t.bottom>i)return s}}const r=e.scrollY,l=r+e.innerHeight-i,c=r+n.getBoundingClientRect().top,p=[];return s&&0===offscreenDistance()?s:function(){const e=d.default.getEditors(),t=e.length-1;let o,n,i=0,s=t;for(;i<s-1&&(o=(i+s)/2|0,n=offscreenDistance(o),n&&o);){const e=offscreenDistance(o-1),r=o<t?offscreenDistance(o+1):1e20;e<=n&&n<=r?s=o:i=o}for(;s&&offscreenDistance(s-1)<=offscreenDistance(s);)s--;const r=e[s];return p[s]>0&&d.default.scrollToEditor(r),r}();function offscreenDistance(e){if(e>=0&&void 0!==p[e])return p[e];const t=s&&s.display.wrapper.closest(".section");if(!t)return 1e9;const n=c+t.offsetTop;if(n<r+o)return Math.max(0,r-n-o);if(n<l)return 0;const i=n-l+t.offsetHeight;return e>=0&&(p[e]=i),i}},updateLivePreview:h,updateMeta,getCurrentLinter:()=>r.get("editor.linter"),getEditors:()=>a.filter(e=>!e.removed).map(e=>e.cm),getEditorTitle(e){const t=d.default.getEditors().indexOf(e)+1;return{textContent:`#${t}`,title:`${(0,s.t)("sectionCode")} ${t}`}},getValue(e){const t=getModel();return e?t:(0,g.styleToCss)(t)},getSearchableInputs(e){const t=a.find(t=>t.cm===e);return t?t.targets.map(e=>e.valueEl).filter(Boolean):[]},isSame:e=>(0,g.styleSectionsEqual)(e,getModel()),jumpToEditor(e){const{cm:t}=a[e]||{};t&&(d.default.scrollToEditor(t),t.focus())},nextEditor:(e,t)=>t&&e===findLast(a,e=>!e.removed).cm?null:nextPrevEditor(e,1,t),prevEditor:(e,t)=>t&&e===a.find(e=>!e.removed).cm?null:nextPrevEditor(e,-1,t),async replaceStyle(e,t){const n=d.default.isSame(e);(n||t||await c.messageBox.confirm((0,s.t)("styleUpdateDiscardChanges")))&&(t||o.clear(),n||await initSections(e.sections,{keepDirty:t,replace:!0,si:t&&t.si}),d.default.useSavedStyle(e),h())},async saveImpl(){try{if(!(0,i.$)("#name").reportValidity())throw(0,s.t)("styleMissingName");const e=await w.API.styles.editSave(getModel());o.clear(),d.default.useSavedStyle(e)}catch(e){c.messageBox.alert(e.message||e)}},scrollToEditor(t,o){const i=o&&t.cursorCoords(!0,"window"),{top:s,bottom:r}=t.el.getBoundingClientRect(),a=n.getBoundingClientRect(),l=Math.max(a.top,0),c=Math.min(a.bottom,innerHeight);(o?i.top<l||i.top>c-30:s>=l^r<=c)&&e.scrollBy(0,(s+r-c+l)/2|0)}}),initSections(t.sections);function fitToContent(t){const{cm:o,cm:{display:{wrapper:i,sizer:s}}}=t;function resize(){let r=s.offsetHeight;if(r<o.defaultTextHeight())return;null==y&&(y=Math.ceil(n.getBoundingClientRect().top+scrollY)),null==b&&(b=i.offsetHeight-i.clientHeight),r+=b,o.off("update",resize);const a=i.offsetHeight,l=Math.min(t.el.offsetHeight-a,e.innerHeight/2),c=Math.floor(e.innerHeight-y-l),d=Math.min(r,c);Math.abs(d-a)>1&&o.setSize(null,d)}o.display.renderedView?resize():o.on("update",resize)}function fitToAvailableSpace(){const t=n.getBoundingClientRect().bottom,o=Math.floor((e.innerHeight-t)/a.length);o>1&&a.forEach(({cm:e})=>{e.setSize(null,e.display.lastWrapHeight+o)})}function genId(){return k++}function setGlobalProgress(e,t){const o=(0,i.$)("#global-progress")||t&&document.body.appendChild((0,i.$create)("#global-progress"));if(t){const n=(e/Math.max(e,t)*100).toFixed(1);o.style.borderLeftWidth=n+"vw",setTimeout(()=>{o.title=n+"%"})}else(0,i.$remove)(o)}function getAssociatedEditor(e){for(let t=e;t;t=t.parentElement)if(t.CodeMirror)return t.CodeMirror}function findLast(e,t){for(let o=e.length-1;o>=0;o--)if(t(e[o]))return e[o]}function handleKeydown(e){if(e.shiftKey||e.altKey||e.metaKey||"ArrowUp"!==e.key&&"ArrowDown"!==e.key)return;let t,o=this.CodeMirror;const{line:n,ch:i}=o.getCursor();"ArrowUp"===e.key?(o=0===n&&d.default.prevEditor(o,!0),t=o&&[o.doc.size-1,i]):(o=n===o.doc.size-1&&d.default.nextEditor(o,!0),t=o&&[0,0]),o&&(o.setCursor(...t),e.preventDefault(),e.stopPropagation())}function handleKeydownSetup(e,t){e.display.wrapper[t?"on":"off"]("keydown",handleKeydown,!0)}function nextPrevEditor(e,t,o){const n=d.default.getEditors();return e=n[(n.indexOf(e)+t+n.length)%n.length],d.default.scrollToEditor(e,o),e.focus(),e}function getLastActivatedEditor(){let e;for(const t of a)t.removed||(!e||t.cm.lastActive>e.lastActive)&&(e=t.cm);return e}function showMozillaFormatImport(e=""){const t=(0,f.showCodeMirrorPopup)((0,s.t)("styleFromMozillaFormatPrompt"),(0,i.$create)(".buttons",[(0,i.$create)("button",{name:"import-replace",textContent:(0,s.t)("importReplaceLabel"),title:"Ctrl-Shift-Enter:\n"+(0,s.t)("importReplaceTooltip"),onclick:()=>doImport({replaceOldStyle:!0})}),(0,i.$create)("button",{name:"import-append",textContent:(0,s.t)("importAppendLabel"),title:"Ctrl-Enter:\n"+(0,s.t)("importAppendTooltip"),onclick:doImport})])),o=t._contents;async function doImport({replaceOldStyle:e=!1}){lockPageUI(!0);try{const o=t.codebox.getValue().trim();if(!o.match(p.RX_META)?.[0].includes("@preprocessor")||!await getPreprocessor(o)||await c.messageBox.confirm((0,s.t)("importPreprocessor"),"pre-line",(0,s.t)("importPreprocessorTitle"))){const{sections:t,errors:n}=await w.API.worker.parseMozFormat({code:o});t.length&&!n.some(e=>!e.recoverable)||await Promise.reject(n),await initSections(t,{replace:e,focusOn:e?0:a.length,keepDirty:!0}),f.helpPopup.close()}}catch(e){o=e,c.messageBox.show({className:"center danger",title:(0,s.t)("styleFromMozillaFormatError"),contents:(0,i.$create)("pre",(Array.isArray(o)?o:[o]).map(e=>e.message||e).join("\n")),buttons:[(0,s.t)("confirmClose")]})}var o;lockPageUI(!1)}async function getPreprocessor(e){try{return(await w.API.usercss.buildMeta({sourceCode:e})).usercssData.preprocessor}catch{}}function lockPageUI(e){i.$.root.style.pointerEvents=e?"none":"",t.codebox&&(t.classList.toggle("ready",!e&&!t.codebox.isBlank()),t.codebox.options.readOnly=e,t.codebox.display.wrapper.style.opacity=e?".5":"")}o.insertBefore(t.codebox.display.wrapper,o.firstElementChild),t.codebox.focus(),t.codebox.on("changes",e=>{t.classList.toggle("ready",!e.isBlank()),e.markClean()}),e&&(t.codebox.setValue(e),t.codebox.clearHistory(),t.codebox.markClean()),t.codebox.options.extraKeys={"Ctrl-Enter":doImport,"Shift-Ctrl-Enter":()=>doImport({replaceOldStyle:!0})}}function updateSectionOrder(){const e=C,t=a.filter(e=>!e.removed);C=t.map(e=>e.id).join(","),o.modify("sectionOrder",e,C),n.dataset.sectionCount=t.length,m.refreshReport(),d.default.updateToc()}function getModel(){return Object.assign({},t,{sections:a.filter(e=>!e.removed).map(e=>e.getModel())})}function updateMeta(){(0,i.$)("#name").value=t.customName||t.name||"",(0,i.$)("#enabled").checked=!1!==t.enabled,(0,i.$)("#url").href=t.url||"",d.default.updateName()}async function initSections(t,{focusOn:i=0,replace:s=!1,keepDirty:r=!1,si:l=d.default.scrollInfo}={}){Object.assign(d.default,{loading:!0}),s&&(a.forEach(e=>e.remove()),a.length=0,n.textContent=""),l&&l.cms&&l.cms.length===t.length?(l.scrollY2=l.scrollY+e.innerHeight,n.style.height=l.scrollY2+"px",scrollTo(0,l.scrollY),i=l.cms[0].focus&&0):l=null;let c,u=!0,f=0;for(let e=0,n=a.length;e<t.length;e++,n++){const s=performance.now();c?s-c>100&&(c=0,u=!1,await(0,p.sleep)()):c=s,l&&(u=f<l.scrollY2&&(f+=l.cms[e].parentHeight)>l.scrollY),insertSectionAfter(t[e],null,u,l&&l.cms[e]),setGlobalProgress(e,t.length),r||o.clear(),n===i&&setTimeout(d.default.jumpToEditor,0,n)}l&&!l.cms.every(e=>!e.height)||requestAnimationFrame(fitToAvailableSpace),n.style.removeProperty("height"),setGlobalProgress(),d.default.loading=!1}function removeSection(e){if(a.every(t=>t.removed||t===e))throw new Error("Cannot remove last section");if(e.cm.isBlank()){const t=a.indexOf(e);a.splice(t,1),e.el.remove(),e.remove(),e.destroy()}else{const t=[],o=10;e.cm.doc.iter(0,o+1,({text:e})=>t.push(e)&&!1);const n=(0,s.t)("sectionCode")+"\n"+"-".repeat(20)+"\n"+t.slice(0,o).map(e=>(0,p.clipString)(e,100)).join("\n")+(t.length>o?"\n...":""),r=e.elDel=s.template.deletedSection.cloneNode(!0);(0,i.$)("button",r).onclick=()=>restoreSection(e),r.title=n,e.el.prepend(r),e.remove()}o.remove(e,e),updateSectionOrder(),e.off(h),h()}function restoreSection(e){e.elDel.remove(),e.restore(),updateSectionOrder(),e.onChange(h),h()}function insertSectionAfter(e,t,o,i){e||(e={code:"",urlPrefixes:["https://example.com/"]});const s=new $(e,genId,i),{cm:r}=s,{code:l}=e,c=t?a.indexOf(t)+1:a.length;a.splice(c,0,s),n.insertBefore(s.el,t?t.el.nextSibling:null),refreshOnView(r,{code:l,force:t||o}),registerEvents(s),i&&i.height||t&&!l||fitToContent(s),t&&(r.focus(),d.default.scrollToEditor(r)),v&&handleKeydownSetup(r,!0),updateSectionOrder(),h(),s.onChange(h)}function moveSectionUp(e){const t=a.indexOf(e);0!==t&&(n.insertBefore(e.el,a[t-1].el),a[t]=a[t-1],a[t-1]=e,updateSectionOrder(),d.default.scrollToEditor(e.cm))}function moveSectionDown(e){const t=a.indexOf(e);t!==a.length-1&&(n.insertBefore(a[t+1].el,e.el),a[t]=a[t+1],a[t+1]=e,updateSectionOrder(),d.default.scrollToEditor(e.cm))}function registerEvents(e){const{el:t,cm:o}=e;(0,i.$)(".remove-section",t).onclick=()=>removeSection(e),(0,i.$)(".add-section",t).onclick=()=>insertSectionAfter(void 0,e),(0,i.$)(".clone-section",t).onclick=()=>insertSectionAfter(e.getModel(),e),(0,i.$)(".move-section-up",t).onclick=()=>moveSectionUp(e),(0,i.$)(".move-section-down",t).onclick=()=>moveSectionDown(e),o.on("paste",maybeImportOnPaste)}function maybeImportOnPaste(e,t){const o=t.clipboardData.getData("text")||"";/@-moz-document/i.test(o)&&/@-moz-document\s+(url|url-prefix|domain|regexp)\(/i.test(o.replace(/\/\*([^*]+|\*(?!\/))*(\*\/|$)/g,""))&&(t.preventDefault(),showMozillaFormatImport(o))}function refreshOnView(e,{code:t,force:o}={}){t&&m.enableForEditor(e,t),o?refreshOnViewNow(e):l.observe(e.display.wrapper)}async function refreshOnViewNow(e){m.enableForEditor(e),e.refresh()}}var T=n(7209);function MozSectionFinder(e){const t="MozSectionFinder",o=/@-moz-document(\s+|$)/gi,n=/\s*}/y,i=/([-a-z]+)\(/iy,s=/(\s*)(.)?/y,r=/\s+/y,a=/^(?!comment|string)/,c=/^comment(\s|$)/,d=/^string(\s|$)/,{cmpPos:u}=l(),minPos=(e,t)=>u(e,t)<0?e:t,maxPos=(e,t)=>u(e,t)>0?e:t,h=new Map;let m,g,y;const b={IGNORE_ORIGIN:t,EQ_SKIP_KEYS:["mark","valueStart","valueEnd","sticky"],get sections(){return getState().sections},keepAliveFor(e,t){let o=h.get(e);if(o)clearTimeout(o.timer);else{const NOP=()=>0;o={fn:NOP},h.set(e,o),b.on(NOP)}o.timer=setTimeout(()=>h.delete(e),t)},on(t){const{listeners:o}=getState(),n=!o.size;o.add(t),n&&(e.on("changes",onCmChanges),update())},off(t){const{listeners:o,sections:n}=getState();o.size&&(o.delete(t),o.size||(e.off("changes",onCmChanges),e.operation(()=>n.forEach(e=>e.mark.clear())),n.length=0))},onOff(e,t){b[t?"on":"off"](e)},updatePositions(e){(e?[e]:getState().sections).forEach(setPositionFromMark)}};function getState(){let o=e.state[t];return o||(o=e.state[t]={listeners:new Set,sections:[]}),o}function onCmChanges(e,t){m||(m={line:1/0,ch:0}),g||(g={line:-1,ch:0});for(const e of t)e.origin!==b.IGNORE_ORIGIN&&(m=minPos(e.from,m),g=maxPos(l().changeEnd(e),g));g.line>=0&&!y&&(y=requestAnimationFrame(update))}function update(){const{sections:o,listeners:n}=getState();let i,s=m?{line:m.line,ch:m.ch}:{line:0,ch:0},r=g?{line:g.line,ch:g.ch}:{line:e.doc.size,ch:0},a=-1,l=-1;y=m=g=null;for(let e=0;e<o.length;e++){const t=o[e];if(u(t.end,s)>=0&&(a<0&&(a=e,s=minPos(s,t.start)),setPositionFromMark(t))){if(u(t.start,r)>0){l=e;break}r=maxPos(t.end,r)}}a<0&&(s.ch=Math.max(0,s.ch-14),a=o.length),l<0&&(r.ch+=14,l=o.length);let c=0,d=0;const p=findSections(s,r),f=o.slice(a,l);for(const o of p){const n=f.findIndex(isSameSection,o);if(n>=0){const e=f[n];e.funcs=o.funcs,o.mark=e.mark,f[n]=null,d++,i||c++}else i||(i=e.curOp||(e.startOperation(),!0)),o.mark=e.markText(o.start,o.end,{clearWhenEmpty:!1,inclusiveRight:!0,[t]:o}),d=0}p.length-=d,l-=d,c&&(a+=c,p.splice(0,c));for(const t of f)t&&(i||(i=e.curOp||(e.startOperation(),!0)),t.mark.clear());i&&(o.splice(a,l-a,...p),n.forEach(e=>e(p,f,a,l))),!0===i&&e.endOperation()}function findSections(t,l){const u=[];let p,h,m,g,y,b=t.line-1,v="";return e.eachLine(t.line,e.doc.size,w=>{++b;const{text:k}=w,C=k.length;if(!C)return;let x=b===t.line?t.ch:0;for(;;){let t;if(!v){if((b-l.line||x-l.ch)>=0)return!0;if((x=k.indexOf("@-",x))<0||(o.lastIndex=x,!(t=o.exec(k))))return;if(x=t.index+t[0].length,p={funcs:y=[],start:{line:b,ch:t.index},end:null,mark:null,tocEntry:{label:"",target:null,numTargets:0}},!a.test(e.getTokenTypeAt(p.start)))continue;u.push(p),v="_func"}w.styles||e.getTokenTypeAt({line:b,ch:0});const{styles:$}=w;let S,E,T=1;if(x){for(T+=$.length*x/C&-2;$[T-2]>=x;)T-=2;for(;$[T]<=x;)T+=2}for(;v&&T<$.length;(S||x>=$[T]||x===E)&&(T+=2),E=x){let e;if(S=$[T+1],S&&S.startsWith("overlay ")&&(S=""),v.startsWith("_")){if(!S&&(r.lastIndex=x,r.test(k))&&(x=r.lastIndex,x===$[T]))continue;const e=S&&c.test(S);if("_cmt"===v){const t=e&&(0,f.trimCommentLabel)(k.slice(x,x=$[T]));t&&(p.tocEntry.label=t),(!e&&S||t)&&(v="");continue}if(e){x=$[T];continue}v=v.slice(1)}if("func"===v){if(!(S&&(i.lastIndex=x,t=i.exec(k)))){v="error";break}for(h=t[1],m={line:b,ch:x},x+=h.length+1,g=!1,v="_str";$[T+2]<=x;)T+=2}if("str"===v)if(g||(e='"'===(e=k[x])||"'"===e?e:"",g={chunks:[],start:{line:b,ch:x+=!!e},end:null,quote:e}),d.test(S)){let e=$[T];e>x&&(k[e-1]===g.quote&&"\\"!==k[e-2]&&(e--,v="_)"),g.chunks.push(k.slice(x,e)),g.end={line:b,ch:e}),x=$[T]}else{if(S){v="error";break}v=")"===k[x]?(T+=2,")"):"_)",g.end={line:b,ch:x}}if(")"===v){if(")"!==k[x]){v="error";break}if(x++,e=g?g.chunks.join(""):"",y.length||(p.tocEntry.target=e),p.tocEntry.numTargets++,y.push({type:h,value:e,isQuoted:g.quote,start:m,end:{line:b,ch:x},valueStart:g.start,valueEnd:g.end}),s.lastIndex=x,e=k.match(s),v=e[2],v=","===v?"_func":"{"===v?"_cmt":!v&&"_,",!v){v="error";break}if(x+=e[0].length,"{"===e[2]&&(n.lastIndex=x,n.test(k))){v="";break}}","===v&&(v=","===k[x]?"_func":"")}if(p.end={line:b,ch:$[T+2]||C},"error"===v&&(v=""),v)return}}),u}function setPositionFromMark(e){const t=e.mark.find();return e.start=t&&t.from,e.end=t&&t.to,t}function isSameSection(e){return e&&e.start&&e.tocEntry.label===this.tocEntry.label&&!u(e.start,this.start)&&!u(e.end,this.end)&&e.funcs.length===this.funcs.length&&e.funcs.every(isSameFunc,this.funcs)}function isSameFunc(e,t){return(0,p.deepEqual)(e,this[t],b.EQ_SKIP_KEYS)}return b}var O=n(2255);function MozSectionWidget(e,t=MozSectionFinder(e)){let o,n,r;const a="MozSectionWidget",u=".applies-to",f="label",h=".applies-to-list",m=".applies-to-item",g=".applies-type",y=".applies-value",getFuncFor=e=>e.closest(m)[a],getFuncsFor=e=>e.closest(h)[a],getSectionFor=e=>e.closest(u)[a],{cmpPos:b}=l();let v,k=!1,C=0;return{toggle(e){Boolean(e)!==k&&(e?init:destroy)()}};function init(){const l={title:(0,s.t)("appliesHelp")};k=!0,o={container:(0,i.$create)("div"+u,[(0,i.$create)(f,l,(0,s.t)("appliesLabel")),(0,i.$create)("ul"+h)]),listItem:s.template.appliesTo.cloneNode(!0),appliesToEverything:(0,i.$create)("li.applies-to-everything",(0,s.t)("appliesToEverything"))},(0,i.$)('[value=""]',o.listItem).remove(),Object.assign((0,i.$)(g,o.listItem),l),r={".remove-applies-to"(t,o){const n=getFuncsFor(t);if(n.length<2)return void c.messageBox.show({contents:(0,s.t)("appliesRemoveError"),buttons:[(0,s.t)("confirmClose")]});const i=n.indexOf(o),r=n[i+1],a=i?n[i-1].item.find(1):o.item.find(-1),l=r?r.item.find(-1):o.item.find(1);e.replaceRange(i&&r?", ":"",a,l)},async".add-applies-to"(t,o){const n=o.item.find(1);e.replaceRange(`, ${o.str.type}("")`,n,n),await(0,p.sleep)(),(0,i.$)("input",t.nextElementSibling).focus()}},n={onchange({target:e}){n.oninput({target:e.closest(g)||e})},oninput({target:o}){const n=o.matches(y)?"value":o.matches(g)&&"type";if(!n)return;const i=getFuncFor(o),s=i[n].find(),{value:r}=o;if(r!==i.str[n]){if(i.str[n]=r,"type"===n)i.item[a].dataset.type=r,d.default.toggleRegexp(i.value[a],r);else if(i===getFuncsFor(o)[0]){const e=getSectionFor(o);e.tocEntry.target=r,e.tocEntry.label||d.default.updateToc([e])}e.replaceRange(fromDoubleslash(r).replace(/\\/g,"\\\\"),s.from,s.to,t.IGNORE_ORIGIN)}},onclick(e){const{target:t}=e;for(const o in r){const n=t.closest(o);if(n){const t=n.closest(m);return void r[o](t,t[a],e)}}}},v=(0,i.$create)("style"),e.on("optionChange",onCmOption),w.onExtension(onRuntimeMessage),t.sections.length&&update(t.sections,[]),t.on(update),updateWidgetStyle(),e.display.wrapper.style.setProperty("--cm-bar-width",e.display.barWidth+"px")}function destroy(){k=!1,e.off("optionChange",onCmOption),w.off(onRuntimeMessage),v.remove(),v=null,e.operation(()=>t.sections.forEach(killWidget)),t.off(update)}function onCmOption(e,t){"theme"===t&&updateWidgetStyle()}function onRuntimeMessage(e){("editPreview"!==e.reason||(0,i.$)(`#stylus-${e.style.id}`))&&(e.style||e.styles||e.prefs&&"disableAll"in e.prefs||"colorScheme"===e.method||"styleDeleted"===e.method)&&requestAnimationFrame(updateWidgetStyle)}function updateWidgetStyle(){C=0;const t={wrapper:(0,O.default)(e.display.wrapper,{bg:"backgroundColor",fore:"color"}),gutter:(0,O.default)(e.display.gutters,{bg:"backgroundColor",border:"borderRightColor"}),line:(0,O.default)(".CodeMirror-linenumber",null,e.display.lineDiv),comment:(0,O.default)("span.cm-comment",null,e.display.lineDiv)},o="0px"!==t.gutter.style.borderRightWidth&&!/transparent|\b0\)/g.test(t.gutter.style.borderRightColor),n=Math.abs(t.gutter.bgLuma-t.wrapper.foreLuma),s=(o&&Math.abs(t.gutter.bgLuma-t.gutter.borderLuma),Math.abs(t.gutter.bgLuma-t.line.foreLuma)),r=s>n||s>.4?t.line.fore:t.wrapper.fore,a=r.replace(/[\d.]+(?=\))/,.2),l=`1px ${o?t.gutter.style.borderRightStyle:"solid"} ${a}`;v.textContent=`\n      ${u} {\n        background-color: ${t.gutter.bg};\n        border-top: ${l};\n        border-bottom: ${l};\n      }\n      ${u} ${f} {\n        color: ${r};\n      }\n      ${u} input,\n      ${u} select {\n        background: ${t.wrapper.bg};\n        border: ${l};\n        transition: none;\n        color: ${r};\n      }\n      ${u} .select-wrapper::after {\n        color: ${r};\n        transition: none;\n      }\n    `,i.$.root.appendChild(v)}function update(o,n,s=t.sections.indexOf(o[0])){const r=o.isDelayed&&(e.startOperation(),!0),a=[],l=performance.now();let{viewFrom:c,viewTo:d}=e.display;for(const e of o){const t=n.findIndex(isReusableWidget,e),i=n[t];if(r||i||e.end.line>=c&&e.start.line<d){if(renderWidget(e,i),d-=1.25*(e.funcs.length||1),i&&(n[t]=null),performance.now()-l>50){a.push(...o.slice(o.indexOf(e)+1));break}}else a.push(e)}for(let e,o=Math.max(0,s),{sections:n}=t;o<n.length;o++)if(!a.includes(e=n[o])){const t=(0,i.$)(f,e.widget.node).dataset,n=`${o+1}`;t.index!==n&&(t.index=n)}a.length?(a.isDelayed=!0,setTimeout(update,0,a,n)):n.forEach(killWidget),r&&e.endOperation()}function isReusableWidget(e){return e&&e.widget&&e.widget.line.parent&&e.start&&!b(e.start,this.start)}function renderWidget(t,o){let n=o&&o.widget;const i=Math.round(C*(t.funcs.length||1))||void 0,s=renderContainer(t,n);return n&&n.line.lineNo()===t.start.line?(n.node=s,i&&i!==n.height&&(n.height=i,n.changed())):(n&&n.clear(),n=e.addLineWidget(t.start.line,s,{coverGutter:!0,noHScroll:!0,above:!0,height:i}),n.on("redraw",()=>{const t=e.display.barWidth+"px";n[a]!==t&&(n[a]=t,s.style.setProperty("--cm-bar-width",t))})),C||(C=s.offsetHeight/(t.funcs.length||1)),setProp(t,"widget",n),n}function renderContainer(e,t){const s=t?t.node:o.container.cloneNode(!0),r=(0,i.$)(h,s),{funcs:l}=e,c=r[a]||!1,d=l.map((e,t)=>renderFunc(e,c[t]));let u=r.firstChild;for(const{item:e}of d){const t=e[a];t!==u&&(r.insertBefore(t,u),u&&u.remove(),u=t),u=u.nextSibling}for(let e=l.length;c&&e<c.length;e++)if(killFunc(c[e]),u){const e=u.nextSibling;u.remove(),u=e}return l.length||c&&!c.length||o.appliesToEverything.cloneNode(!0),setProp(e,"widgetFuncs",d),r[a]=d,s[a]=e,s.classList.toggle("error",!e.funcs.length),Object.assign(s,n)}function renderFunc(e,t={}){const{type:n,value:s,isQuoted:r=!1,start:l,start:{line:c},typeEnd:u={line:c,ch:l.ch+n.length},valuePos:p={line:c,ch:u.ch+1+Boolean(r)},valueEnd:f={line:c,ch:p.ch+s.length},end:h={line:c,ch:f.ch+Boolean(r)+1}}=e,m=t.item?.[a]||o.listItem.cloneNode(!0),b=(0,i.$)(y,m),v=m[a]={str:{type:n,value:s},item:markFuncPart(l,h,t.item,m),type:markFuncPart(l,u,t.type,(0,i.$)(g,m),n,toLowerCase),value:markFuncPart(p,f,t.value,b,s,fromDoubleslash)};return m.dataset.type!==n&&(m.dataset.type=n,b.focus=focusRegexp,d.default.toggleRegexp(b,n)),v}function markFuncPart(t,o,n,i,s,r){if(n){const i=n.find();(!i||b(i.from,t)||b(i.to,o)||null!=s&&s!==e.getRange(t,o))&&(n.clear(),n=null)}return n||(n=e.markText(t,o,{clearWhenEmpty:!1,inclusiveLeft:!0,inclusiveRight:!0,[a]:i})),null!=s&&(s=r(s),i.value!==s&&(i.value=s)),n}function killWidget(e){const t=e&&e.widget;t&&(t.clear(),t.node[a].widgetFuncs.forEach(killFunc))}function killFunc(e){d.default.toggleRegexp(e.value[a]),e.item.clear(),e.type.clear(),e.value.clear()}function focusRegexp(){e.display.lineDiv.contains(this)||e.jumpToPos(getSectionFor(this).start),Object.getPrototypeOf(this).focus.apply(this,arguments)}function fromDoubleslash(e){return/([^\\]|^)\\([^\\]|$)/.test(e)?e:e.replace(/\\\\/g,"\\")}function toLowerCase(e){return e.toLowerCase()}function setProp(e,t,o){return Object.defineProperty(e,t,{value:o,configurable:!0})}}function SourceEditor(){const{style:e,dirty:t}=d.default,o="\n    /* ==UserStyle==\n    @name           \n    @namespace      github.com/openstyles/stylus\n    @version        1.0.0\n    @description    A new userstyle\n    @author         Me\n    ==/UserStyle== */\n  ".replace(/^\s+/gm,"");let n,a=NaN;(0,i.$$remove)(".sectioned-only"),(0,i.$)("#header").on("wheel",function({target:e,deltaY:t,deltaMode:o,shiftKey:n}){for(;e=e.parentElement;)if(t<0&&e.scrollTop||t>0&&e.scrollTop+e.clientHeight<e.scrollHeight)return;u.display.scroller.scrollTop+=1===o?t*u.defaultTextHeight():2===o||n?Math.sign(t)*u.display.scroller.clientHeight:t}),(0,i.$)("#sections").textContent="",(0,i.$)("#sections").appendChild((0,i.$create)(".single-editor")),(0,i.$)("#save-button").on("split-btn",async function(){const e=await c.messageBox.show({contents:(0,s.t)("usercssReplaceTemplateConfirmation"),className:"center",buttons:[(0,s.t)("confirmYes"),(0,s.t)("confirmNo"),{textContent:(0,s.t)("genericResetLabel"),title:(0,s.t)("restoreTemplate")}]});if(e.enter||1!==e.button){const t=T.LZ_KEY.usercssTemplate,n=2===e.button?o:u.getValue();await(0,T.setLZValue)(t,n),await(0,T.getLZValue)(t)!==n&&c.messageBox.alert((0,s.t)("syncStorageErrorSaving"))}});const u=C.default.create((0,i.$)(".single-editor")),h=MozSectionFinder(u),y=MozSectionWidget(u,h);function showLog(e){if(e)for(const t of e)console.log(...t)}function updateLivePreview(){e.id&&showLog(d.default.livePreview(Object.assign({},e,{sourceCode:u.getValue()})))}function updateLinterSwitch(){const e=(0,i.$)("#editor.linter");if(!e)return;e.value=getCurrentLinter();const t=(0,i.$)('[value="csslint"]',e),o=getModeName();"css"!==o?(t.disabled=!0,t.title=(0,s.t)("linterCSSLintIncompatible",o)):(t.disabled=!1,t.title="")}function getCurrentLinter(){const e=r.get("editor.linter");return"css"!==u.getOption("mode")&&"csslint"===e?"stylelint":e}function updateMeta(){const t=e.customName||e.name;(0,i.$)("#name").value=t,(0,i.$)("#enabled").checked=e.enabled,(0,i.$)("#url").href=e.url,d.default.updateName(),u.setPreprocessor(e.usercssData?.preprocessor)}async function replaceStyle(o,i){t.clear("name");const r=d.default.isSame(o);if(r)return n=u.changeGeneration(),d.default.useSavedStyle(o),t.clear("sourceGeneration"),t.clear("enabled"),void updateLivePreview();if(i||await c.messageBox.confirm((0,s.t)("styleUpdateDiscardChanges"))){if(d.default.useSavedStyle(o),!r){const t=i&&i.si.cms[0],o=!t&&u.getCursor();u.setValue(e.sourceCode),t?d.default.applyScrollInfo(u,t):u.setCursor(o),n=u.changeGeneration()}r&&updateLivePreview(),i||t.clear()}}function showSaveError(e,t){const o=e._varLines-1||0,n=(e=Array.isArray(e)?e:[e]).map(e=>e.message||e).join("\n"),r=e.map(e=>e.index>=0&&u.posFromIndex(e.index)||e.offset>=0&&{line:e.line-1,ch:e.col-1}).filter(Boolean),a=t.usercssData.preprocessor,l=d.default.ppDemo[a];u.setSelections(r.map(e=>({anchor:e,head:e}))),c.messageBox.show({title:(0,s.t)("genericError"),className:"center pre danger",contents:(0,i.$create)("pre","stylus"===a&&o?n.replace(/^.+\n/,"").replace(/^(\s*)(\d+)/gm,(e,t,n)=>t+(n-o)):n),buttons:[(0,s.t)("confirmClose"),l&&(0,i.$createLink)({className:"icon",href:l},[(0,s.t)("genericTest"),(0,i.$create)("i.i-external",{style:"line-height:0"})])]})}function nextPrevSection(e){h.keepAliveFor(nextPrevSection,1e4),h.updatePositions();const{sections:t}=h,o=t.length;if(!o)return;e=e<0?-1:0;const n=u.getCursor();let i=t.findIndex(t=>l().cmpPos(t.start,n)>Math.min(e,0));i<0&&(!e||l().cmpPos(t[o-1].start,n)<0)&&(i=0),u.jumpToPos(t[(i+e+o)%o].start)}function getBadRegexps({sections:e}){const t=[];for(const{regexps:o}of e)if(o)for(const e of o){const o=(0,d.failRegexp)(e);o&&t.push(`${o}: ${e}`)}return t.join("\n\n")}function getModeName(){const e=u.doc.mode;return e?(e.name||e||"")+(e.helperType||""):""}e.id||function(n){const i=`/* ${(0,s.t)("usercssReplaceTemplateSectionBody")} */`,a=e.sections[0];a.code=" ".repeat(r.get("editor.tabSize"))+i,1===Object.keys(a).length&&(a.domains=["example.com"]),e.sourceCode=(n||o).replace(/(@name)(?:([\t\x20]+).*|\n)/,(t,o,n)=>`${o}${n||" "}${e.name}`).replace(/\s*@-moz-document[^{]*{([^}]*)}\s*$/g,(e,t)=>t.trim()===i?"\n\n":e).trim()+"\n\n"+(0,g.styleToCss)(e),u.startOperation(),u.setValue(e.sourceCode),u.clearHistory(),u.markClean(),u.endOperation(),t.clear("sourceGeneration")}(d.default.template),function(e){let t=null,o=null,n=[];m.register(async(i,r,a)=>{if(a!==u)return;const l=i.match(p.RX_META);if(!l)return[];if(l[0]===t&&l.index===o)return n;const{metadata:c,errors:d}=await f.worker.metalint(l[0]);return d.every(e=>"unknownMeta"===e.code)&&e(c),n=d.map(({code:e,index:t,args:o,message:n})=>{const i="unknownMeta"===e,r=i&&o[1]?"Typo":"";return{from:u.posFromIndex((t||0)+l.index),to:u.posFromIndex((t||0)+l.index),message:e&&(0,s.t)(`meta_${e}${r}`,o,!1)||n,severity:i?"warning":"error",rule:e}}),t=l[0],o=l.index,n})}(t=>{const{vars:o}=e.usercssData||{};if(o){let e;for(const[n,i]of Object.entries(t.vars||{}))(e=o[n])&&e.type===i.type&&null!=(e=e.value)&&(i.value=e)}e.usercssData=t,e.name=t.name,e.url=t.homepageURL||e.installationUrl,updateMeta()}),updateMeta(),Object.assign(d.default,{sections:h.sections,replaceStyle,updateLinterSwitch,updateLivePreview,updateMeta,closestVisible:()=>u,getCurrentLinter,getEditors:()=>[u],getEditorTitle:()=>"",getValue:t=>t?{customName:e.customName,enabled:e.enabled,sourceCode:u.getValue()}:u.getValue(),getSearchableInputs:()=>[],isSame:e=>e.sourceCode===u.getValue(),prevEditor:nextPrevSection.bind(null,-1),nextEditor:nextPrevSection.bind(null,1),jumpToEditor(e){const t=h.sections[e];t&&(h.updatePositions(t),u.jumpToPos(t.start),u.focus())},async saveImpl(){const t=u.getValue();let o;try{const{customName:n,enabled:i,id:r}=e;o=!r&&await w.API.usercss.build({sourceCode:t,checkDup:!0,metaOnly:!0}),o&&o.dup?c.messageBox.alert((0,s.t)("usercssAvoidOverwriting"),"danger",(0,s.t)("genericError")):(o=await w.API.usercss.editSave({customName:n,enabled:i,id:r,sourceCode:t}),await replaceStyle(o.style),(o.badRe=getBadRegexps(o.style))&&c.messageBox.alert(o.badRe,"danger pre",(0,s.t)("styleBadRegexp"))),showLog(o.log)}catch(t){showSaveError(t,o&&o.style||e)}},scrollToEditor:()=>{}}),r.subscribe("editor.linter",updateLinterSwitch,!0),r.subscribe("editor.appliesToLineWidget",(e,t)=>y.toggle(t),!0),r.subscribe("editor.toc.expanded",(e,t)=>h.onOff(d.default.updateToc,t),!0),e.id&&(u.setValue(e.sourceCode),u.clearHistory(),u.markClean()),n=u.changeGeneration(),u.on("changes",()=>{t.modify("sourceGeneration",n,u.changeGeneration()),d.default.livePreviewLazy(updateLivePreview)}),u.on("optionChange",(e,t)=>{if("mode"!==t)return;const o=getModeName();o!==a&&(a=o,m.run(),updateLinterSwitch())}),setTimeout(m.enableForEditor,0,u),(0,i.$isTextInput)(document.activeElement)||u.focus(),d.default.applyScrollInfo(u)}var M=n(9391),L=n(9209);const P="colorview",I=P+"-swatch",_=`--${I}:`,{RX_COLOR:R,testAt:z}=M,H=(A=[!CSS.supports("color","#abcd")&&/#(.{4}){1,2}$/,!CSS.supports("color","hwb(1 0% 0%)")&&/^hwb\(/,!CSS.supports("color","rgb(1e2,0,0)")&&/\de/,!CSS.supports("color","rgb(1.5,0,0)")&&/^rgba?\((([^,]+,){0,2}[^,]*\.|(\s*\S+\s+){0,2}\S*\.)/,!CSS.supports("color","rgb(1,2,3,.5)")&&/[^a]\(([^,]+,){3}/,!CSS.supports("color","rgb(1,2,3,50%)")&&/\((([^,]+,){3}|(\s*\S+[\s/]+){3}).*?%/,!CSS.supports("color","rgb(1 2 3 / 1)")&&/^[^,]+$/,!CSS.supports("color","hsl(1turn, 2%, 3%)")&&/deg|g?rad|turn/].filter(Boolean).map(e=>e.source).join("|"))&&new RegExp(A);var A;const F=new RegExp('(^|[\\s(){}[\\]:,/"=])('+R.hex.source+"|(?:(?:rgb|hsl)a?|hwb)(?=\\()|(?:"+[...M.NAMED_COLORS.keys()].join("|")+')(?=[\\s;(){}[\\]/"!]|$))',"gi"),N=/((rgb|hsl)a?|hwb)\(/iy,D=/\/\*([^*]+|\*(?!\/))*(\*\/|$)/g,B=/(?:^|\s)(?:atom|keyword|variable callee|builtin)(?:\s|$)/,j=" ".repeat(1e3),U=["atom","keyword","callee","comment","string"];let W=Math.ceil(e.innerHeight/14);const V={changes(e,t){colorizeChanges(e.state.colorpicker,t)},update(e){const t=e.display.cachedTextHeight,o=e.display.lastWrapHeight;if(!o||!t)return;W=Math.max(20,Math.ceil(o/t));const n=e.state.colorpicker;n.colorizeOnUpdate&&(n.colorizeOnUpdate=!1,colorizeAll(n)),e.off("update",V.update)},mousedown(e,t){const o=e.state.colorpicker,n=hitTest(t);dispatchEvent(new CustomEvent("close-colorpicker-popup",{detail:n&&o.popup})),n&&(t.preventDefault(),openPopupForSwatch(o,n))}},K=new Set;class G{constructor(e,t={}){this.cm=e,this.options=t,this.markersToRemove=[],this.markersToRepaint=[],this.popup=(0,L.default)(e),this.popup||(delete V.mousedown,document.head.appendChild(document.createElement("style")).textContent="\n        .colorview-swatch::before {\n          cursor: auto;\n        }\n      "),this.colorize(),this.registerEvents()}colorize(){colorizeAll(this)}openPopup(e){this.popup&&openPopupForCursor(this,e)}registerEvents(){for(const e in V)this.cm.on(e,V[e])}unregisterEvents(){for(const e in V)this.cm.off(e,V[e])}destroy(){this.unregisterEvents();const{cm:e}=this,{curOp:t}=e;t||e.startOperation(),e.getAllMarks().forEach(e=>e.className===P&&e.clear()),t||e.endOperation(),e.state.colorpicker=null}}function colorizeAll(e){const{cm:t}=e,{viewFrom:o,viewTo:n}=t.display;if(!n)return void(e.colorizeOnUpdate=!0);const{curOp:i}=t;i||t.startOperation(),e.line=o,e.inComment=null,e.now=performance.now(),e.stopAt=e.stopped=null,t.doc.iter(o,n,t=>colorizeLine(e,t)),updateMarkers(e),i||t.endOperation(),(o>0||n<t.doc.size)&&(clearTimeout(e.colorizeTimer),e.line=0,e.colorizeTimer=setTimeout(colorizeInvisible,100,e,o,n))}function colorizeInvisible(e,t,o){const{cm:n}=e,{curOp:i}=n;i||n.startOperation(),e.now=performance.now(),e.stopAt=e.now+50,e.stopped=null,n.eachLine(e.line,t,t=>colorizeLine(e,t)),!e.stopped&&o<n.doc.size&&(e.line=Math.max(o,e.line),n.eachLine(e.line,n.doc.size,t=>colorizeLine(e,t))),updateMarkers(e),i||n.endOperation(),e.stopped&&(e.colorizeTimer=setTimeout(colorizeInvisible,0,e,t,o))}function colorizeChanges(e,t){if(1===t.length&&"setValue"===t[0].origin)return void colorizeAll(e);const o=[],n=[],i=e.cm.display.viewFrom||0,s=e.cm.display.viewTo||i+W;for(let e of t){const{from:t}=e,r=l().changeEnd(e);t.line>s||r.line<i?n.push(e):(t.line<i&&(n.push(Object.assign({},e,{to:{line:i-1}})),e=Object.assign({},e,{from:{line:i}})),r.line>s&&(n.push(Object.assign({},e,{from:{line:s+1}})),e=Object.assign({},e,{to:{line:s}})),o.push(e))}o.length&&colorizeChangesNow(e,o),n.length&&setTimeout(colorizeChangesNow,0,e,n,!0)}function colorizeChangesNow(e,t,o){const{cm:n}=e,{curOp:i}=n;i||n.startOperation(),e.now=performance.now();const s=o&&e.now+50;let r,a,c=null,d=-1,u=-1;const p=(t=t.sort((e,t)=>e.from.line-t.from.line||e.from.ch-t.from.ch))[0].from.line,f=l().changeEnd(t[t.length-1]).line;let h=e.line=p;n.doc.iter(p,f+1,n=>{if(h>d){if(r=t[++u],!r)return!0;a=r.from.line,d=l().changeEnd(r).line}if(a<=h&&h<=d&&(e.line=h,n.styles||e.cm.getTokenTypeAt({line:h,ch:0}),colorizeLineViaStyles(e,n)),o&&(e.now=performance.now())>s)return c=!0,!0;h++}),updateMarkers(e),i||n.endOperation(),c&&(h>=a&&h<d?(t.splice(0,u),t[0]=Object.assign({},t[0],{from:{line:h}})):t.splice(0,u+1),e.colorizeTimer=setTimeout(colorizeChangesNow,0,e,t,!0))}function colorizeLine(e,t){if(e.stopAt&&(e.now=performance.now())>e.stopAt)return e.stopped=!0,!0;const{text:o,styles:n}=t,{cm:i}=e;if(null===e.inComment&&!n)return i.getTokenTypeAt({line:e.line,ch:0}),void colorizeLineViaStyles(e,t);if(n)return void colorizeLineViaStyles(e,t);let s=0,r=0;do{if(e.inComment){if(r=o.indexOf("*/",s),r<0)break;e.inComment=!1,r+=2}s=(o.indexOf("/*",r)+1||o.length+1)-1;const n=r||s!==o.length?o.slice(r,s):o;F.lastIndex=0;const a=F.exec(n);if(a){r+=a.index+a[1].length,i.getTokenTypeAt({line:e.line,ch:0});const{index:o}=getStyleAtPos({styles:t.styles,pos:r})||{};return void colorizeLineViaStyles(e,t,Math.max(1,o||0))}e.inComment=s<o.length}while(e.inComment);e.line++}function colorizeLineViaStyles(e,t,o=1){const{styles:n}=t;let i,s,r,a,l,c,d,u,{text:p}=t,f=0,h=!1,{markedSpans:m}=t,g=!1,y=m&&m.length;const b=e.now,v=p.endsWith("*/");for(let e=o;e+1<n.length;e+=2){if(s=n[e+1],!s||!B.test(s))continue;if(r=e>2?n[e-2]:0,a=n[e],l=a-r,c="#"===p[r],d="("===p[a],d&&(l<3||l>4||!z(N,r,p)))continue;d&&!h&&(p=blankOutComments(p,r),h=!0),u=p.slice(r,d?p.indexOf(")",a)+1:a);const t=!c&&!d&&u.indexOf("!");t>0&&(u=u.slice(0,t),a=r+t);const o=m&&checkSpan();"same"!==o&&checkColor()&&(o?redeem:mark)(getSafeColorValue())}return function(){if(y)for(const t of m)t.generation!==b&&t.marker.className===P&&e.markersToRemove.push(t.marker)}(),e.inComment=s&&s.includes("comment")&&!v,void e.line++;function checkColor(){if(c)return z(R.hex,0,u);if(!d)return M.NAMED_COLORS.has(u.toLowerCase());const e=u.toLowerCase();if(K.has(e))return!0;const t=u.substr(0,3),o=u.slice(l+1,-1);return!!z(R[t],0,o)&&(K.add(e),!0)}function mark(t){const{line:o}=e;e.cm.markText({line:o,ch:r},{line:o,ch:a},{className:P,startStyle:I,css:_+t,color:u})}function getSafeColorValue(){if(c&&5!==u.length&&9!==u.length)return u;if(!H||!H.test(u))return u;const e=M.parse(u);return M.format(e,"rgb")}function checkSpan(){for(g||(m=m.sort((e,t)=>e.from-t.from),g=!0);f<m.length&&(i=m[f],i.from<=r);)if(f++,i.from===r&&i.marker.className===P)return y--,i.generation=b,u===i.marker.color&&(d||/\W|^$/i.test(p.substr(r+u.length,1)))?"same":(e.markersToRemove.push(i.marker),"redeem")}function redeem(t){y++,e.markersToRemove.pop(),e.markersToRepaint.push(i),i.to=a,i.line=e.line,i.index=f-1,i.marker.color=u,i.marker.css=_+t}}function openPopupForCursor(e,t){const{line:o,ch:n}=e.cm.getCursor(),i=e.cm.getLineHandle(o),s={line:o,ch:n,color:t,isShortCut:!0};let r;for(const{from:e,marker:t}of i.markedSpans||[])if(t.className===P&&e<=n&&n<e+t.color.length){r={color:t.color,ch:e};break}r=r||findNearestColor(i,n),doOpenPopup(e,Object.assign(s,r)),r&&highlightColor(e,s)}function openPopupForSwatch(e,t){const o=e.cm,n=t.closest("div"),{line:{markedSpans:i}={}}=o.display.renderedView.find(e=>e.node===n)||{};if(!i)return;let s=[...n.getElementsByClassName(I)].indexOf(t);for(const{marker:t}of i.sort((e,t)=>e.from-t.from))if(t.className===P&&0==s--){const o=Object.assign({color:t.color},t.find().from);highlightColor(e,o),doOpenPopup(e,o);break}}function doOpenPopup(e,t){const{left:o,bottom:n}=e.cm.charCoords(t,"window");e.popup.show(Object.assign(e.options.popup,t,{top:n,left:o,cm:e.cm,color:t.color,prevColor:t.color||"",callback:popupOnChange,palette:makePalette(e),paletteCallback}))}function popupOnChange(e){if(!e)return;const{cm:t,line:o,ch:n,embedderCallback:i}=this,s={line:o,ch:n+this.prevColor.length},r={line:o,ch:n};t.getRange(r,s)!==e&&(t.replaceRange(e,r,s,"*colorpicker"),this.prevColor=e),"function"==typeof i&&i(this)}function makePalette({cm:e,options:t}){const o=new Map;let n,i=0;e.eachLine(({markedSpans:e})=>{if(++i,e)for(const{from:t,marker:s}of e){if(null==t||s.className!==P)continue;const e=s.color.toLowerCase();n=o.get(e),n||o.set(e,n=[]),n.push(i)}});const s=[];if(o.size>1||n&&n.length>1){const e=new Map(t.popup.palette?.map(e=>[e.__color,e]));for(const[n,i]of o){const o=i.join(", ");let r=e.get(n);r||(r=document.createElement("div"),r.__color=n,r.className=I,r.style.setProperty(`--${I}`,n)),r.__str!==o&&(r.__str=o,r.title=`${n}\n${t.popup.paletteLine} ${o.length>50?o.replace(/([^,]+,\s){10}/g,"$&\n"):o}`),s.push(r)}s.push(Object.assign(document.createElement("span"),{className:"colorpicker-palette-hint",title:t.popup.paletteHint,textContent:"?"}))}return s}function paletteCallback(e){const{cm:t}=this,o=e.title.split("\n")[1].match(/\d+/g).map(Number),n=o.indexOf(t.getCursor().line+1)+1,i=(o[n]||o[0])-1;t.jumpToPos({line:i,ch:0})}function updateMarkers(e){e.markersToRemove.forEach(e=>e.clear()),e.markersToRemove.length=0;const{cm:{display:{viewFrom:t,viewTo:o,view:n}}}=e;let i=0,s=n[0],r=t;for(const{line:a,index:l,marker:c}of e.markersToRepaint){if(a<t||a>=o)continue;for(;r<a&&s;)r+=s.size,s=n[++i];if(!s)break;const e=s.text.getElementsByClassName(I)[l];e&&(e.style=c.css)}e.markersToRepaint.length=0}function findNearestColor({styles:e,text:t},o){let n,i,s,r,a;for(F.lastIndex=Math.max(0,o-1e3);a=F.exec(t);){n=a.index+a[1].length;const l=a[2].toLowerCase(),{style:c}=getStyleAtPos({styles:e,pos:n+1})||{};if(!c||U.includes(c.split(" ",1)[0]))if("("===t[n+l.length]){const e=blankOutComments(t.slice(n),0);i=e.slice(0,e.indexOf(")")+1);const o=i.slice(0,3),s=i.slice(l.length+1,-1);i=z(R[o],0,s)&&i}else i=("#"===l[0]||M.NAMED_COLORS.has(l))&&l;else i="";if(i){if(n>=o)break;s=n,r=i}}return r&&o-(s+r.length)<n-o?{color:r,ch:s}:i?{color:i,ch:n}:void 0}function highlightColor(e,t){const{line:o}=t,{cm:n}=e,{viewFrom:i,viewTo:s}=n.display;if(o<i||o>s)return;const r=n.charCoords(t),a=t.ch+t.color.length-1;let l=n.charCoords({line:o,ch:a});if(l.top!==r.top){const e=t.ch+t.color.indexOf("(")-1;l=n.charCoords({line:o,ch:e})}const c=document.createElement("div");c.style=`\n    position: absolute;\n    display: block;\n    top: ${r.top}px;\n    left: ${r.left}px;\n    width: ${l.right-r.left}px;\n    height: ${l.bottom-r.top}px;\n    animation: highlight 0.5s;\n  `,document.body.appendChild(c),setTimeout(()=>c.remove(),500)}function getStyleAtPos({line:e,styles:t=this.getLineHandle(e).styles,pos:o}){if(o<0||!t)return;const n=t.length,i=t[n-2];if(o>i)return;if(o===i)return{style:t[n-1],index:n-2};const s=1+(o/i*(n-1)&-2);let r,a=s;for(;a>1&&t[a]>o;)r=a,a=1+(a/2&-2);for(r||(r=s);r<n&&t[r]<o;)r=1+((n+r)/2&-2);for(;a<r-3;){const e=1+((a+r)/2&-2);t[e]>o?r=e:a=e}for(;a<n&&t[a]<o;)a+=2;return{style:t[a+1],index:a}}function blankOutComments(e,t){const o=e.indexOf("/*",t);return o<0?e:e.slice(0,o)+e.slice(o).replace(D,e=>j.repeat(e.length/1e3|0)+j.slice(0,e.length%1e3))}function hitTest({button:e,target:t,offsetX:o,offsetY:n}){if(e)return;const i=t.closest("."+P);if(!i)return;const{left:s,width:r,height:a}=getComputedStyle(i,"::before"),l=i.getBoundingClientRect();return o>=parseFloat(s)-1&&o<=parseFloat(s)+parseFloat(r)+1&&n>=parseFloat(a)/2-l.height/2-1&&n<=parseFloat(a)/2+l.height/2+1&&i}l().defineOption("colorpicker",!1,(e,t,o)=>{o&&o!==l().Init&&e.state.colorpicker&&e.state.colorpicker.destroy(),t&&(e.state.colorpicker=new G(e,t))}),l().prototype.getStyleAtPos=getStyleAtPos;const{defaults:Y,commands:q}=u.CodeMirror;function invokeColorpicker(e){e.state.colorpicker.openPopup(r.get("editor.colorpicker.color"))}r.subscribe("editor.colorpicker.hotkey",(e,t)=>{q.colorpicker=invokeColorpicker;for(const e in u.extraKeys)if("colorpicker"===u.extraKeys[e]){delete u.extraKeys[e];break}t&&(u.extraKeys[t]="colorpicker")},!0),r.subscribe("editor.colorpicker",(e,t)=>{const o=r.get("editor.colorpicker.hotkey");Y.colorpicker=t,t?(o&&(q.colorpicker=invokeColorpicker,u.extraKeys[o]="colorpicker"),Y.colorpicker={tooltip:(0,s.t)("colorpickerTooltip"),popup:{tooltipForSwitcher:(0,s.t)("colorpickerSwitchFormatTooltip"),paletteLine:(0,s.t)("numberedLine"),paletteHint:(0,s.t)("colorpickerPaletteHint"),hexUppercase:r.get("editor.colorpicker.hexUppercase"),embedderCallback:e=>{["hexUppercase","color"].filter(t=>e[t]!==r.get("editor.colorpicker."+t)).forEach(t=>r.set("editor.colorpicker."+t,e[t]))},get maxHeight(){return r.get("editor.colorpicker.maxHeight")},set maxHeight(e){r.set("editor.colorpicker.maxHeight",e)}}}):delete u.extraKeys[o],C.default.globalSetOption("colorpicker",Y.colorpicker)},!0);const X="editor.livePreview";let Z,Q,J,ee,te=r.get(X);function createPreviewer(){ee=chrome.runtime.connect({name:"livePreview:"+d.default.style.id}),ee.onDisconnect.addListener(()=>ee=null),Q=(0,i.$)("#preview-errors"),Q.onclick=showError}function showError(){if(Z){const e=d.default.getEditors()[0];e.setCursor(Z),e.focus()}}async function updatePreviewer(e){try{await w.API.styles.preview(e),Q.hidden=!0}catch(t){const o=e.usercssData,n=o&&o.preprocessor,i=t._varLines+1||0;Z=n&&t.line&&t.column?{line:t.line-i,ch:t.column-1}:t.index,t=Array.isArray(t)?t.map((e,t,o)=>(t=e.message)?(o=e.context)?`${t} in ${o}`:t:e).join("\n"):t.message||`${t}`,Z>=0?Z=d.default.getEditors()[0].posFromIndex(Z):"stylus"===n&&(Z=t.match(/^\w+:(\d+):(\d+)(?:\n.+)+\s+(.+)/))&&(t=Z[3],Z={line:Z[1]-i,ch:Z[2]-1}),Q.title=Q.firstChild.textContent=(Z?`${Z.line+1}:${Z.ch+1} `:"")+t,Q.lastChild.hidden=!(Q.lastChild.href=d.default.ppDemo[n]),Q.hidden=!1}}r.subscribe(X,(e,t)=>{t?J&&J.id&&(J.enabled||d.default.dirty.has("enabled"))&&(createPreviewer(),updatePreviewer(J)):ee&&(ee.disconnect(),ee=null),te=t}),d.default.livePreview=e=>{if(!ee){if(!te||!e.id||!e.enabled&&J&&!J.enabled||!d.default.dirty.isDirty())return;createPreviewer()}J=e,updatePreviewer(J)};var oe=n(1679);function USWIntegration(){const e="UserStyles.world "+(0,s.t)("genericError"),t=["name","description","license","username>author","homepage","namespace"],o=(0,i.$)("#usw-progress"),n=(0,i.$)("#publish"),r=(0,i.$)("#usw-publish-style"),a=d.default.style;let l,u=0,f="";async function publishStyle(){const{id:t,_usw:n}=a;if(await w.API.data.has("usw"+t)&&!await c.messageBox.confirm((0,s.t)("publishRetry"),"danger",e))return;let r;const l=d.default.getValue(),u=l!==f,p=u?await w.API.usw.publish(t,l,n).catch(e=>r=e.message):(0,s.t)("importReportUnchanged"),h=`${(new Date).toLocaleString()}\n${p}`,m=r||/^Error:/.test(p);o.append(...m?[(0,i.$create)("a.error",{title:h,tabIndex:0,"data-cmd":"note"},p),n&&n.token&&(0,i.$create)("div",(0,s.t)("publishReconnect"))].filter(Boolean):[(0,i.$create)("span."+(u?"success":"unchanged"),{title:h})]),m||(f=l)}async function disconnect(){await w.API.usw.revoke(a.id),f=null}function updateUI(){const e=a._usw||!1,o=(0,i.$)("#usw-url"),r=(0,i.$)("#usw-data"),l=e.token;if((0,i.toggleDataset)(n,"connected",l),n.classList.toggle("ignore-pref",!l),l||(n.open=!1),o.href=`${oe.usw}${e.id?`style/${e.id}`:""}`,o.textContent=(0,s.t)("publishUsw").replace(/<(.+)>/,"$1"+(e.id?`#${e.id}`:"")),!(r.hidden=d.default.isUsercss))for(const o of t){const[t,n=t]=o.split(">"),s=e[t]||"",l="usw-data-"+n;let c=(0,i.$)("#"+l);c||(c=(0,i.$create)("input",{id:l,_from:t,placeholder:"name"===o?a[o]:""}),c.on("input",onDataChanged),r.appendChild((0,i.$create)([(0,i.$create)("label",{htmlFor:l},"@"+n),c]))),c.value=s,onDataChanged.call(c)}}function onDataChanged(){const e=this.value.trim(),t=a._usw||e&&(a._usw={}),o=this._from;d.default.dirty.modify(this.id,t&&t[o]||"",e),t&&(e?t[o]=e:delete t[o]&&(0,p.isEmptyObj)(t)&&(a._usw=null)),this.parentElement.classList.toggle("empty",!e)}(0,w.onExtension)(e=>{if("uswData"===e.method&&e.style.id===a.id){Object.assign(a,e.style);for(const e of(0,i.$$)("#usw-data input"))d.default.dirty.clear(e.id);updateUI()}}),updateUI(),r.onclick=(0,i.$)("#usw-disconnect").onclick=async function(){this.disabled=!0,u||(o.textContent="",u=setTimeout(()=>l=(0,c.showSpinner)(o),250)),await(this===r?publishStyle:disconnect)().catch(console.error),(0,i.$remove)(l),clearTimeout(u),u=0,l=null,this.disabled=!1}}n(7337);var ne=n(4435);function EmbeddedPopup(){const t="popup-iframe",o="#"+t,n="Shift-Ctrl-Alt-S";let a,l,d;const p=(0,i.$create)("img",{id:"popup-button",title:(0,s.t)("optionsCustomizePopup")+"\n"+n,onclick:embedPopup});function embedPopup(){(0,i.$)(o)||(l=!1,d=0,a=(0,i.$create)("iframe",{id:t,src:oe.actionPopupUrl,height:600,width:r.get("popupWidth"),onload:initFrame}),e.on("mousedown",removePopup),document.body.appendChild(a))}function initFrame(){a=this,a.focus();const e=a.contentWindow,t=e.document.body;e.on("keydown",removePopupOnEsc),e.close=removePopup,new e.IntersectionObserver(onIntersect).observe(t.appendChild((0,i.$create)("div",{style:{height:"1px",marginTop:"-1px"}}))),new e.MutationObserver(onMutation).observe(t,{attributes:!0,attributeFilter:["style"]})}function onMutation(){const e=a.contentDocument.body,t=e.style,o=parseFloat(t.minWidth||t.width)+(d||0),n=parseFloat(t.minHeight||e.offsetHeight);a.width-o&&(a.width=o),a.height-n&&(a.height=n)}function onIntersect([e]){const t=a.contentWindow,o=t.document.scrollingElement,n=e.intersectionRatio&&!t.scrollY?o.offsetHeight:o.scrollHeight,i=n>o.offsetHeight,{width:s}=e.boundingClientRect;a.height=n,(!i!=!d||a.width-s)&&(d=i?s-o.offsetWidth:0,a.width=s+d),l||(l=!0,a.dataset.loaded="")}function removePopup(){a=null,(0,i.$remove)(o),e.off("mousedown",removePopup)}function removePopupOnEsc(e){"Escape"===(0,c.getEventKeyName)(e)&&removePopup()}i.$.root.appendChild(p),i.$.rootCL.add("popup-window"),document.body.appendChild(p),u.extraKeys[n]="openStylusPopup",r.subscribe("iconset",(e,t)=>{const o=`${k.MF_ICON_PATH}${t?"light/":""}`;p.srcset=`${o}16${k.MF_ICON_EXT} 1x,${o}32${k.MF_ICON_EXT} 2x`},!0),e.on("keydown",e=>{(0,c.getEventKeyName)(e)===n&&embedPopup()})}let ie;if(k.browserWindows){!async function(){chrome.tabs.onAttached.addListener(onTabAttached);const e=["app","popup"].includes((await k.browserWindows.getCurrent()).type);e&&EmbeddedPopup(),d.default.isWindowed=e||1===history.length&&r.get("openEditInWindow")&&(await k.browserWindows.getAll()).length>1&&1===(await browser.tabs.query({currentWindow:!0})).length}();const e=(0,p.tryJSONparse)(p.sessionStore.windowPos);delete p.sessionStore.windowPos,e&&null!=e.left&&k.browserWindows.update(k.browserWindows.WINDOW_ID_CURRENT,e)}async function onTabAttached(e,t){if(e!==ie)return;if(0!==t.newPosition)return void r.set("openEditInWindow",!1);const o=1===(await k.browserWindows.get(t.newWindowId,{populate:!0})).tabs.length;o&&ne.FIREFOX&&k.browserWindows.update(t.newWindowId,r.get("windowPosition")),r.set("openEditInWindow",o)}(0,k.getOwnTab)().then(e=>{ie=e.id,p.sessionStore["manageStylesHistory"+ie]===location.href&&(d.default.cancel=()=>history.back())}),(0,s.tBody)(),(async()=>{v&&await v,EditorHeader(),USWIntegration(),(d.default.isUsercss?SourceEditor:SectionsEditor)(),d.default.dirty.onChange(d.default.updateDirty),r.subscribe("editor.linter",()=>m.run()),CompactHeader(),n.e("edit_lazy-init_js").then(n.bind(n,7281));const e=l().commands;for(const t of["find","findNext","findPrev","replace","replaceAll"])e[t]=async(...o)=>{await n.e("edit_global-search_js").then(n.bind(n,2508)),e[t](...o)};(0,i.$)("#name").required=!d.default.isUsercss,(0,i.$)("#save-button").onclick=d.default.save,(0,i.$)("#cancel-button").onclick=d.default.cancel,(0,i.$)("#testRE").onclick=async function(){(this.onclick=(await n.e("edit_regexp-tester_js").then(n.bind(n,2421))).toggle)(!0)},(0,i.$)("#lint-help").onclick=async function(){(this.onclick=(await n.e("edit_linter_dialogs_js").then(n.bind(n,2416))).showLintHelp)()},(0,i.$)("#linter-settings",s.template.editorSettings).onclick=async function(){(this.onclick=(await n.e("edit_linter_dialogs_js").then(n.bind(n,2416))).showLintConfig)()},(0,i.$)("#keyMap-help",s.template.editorSettings).onclick=async function(){(this.onclick=(await n.e("edit_show-keymap-help_js").then(n.bind(n,8945))).default)()};const t=(0,i.$)("#sections-list"),o=(0,i.$)("#toc"),a=new MutationObserver(([{target:e}])=>{if(!e.open)return;e===t&&d.default.updateToc();const o=e.lastElementChild,n=o.style;e.getBoundingClientRect().left+o.getBoundingClientRect().width>innerWidth-30?n.right="0":n.right&&n.removeProperty("right")});t.open&&d.default.updateToc();for(const e of(0,i.$$)("#details-wrapper > details"))a.observe(e,{attributes:!0,attributeFilter:["open"]});o.onclick=e=>d.default.jumpToEditor([].indexOf.call(o.children,e.target))})()},923:(e,t,o)=>{o.d(t,{DEFAULTS:()=>s});const n={severity:"warning"},i=[!0,n],s={stylelint:{rules:{"at-rule-no-unknown":[!0,{ignoreAtRules:["extend","extends","css","block"],...n}],"block-no-empty":i,"color-no-invalid-hex":i,"declaration-block-no-duplicate-properties":[!0,{ignore:["consecutive-duplicates-with-different-values"],...n}],"declaration-block-no-shorthand-property-overrides":i,"font-family-no-duplicate-names":i,"function-calc-no-unspaced-operator":i,"function-linear-gradient-no-nonstandard-direction":i,"keyframe-declaration-no-important":i,"media-feature-name-no-unknown":i,"no-invalid-double-slash-comments":i,"property-no-unknown":i,"selector-pseudo-class-no-unknown":i,"selector-pseudo-element-no-unknown":i,"string-no-newline":i,"unit-no-unknown":i}},csslint:{"display-property-grouping":1,"duplicate-properties":1,"empty-rules":1,errors:1,"globals-in-document":1,"known-properties":1,"known-pseudos":1,"selector-newline":1,"shorthand-overrides":1,"simple-not":1,warnings:1}}},7868:(e,t,o)=>{o.d(t,{disableForEditor:()=>disableForEditor,enableForEditor:()=>enableForEditor,onLintingUpdated:()=>onLintingUpdated,onUnhook:()=>onUnhook,refreshReport:()=>m.refreshReport,register:()=>register,run:()=>run});const n=new Map,i=[],s=[],r=[];var a=o(7209),l=o(2691),c=o(4523),d=o(9250),u=o(6100),p=o(923);const f=new Map,h={csslint:{validMode:e=>"css"===e,getConfig:e=>Object.assign({},p.DEFAULTS.csslint,e),lint:async(e,t)=>(t.doc=!d.default.isUsercss,(await u.worker.csslint(e,t)).map(({line:e,col:t,message:o,rule:n,type:i})=>e&&{message:o,from:{line:e-1,ch:t-1},to:{line:e-1,ch:t},rule:n.id,severity:i}).filter(Boolean))},stylelint:{validMode:()=>!0,getConfig:e=>({rules:Object.assign({},p.DEFAULTS.stylelint.rules,e&&e.rules)}),lint:(e,t,o)=>u.worker.stylelint({code:e,config:t,mode:o})}};async function getConfig(e){const t=await(0,a.getLZValue)(a.LZ_KEY[e]),o=h[e].getConfig(t);return f.set(e,o),o}register(async(e,t,o)=>{const n=l.get("editor.linter");if(n){const{mode:t}=o.options,i=Object.entries(h).sort(([e])=>e===n?-1:1);for(const[o,n]of i)if(n.validMode(t)){const n=f.get(o)||await getConfig(o);return h[o].lint(e,n,t)}}}),c.onStorageChanged.addListener(e=>{for(const t of Object.keys(h))a.LZ_KEY[t]in e&&getConfig(t).then(run)});var m=o(1386);function disableForEditor(e){e.setOption("lint",!1),n.delete(e);for(const t of r)t(e)}function enableForEditor(e,t){n.has(e)||(n.set(e,null),t?enableOnProblems(e,t):e.setOption("lint",{getAnnotations,onUpdateLinting}))}function onLintingUpdated(e){s.push(e)}function onUnhook(e){r.push(e)}function register(e){i.push(e)}function run(){for(const e of n.keys())e.performLint()}async function enableOnProblems(e,t){const o=await getAnnotations(t,{},e);o.length||e.display.renderedView?(n.set(e,o),e.setOption("lint",{getAnnotations:getCachedAnnotations,onUpdateLinting})):n.delete(e)}async function getAnnotations(...e){const t=await Promise.all(i.map(t=>t(...e)));return[].concat(...t.filter(Boolean))}function getCachedAnnotations(e,t,o){const i=n.get(o);return n.set(o,null),o.state.lint.options.getAnnotations=getAnnotations,i}function onUpdateLinting(...e){for(const t of s)t(...e)}},1386:(e,t,o)=>{o.d(t,{getIssues:()=>getIssues,refreshReport:()=>refreshReport});var n=o(6001),i=o(9521),s=o(7868),r=o(9250);const a=new Map;function getIssues(){const e=new Set;for(const t of a.values())for(const o of t.trs)e.add(o.getAnnotation());return e}function refreshReport(){for(const e of a.values())e.updateCaption()}function updateCount(){const e=Array.from(a.values()).reduce((e,t)=>e+t.trs.length,0);(0,n.$)("#lint").hidden=!e,(0,n.$)("#issue-count").textContent=e}function findNextSibling(e){const t=r.default.getEditors();let o=t.indexOf(e)+1;for(;o<t.length;){if(a.has(t[o]))return t[o];o++}}function createTable(e){const t=(0,n.$create)(".caption"),o=(0,n.$create)("table"),s=(0,n.$create)(".report",[t,o]),a=[];return{element:s,trs:a,updateAnnotations:function(e){let t=0;for(const n of function*(){for(const t of e.filter(Boolean))yield*t}()){let e;t<a.length?e=a[t]:(e=createTr(),a.push(e),o.appendChild(e.element)),e.update(n),t++}if(0===t)a.length=0,o.textContent="";else for(;a.length>t;)a.pop().element.remove();s.classList.toggle("empty",!a.length)},updateCaption:function(){const o=r.default.getEditorTitle(e);Object.assign(t,"string"==typeof o?{textContent:o}:o)}};function createTr(){let t;const o=(0,n.$create)("div"),s=(0,n.$create)("td",{"attr:role":"severity"},o),r=(0,n.$create)("td",{"attr:role":"line"}),a=(0,n.$create)("td",{"attr:role":"col"}),l=(0,n.$create)("td",{"attr:role":"message"}),c=(0,n.$create)("tr",{onclick:()=>gotoLintIssue(e,t)},[s,r,(0,n.$create)("td",{"attr:role":"sep"},":"),a,l]);return{element:c,update:function(e){t=e,c.className=t.severity,s.dataset.rule=t.rule,o.className=`CodeMirror-lint-marker CodeMirror-lint-marker-${t.severity}`,o.textContent=t.severity,r.textContent=t.from.line+1,a.textContent=t.from.ch+1,l.title=(0,i.clipString)(t.message,1e3)+(t.rule?`\n(${t.rule})`:""),l.textContent=(0,i.clipString)(t.message,100).replace(/ at line.*/,"")},getAnnotation:()=>t}}}function gotoLintIssue(e,t){r.default.scrollToEditor(e),e.focus(),e.jumpToPos(t.from)}s.onLintingUpdated((e,t,o)=>{let i=a.get(o);if(!i){i=createTable(o),a.set(o,i);const e=(0,n.$)(".lint-report-container"),t=findNextSibling(o);e.insertBefore(i.element,t&&a.get(t).element)}i.updateCaption(),i.updateAnnotations(t),updateCount()}),s.onUnhook(e=>{const t=a.get(e);t&&(t.element.remove(),a.delete(e)),updateCount()})},6100:(t,o,n)=>{n.d(o,{createHotkeyInput:()=>createHotkeyInput,helpPopup:()=>f,rerouteHotkeys:()=>h,showCodeMirrorPopup:()=>showCodeMirrorPopup,trimCommentLabel:()=>trimCommentLabel,worker:()=>m});var i=n(6759),s=n(6001),r=n(9030),a=n(6308),l=n(838),c=n(2691),d=n(9521),u=n(1679),p=n(9250);const f={SEL:"#help-popup",show(t="",o,n={}){const{"data-id":i=(n["data-id"]=t)}=n,l=(0,s.$create)(f.SEL,n),c=i&&(0,s.$)(`#help-popup[data-id="${CSS.escape(i)}"] > .i-close`);return c&&c.click(),l.append(l._close=(0,s.$create)("i.i-close",{onclick:f.close}),l._title=(0,s.$create)(".title",t),l._contents=(0,s.$create)(".contents",o&&(0,a.tHTML)(o))),document.body.append(l),l.onClose=new Set,e.on("keydown",f.close,!0),f.originalFocus=document.activeElement,(0,r.moveFocus)(l,0),l},close(t){let o;const n=!(t&&"click"!==t.type&&("Escape"!==(0,r.getEventKeyName)(t)||(0,s.$)(".CodeMirror-hints, #message-box")||(o=document.activeElement)&&o.closest("#search-replace-dialog"))),i=t&&t.target.closest(f.SEL)||[...(0,s.$$)(f.SEL)].pop();if(n&&i){if(!t||!(o=i.codebox)||o.options.readOnly||o.isClean()){i.contains(document.activeElement)&&(o=f.originalFocus)&&o.focus(),i.remove();for(const e of i.onClose)e();return(0,s.$)(f.SEL)||e.off("keydown",f.close,!0),!0}setTimeout(async()=>await r.messageBox.confirm((0,a.t)("confirmDiscardChanges"))&&f.close())}}},h={commands:["beautify","colorpicker","find","findNext","findPrev","jumpToLine","nextEditor","prevEditor","replace","replaceAll","save","toggleEditorFocus","toggleStyle"],toggle(e){document[e?"on":"off"]("keydown",h.handler)},handler(e){const t=i.CodeMirror.keyName(e);if(!t)return;const rerouteCommand=t=>{if(h.commands.includes(t))return i.CodeMirror.commands[t](p.default.closestVisible(e.target)),!0};"handled"!==i.CodeMirror.lookupKey(t,i.CodeMirror.defaults.keyMap,rerouteCommand)&&"handled"!==i.CodeMirror.lookupKey(t,i.extraKeys,rerouteCommand)||(e.preventDefault(),e.stopPropagation())}},m=(0,l.createPortProxy)(u.workerPath);function createHotkeyInput(e,{buttons:t=!0,onDone:o}){const n=new RegExp("^("+[/Space/,/(Shift-)?./,/(?=.)(Shift-?|Ctrl-?|Control-?|Alt-?|Meta-?)*(Escape|Tab|Page(Up|Down)|Arrow(Up|Down|Left|Right)|Home|End)?/].map(e=>e.source||e).join("|")+")$","i"),i=c.get(e),l=(0,s.$create)("input",{spellcheck:!1,onpaste:e=>onkeydown(e,e.clipboardData.getData("text")),onkeydown});t=t&&[["confirmOK","Enter"],["undo",i],["genericResetLabel",""]].map(([e,t])=>(0,s.$create)("button",{onclick:e=>onkeydown(e,t)},(0,a.t)(e)));const[d,u,p]=t||[];return onkeydown(null,i),t?(0,s.$create)("fragment",[l,(0,s.$create)(".buttons",t)]):l;function onkeydown(s,f){let h;switch(s&&"keydown"===s.type&&(f=(0,r.getEventKeyName)(s)),s&&f){case"Tab":case"Shift-Tab":return;case"BackSpace":case"Delete":h="";break;case"Enter":l.checkValidity()&&o&&o(s);break;case"Escape":o&&o(s);break;default:h=f.replace(/\b.$/,e=>e.toUpperCase())}if(null!=h){const o=n.test(h)?(0,a.t)("genericError"):"";s&&!o&&c.set(e,h),l.setCustomValidity(o),l.value=h,l.focus(),t&&(d.disabled=Boolean(o),u.disabled=h===i,p.disabled=!h)}s&&(s.preventDefault(),s.stopPropagation())}}function showCodeMirrorPopup(t,o,n){const a=f.show(t,o,{className:"big"});let l=a.codebox=(0,i.CodeMirror)(a._contents,Object.assign({mode:"css",lineNumbers:!0,lineWrapping:c.get("editor.lineWrapping"),foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter","CodeMirror-lint-markers"],matchBrackets:!0,styleActiveLine:!0,theme:c.get(i.THEME_KEY),keyMap:c.get("editor.keyMap")},n));l.focus(),s.$.root.style.pointerEvents="none",a.style.pointerEvents="auto";const onKeyDown=e=>{if("Tab"===e.key&&!e.ctrlKey&&!e.altKey&&!e.metaKey){const t=(0,s.$)("#search-replace-dialog"),o=t&&t.contains(document.activeElement)?t:a;(0,r.moveFocus)(o,e.shiftKey?-1:1),e.preventDefault()}};return e.on("keydown",onKeyDown,!0),a.onClose.add(()=>{e.off("keydown",onKeyDown,!0),s.$.root.style.removeProperty("pointer-events"),l=a.codebox=null}),a}function trimCommentLabel(e,t=1e3){return(0,d.clipString)(e.replace(/^[!-/:;=\s]*|[-#$&(+,./:;<=>\s*]*$/g,""),t)}}},e=>{e.O(0,["common-ui","codemirror","css_global-dark_css-css_global_css-css_spinner_css","js_color_color-picker_js"],()=>e(e.s=1501)),e.O()}])}