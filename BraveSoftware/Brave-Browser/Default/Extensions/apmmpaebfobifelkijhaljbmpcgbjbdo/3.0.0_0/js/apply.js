1!==window["apply.js"]&&(()=>{const e=this,t=e;e["apply.js"]=1;const n={},o={get:({name:e},t)=>new Proxy(Object.defineProperty(()=>{},"name",{value:e?e+"."+t:t}),o),apply:function({name:e},t,n){return apiSend({method:"invokeAPI",path:e,args:n})}},r=e.API=new Proxy({path:""},o);let s,a=0;async function apiSend(e){const t=++a,o=new Error;return s||(s=chrome.runtime.connect({name:"api"}),s.onMessage.addListener(apiPortResponse),s.onDisconnect.addListener(apiPortDisconnect)),s.postMessage({id:t,data:e,TDM:self.TDM}),new Promise((e,r)=>n[t]={ok:e,ko:r,err:o})}function apiPortDisconnect(){const e=chrome.runtime.lastError;if(e)for(const t in n)apiPortResponse({id:t,error:e});s=null}function apiPortResponse({id:e,data:t,error:o}){const r=n[e];if(delete n[e],o){const{err:e}=r;e.message=o.message,o.stack&&(e.stack=o.stack+"\n"+e.stack),r.ko(o)}else r.ok(t)}const i={__proto:null,all:["both","tab","extension"],extension:["both","extension"],tab:["both","tab"]},c={both:new Set,tab:new Set,extension:new Set};function off(e){for(const t of i.all)c[t].delete(e)}function _execute(e,...t){let n;for(const o of i[e]||i.all)for(const e of c[o]){let o;try{o=e(...t)}catch(e){o=Promise.reject(e)}void 0!==o&&void 0===n&&(n=o)}return n}function wrapData(e){return{data:e}}function wrapError(e){return{error:Object.assign({message:e.message||`${e}`,stack:e.stack},e)}}chrome.runtime.onMessage.addListener(function({data:e,target:t},n,o){"backgroundReady"===e.method&&s&&apiPortDisconnect();const r=_execute(t,e,n);if(r instanceof Promise)return r.then(wrapData,wrapError).then(o),!0;void 0!==r&&o(wrapData(r))});const l="stylus",d=l+"-",f="screen, "+d,p="adoptedStyleSheets",u=document,m=new Set(["head","body","frameset","style","link"]),g=function(e){let t,n=!1;const o=new MutationObserver(e);return{start:function(){n||v||(M=document.documentElement,t=setTimeout(e),o.observe(document,{childList:!0}),n=!0)},stop:function(){n&&(clearTimeout(t),o.disconnect(),n=!1)}}}(updateRoot),h=function(e){let t=!1;const n=new MutationObserver(e);return{start,stop,restart:function(){t&&(stop(),start())}};function start(){t||v||(n.observe(M,{childList:!0}),t=!0)}function stop(){t&&(n.disconnect(),t=!1)}}(restoreOrder),toSafeChar=e=>String.fromCharCode(65280+e.charCodeAt(0)-32),y=[],b=new Map;let v,E,S,w,k,C,x,O,A,D,L,M=document.documentElement,I=!0,P="",T=0,R=0;function removeId(e){removeStyle(b.get(e))&&emitUpdate()}function toggle(e){I!==(e=!!e)&&(I=e,e?addAllElements():removeAllElements())}function addElement(e,t){if(v){const n=E||u[p].slice();let o=S(n,e);o>=0&&(e=n.splice(o,1)[0]),o=t?S(n,t):-1,o>=0?n.splice(o,0,e):n.push(e),E||(u[p]=n)}else updateRoot().insertBefore(e,t);return e}function addAllElements(){y.length&&(toggleObservers(!1),v?replaceAss(!0):updateRoot().append(...y.map(e=>e.el)),toggleObservers(!0))}function removeElement(e){if(e.remove)e.remove();else if(v){const t=E||u[p].slice(),n=S(t,e);n>=0&&(t.splice(n,1),E||(u[p]=t))}}function removeAllElements(){if(toggleObservers(!1),v)replaceAss();else for(const{el:e}of y)removeElement(e)}function replaceAss(e){const t=y.map(e=>e.el),n=[];for(let e,o=E||u[p],r=0;r<o.length&&(e=o[r]);r++)S(t,e)<0&&n.push(e);e&&n.push(...t),u[p]=n}function apply({cfg:e,sections:t},n){e&&updateConfig(e);const o=n&&new Set;for(const e of t){const{id:t,code:r}=e,s=b.get(t);if(s)(s.code.length!==r.length||s.code.some(arrItemDiff,r)||k&&s.name!==e.name)&&(s.code=r,setTextAndName(s.el,e),s.el.disabled=!1);else{e.el=createStyle(e),b.set(t,e);const n=y.findIndex(t=>D(t,e)>0);y.splice(n<0?y.length:n,0,e)}n&&o.add(t)}if(toggleObservers(!1),n&&y.length>o.size)for(let e,t=y.length;--t>=0;)o.has((e=y[t]).id)||removeStyle(e);I&&(w||applyTransitionPatch(t),restoreOrder()),emitUpdate()}function applyTransitionPatch(e){if(w=!0,"complete"===document.readyState||"hidden"===document.visibilityState||!e.some(e=>e.code.some(e=>e.includes("transition"))))return;const t=createStyle({id:"transition-patch",code:[":not(#\\0):not(#\\0) { transition: none !important }"]});addElement(t),requestAnimationFrame(()=>setTimeout(removeElement,0,t))}function arrItemDiff(e,t){return e!==this[t]}function createStyle(e){let t,{id:n}=e;if(v){n=f+n,t=new CSSStyleSheet({media:n}),setTextAndName(t,e);for(let e,t=E||u[p],o=0;o<t.length;o++)(e=t[o].media).mediaText===n&&(e.mediaText+="-old");return t}if(!x&&(t=initCreationDoc()))return t;if(t=M instanceof SVGSVGElement?A("http://www.w3.org/2000/svg","style"):document instanceof XMLDocument?A("http://www.w3.org/1999/xhtml","style"):O("style"),n){t.id=`${d}${n}`;const e=document.getElementById(t.id);e&&(e.id+="-superseded-by-Stylus")}return t.nonce=P,t.type="text/css",t.classList.add(l),setTextAndName(t,e),t}function setTextAndName(e,{id:n,code:o,name:r}){if(v){o=o.join("");try{e.replaceSync(o)}catch{e.replace(o)}return}if(k&&r&&(e.dataset.name!==r&&(e.dataset.name=r),r=encodeURIComponent(r.replace(/[?#/']/g,toSafeChar)),o=o.concat(`\n/*# sourceURL=${chrome.runtime.getURL(r)}.user.css#${n}${t!==top?"#"+Math.random().toString(36).slice(2):""} */`)),C)return void(e.textContent=o.join(""));let s,a,i;for(s=0,a=o.length,i=e.firstChild;i;s++,i=i.nextSibling)s>=a?i.nodeValue="":i.nodeValue!==o[s]&&(i.nodeValue=o[s]);s<a&&e.append(...o.slice(s))}function toggleObservers(e){if(v&&e)return;const t=e&&I?"start":"stop";g[t](),h[t]()}function emitUpdate(){toggleObservers(y.length),L()}function initCreationDoc(e){x=u;for(let e,t=0;!e&&t<2;t++)return O=x.createElement.bind(x),void(A=x.createElementNS.bind(x))}function removeStyle(e){if(e)return b.delete(e.id),y.splice(y.indexOf(e),1),removeElement(e.el),!0}function restoreOrder(e){let t,n=y.length&&y[0].el;if(n)if(v){E||(v=u[p]);for(let e=y.length,n=v.length-e,o=0;o<e;o++)if(n<0||v[n+o]!==y[o].el){t=!0;break}}else if(n.parentNode!==x.documentElement)t=!0;else{let e=0;for(;n;){if(e<y.length&&n===y[e].el)e++;else if(m.has(n.localName)){t=!0;break}n=n.nextElementSibling}e<y.length&&(t=!0)}else t=!1;if(!t)return;!e||++T<10?addAllElements():console.debug("Stylus ignored wrong order of styles to avoid an infinite loop of mutations.");const o=performance.now();o-R>250&&(T=0,R=o)}function updateConfig(e){if(k=e.name,P=e.nonce||P,C=!P&&false,!v!=!e.ass){removeAllElements(),v=v?null:u[p],v&&(S||(Object.isExtensible(v)&&(E=v),S=Object.call.bind([].indexOf)));for(const e of y)e.el=createStyle(e);addAllElements()}}function updateRoot(){return M!==document.documentElement&&(M=document.documentElement,addAllElements(),h.restart()),M}const j={cfg:{off:!1,top:""}},B=chrome.runtime.id,calcOrder=({id:e},t)=>(t=j.cfg.order)&&1e6*(t.prio[e]||0)||t.main[e]||e+5e5,U=document instanceof XMLDocument,N="styles",_=t!==parent;let V=t.TDM=_?0:document.prerendering?-1:1,F=!1;if(_)try{F=Object.getOwnPropertyDescriptor(parent.location,"href"),F=!!F?.get}catch{}const $=F&&"about:"===location.protocol,X=!CSS.supports("top","1ic")&&(Math.random()||Math.random()),G=`${X}`,J=!_&&matchMedia("(prefers-color-scheme: dark)");let q,z,H,K,Q,W=$?parent.location.href.split("#")[0]:location.href,Y=_;var Z;async function apply_init(){let e;var t;e=$&&("object"==typeof(t=parent[parent.Symbol.for(N)])&&t?JSON.parse(JSON.stringify(t)):t),e?await new Promise(onFrameElementInView):e=!F&&!U&&getStylesViaXhr(),await applyStyles(e),z&&(dispatchEvent(new Event(z)),z=!1)}async function applyStyles(e){q||(e||(e=await r.styles.getSectionsByUrl(W,null,!j.sections)),e.cfg||(e.cfg=j.cfg),Object.assign(j,t[Symbol.for(N)]=e),_||""!==j.cfg.top||(j.cfg.top=location.origin),_||j.cfg.dark===J.matches||J.onchange(J),y.length?apply(j,!0):j.cfg.off||apply(j),toggle(!j.cfg.off))}function getStylesViaXhr(){try{const e=(document.cookie.split(B+"=")[1]||"").split(";")[0];if(!e)return;const t="blob:"+chrome.runtime.getURL(e);document.cookie=`${B}=1; max-age=0; SameSite=Lax`;const n=new XMLHttpRequest;return n.open("GET",t,!1),n.send(),JSON.parse(n.response)}catch{}}function applyOnMessage(e){const{style:t}=e;switch(e.method){case"ping":return!0;case"styleDeleted":removeId(t.id);break;case"styleUpdated":if(!j.sections&&j.cfg.off)break;t.enabled?r.styles.getSectionsByUrl(W,t.id).then(e=>e.sections.length?apply(e):removeId(t.id)):removeId(t.id);break;case"styleAdded":!j.sections&&j.cfg.off||!t.enabled||r.styles.getSectionsByUrl(W,t.id).then(apply);break;case"urlChanged":e.iid===X&&W!==e.url&&(W=e.url,j.sections&&applyStyles(j.cfg.off&&{}));break;case"injectorConfig":apply_updateConfig(e);break;case"backgroundReady":return j.sections&&updateCount(),!0}}function apply_updateConfig({cfg:e}){for(const t in e){const n=e[t];n!==j.cfg[t]&&("top"!==t||_)&&(j.cfg[t]=n,"off"===t?j.sections||j.cfg.off?toggle(!j.cfg.off):H||apply_init():"order"===t?(y.sort(D),I&&addAllElements()):"top"===t?updateExposeIframes():updateConfig(j.cfg))}}function updateExposeIframes(){const e="stylus-iframe",t=document.documentElement;t&&(j.cfg.top&&y.length?t.getAttribute(e)!==j.cfg.top&&t.setAttribute(e,j.cfg.top):t.hasAttribute(e)&&t.removeAttribute(e))}function updateCount(){V<0||(!K&&y.length?(K=chrome.runtime.connect({name:"iframe"}),K.onDisconnect.addListener(()=>K=null)):K&&!y.length&&(K.disconnect(),K=null),Y&&performance.now()>1e3&&(Y=!1),r.updateIconBadge(y.map(e=>e.id),{lazyBadge:Y,iid:X}))}function onFrameElementInView(e){parent[parent.Symbol.for("xo")](frameElement,e),(H||(H=[])).push(e)}function onIntersect(e){for(const t of e)t.intersectionRatio&&(Q.unobserve(t.target),t.target.dispatchEvent(new Event(G)))}function onBFCache(e){e.isTrusted&&e.persisted&&(apiPortDisconnect(),updateCount())}t[Symbol.for("xo")]=(e,t)=>{Q||(Q=new IntersectionObserver(onIntersect,{rootMargin:"100%"})),e.addEventListener(G,t,{once:!0}),Q.observe(e)},J&&(J.onchange=({matches:e})=>{e!==j.cfg.dark&&r.info.set({preferDark:j.cfg.dark=e})}),V<0&&(document.onprerenderingchange=function(e){e.isTrusted&&(V=t.TDM=2,document.onprerenderingchange=null,r.styles.getSectionsByUrl("",0,"cfg").then(apply_updateConfig),updateCount())}),L=function(){q||(updateCount(),_&&updateExposeIframes())},D=(e,t)=>calcOrder(e)-calcOrder(t),apply_init(),Z=applyOnMessage,c.tab.add(Z),addEventListener("pageshow",onBFCache),addEventListener("pagehide",onBFCache),dispatchEvent(new CustomEvent(B,{detail:z=Math.random()})),addEventListener(B,function orphanCheck(e){if(!chrome.runtime.id){if(removeEventListener(B,orphanCheck,!0),removeEventListener("pageshow",onBFCache),removeEventListener("pagehide",onBFCache),J&&(J.onchange=null),H)for(const e of H)e();var t;V<0&&(document.onprerenderingchange=null),H=null,q=!0,t=e.detail,y.length&&(toggleObservers(!1),addEventListener(t,()=>{removeAllElements(),y.length=0,b.clear()},{once:!0})),off(applyOnMessage)}},!0)})();