{const e=this;(self.webpackChunkStylus=self.webpackChunkStylus||[]).push([["edit_global-search_js"],{2508:(t,n,o)=>{o.r(n);var a=o(2255),c=o(6001),r=o(9030),i=o(6308),l=o(6981),s=o(9521),d=o(922),u=o.n(d),p=o(9250);const f={maxMatches:1e4},h="#search-replace-dialog-style",g="search-target-editor",m="search-target-match",S="applies-value",y=/^\s*\/(.+?)\/([simguy]*)\s*$/;let v,b,w,k,O,x,E,$,C,T,A,R,P,I,M,N,V,W,B=!0,D="",U=!0,j=!1,F="",z=0,L=-1,H="";const _=[],q=!p.default.isUsercss,X={key:{Enter:()=>{switch(document.activeElement){case A:case T:"find"===$.dataset.type?doSearch({reverse:!1}):doReplace()}},Esc:()=>{destroyDialog({restoreFocus:!0})}},click:{next:()=>doSearch({reverse:!1}),prev:()=>doSearch({reverse:!0}),close:()=>destroyDialog({restoreFocus:!0}),replace:()=>doReplace(),replaceAll:()=>doReplaceAll(),undo:()=>doUndo(),clear(){(0,r.setInputValue)(this._input,"")},case(){U=!U,F="",(0,c.toggleDataset)(this,"enabled",!U),doSearch({canAdvance:!1})}}},G={oninput(){D=A.value,(0,s.debounce)(doSearch,0,{canAdvance:!1}),adjustTextareaSize(this),D||enableReplaceButtons(!1)},onkeydown(e){const t=X.key[u().keyName(e)];t&&!1!==t(e)&&e.preventDefault()},onclick(e){const t=e.target.closest("[data-action]"),n=t&&X.click[t.dataset.action];n&&!1!==n.call(t,e)&&e.preventDefault()},onfocusout(){$.contains(document.activeElement)||($.on("focusin",G.onfocusin),$.off("focusout",G.onfocusout))},onfocusin(){$.on("focusout",G.onfocusout),$.off("focusin",G.onfocusin),trimUndoHistory(),enableUndoButton(_.length),D&&doSearch({canAdvance:!1})}},Y={onclick:G.onclick,onkeydown:G.onkeydown},J={oninput:G.oninput},K={oninput(){H=this.value,adjustTextareaSize(this),(0,s.debounce)(writeStorage,500)}},Q={find(e,{reverse:t=!1}={}){j=t,focusDialog("find",e)},findNext:e=>doSearch({reverse:!1,cm:e}),findPrev:e=>doSearch({reverse:!0,cm:e}),replace(e){j=!1,focusDialog("replace",e)}};function initState({initReplace:e}={}){const t=D;if(t!==F){z=0,L=-1,F=t;const e=t&&t.match(y),n="unicode"in RegExp.prototype?"u":"",o=(U?"gi":"g")+n;v=e&&(0,s.tryRegExp)(e[1],"g"+e[2].replace(/[guy]/g,"")+n)||t&&(U||t.includes("\n"))&&(0,s.stringAsRegExp)(t,o),b=v||t&&(0,s.stringAsRegExp)(t,o),E={caseFold:!v&&U,multiline:!0},(0,s.debounce)(writeStorage,500)}e&&H!==w&&(w=H,M=H.replace(/(\\r)?\\n/g,"\n").replace(/\\t/g,"\t"),I=/\$[$&`'\d]/.test(M));const n=document.activeElement&&document.activeElement.closest(".CodeMirror");k=(0,c.$)(`.${S}:focus, .${S}.${g}`),x=p.default.closestVisible(n&&document.activeElement||k||O);const o=(0,c.$)("body > :not(#sections) .CodeMirror");C=o?[o.CodeMirror]:p.default.getEditors()}function doSearch({reverse:e=j,canAdvance:t=!0,inApplies:n=!0,cm:o}={}){if(o&&setActiveEditor(o),j=e,!D&&!dialogShown())return void focusDialog("find",O);initState();const a=x,{index:c,found:r,foundInCode:i}=D&&doSearchInEditors({cmStart:a,canAdvance:t,inApplies:n})||{};i||clearMarker(),r||makeTargetVisible(null);const l=i?c:C.indexOf(a);if(setupOverlay(radiateArray(C,l)),enableReplaceButtons(i),D){const e=i&&!z;(0,s.debounce)(showTally,0,e?1:void 0)}else showTally(0,0);return B=!1,r}function doSearchInEditors({cmStart:e,canAdvance:t,inApplies:n}){const o=v||D,a=j,c={line:0,ch:0},r=getEOF(e),i=C.indexOf(e),l=C.length;let s,d,p,f=0,h=0;if(n&&k){if(doSearchInApplies(x,t))return{found:!0};a?s=r:f++}else s=getContinuationPos({cm:e,reverse:!t||a}),h=a?u().cmpPos(s,r)<0:u().cmpPos(s,c)>0;for(;f<l+h;f++){d=(i+f*(a?-1:1)+l)%l,p=C[d],f&&(s=a?{line:p.doc.size,ch:0}:c);const e=p.getSearchCursor(o,s,E);if(e.find(a))return makeMatchVisible(p,e),{found:!0,foundInCode:!0,index:d};const t=a?C[d?d-1:l-1]:p;if(n&&doSearchInApplies(t))return{found:!0}}}function doSearchInApplies(e,t){if(!q)return;const n=p.default.getSearchableInputs(e);j&&n.reverse(),n.splice(0,n.indexOf(k));for(const o of n){const n=o.value;b.lastIndex=o===k?o.selectionStart+t:0;const a=b.exec(n);if(!a)continue;const c=a.index+a[0].length;setTimeout(()=>{o.setSelectionRange(c,c),o.setSelectionRange(a.index,c)});const r=!$||!$.contains(document.activeElement);return makeTargetVisible(!r&&o),p.default.scrollToEditor(e),r&&o.focus(),O=e,clearMarker(),!0}}function doReplace(){initState({initReplace:!0});const e=x,t=e.changeGeneration(),n=doReplaceInEditor({cm:e,pos:getContinuationPos({cm:e,reverse:!0})});n&&(n.findNext()?(clearMarker(),makeMatchVisible(e,n)):doSearchInEditors({cmStart:getNextEditor(e)}),getStateSafe(e).unclosedOp=!1,e.curOp&&e.endOperation(),n&&(_.push([[e,t]]),enableUndoButton(!0)))}function doReplaceAll(){initState({initReplace:!0}),clearMarker();const e=new Map(C.map(e=>[e,e.changeGeneration()])),t=C.filter(e=>doReplaceInEditor({cm:e,all:!0}));t.length&&(F=null,_.push(t.map(t=>[t,e.get(t)])),enableUndoButton(!0),doSearch({canAdvance:!1}))}function doReplaceInEditor({cm:e,pos:t,all:n=!1}){const o=e.getSearchCursor(v||D,t,E),a=M;let c;for(o.find();o.atOccurrence;){if(c=!0,e.curOp||(e.startOperation(),getStateSafe(e).unclosedOp=!0),v){const t=e.getRange(o.pos.from,o.pos.to);o.replace(I?t.replace(v,a):a)}else o.replace(a);if(!n)return makeMatchVisible(e,o),o;o.findNext()}return n&&(getStateSafe(e).searchPos=null),c}function doUndo(){let e;saveWindowScrollPos();for(const[t,n]of _.pop()||[])document.body.contains(t.display.wrapper)&&!t.isClean(n)&&(t.undo(),t.getAllMarks().forEach(e=>e!==R&&e.className===m&&e.clear()),e=!0);enableUndoButton(_.length),_.length?focusUndoButton():A.focus(),e&&(F=null,restoreWindowScrollPos(),doSearch({reverse:!1,canAdvance:!1,inApplies:!1}))}function setupOverlay(e,t){if(!e.length)return;if((e.length>1||!t)&&((0,s.debounce)(setupOverlay,0,e,!0),!t))return;let n=!0;for(;e.length&&n;){const t=e.shift();if(!document.body.contains(t.display.wrapper))continue;const o=getStateSafe(t),a=b;if(o.overlay?.query===a){o.unclosedOp&&t.curOp&&t.endOperation(),o.unclosedOp=!1;continue}o.overlay&&(t.curOp||t.startOperation(),t.removeOverlay(o.overlay),o.overlay=null,n=!1);const c=a&&t.getSearchCursor(a,null,E).find();c&&(t.curOp||t.startOperation(),o.overlay={query:a,token:tokenize,numFound:0,tallyShownTime:0},t.addOverlay(o.overlay),n=!1),o.annotate&&(t.curOp||t.startOperation(),o.annotate.clear(),o.annotate=null,n=!1),o.annotateTimer&&(clearTimeout(o.annotateTimer),o.annotateTimer=0),c&&(o.annotateTimer=setTimeout(annotateScrollbar,350,t,a,U)),o.unclosedOp=!1,t.curOp&&t.endOperation()}e.length||s.debounce.unregister(setupOverlay)}function tokenize(e){this.query.lastIndex=e.pos;const t=this.query.exec(e.string);if(t&&t.index===e.pos){this.numFound++;const n=performance.now();return n-this.tallyShownTime>10&&(this.tallyShownTime=n,(0,s.debounce)(showTally)),e.pos+=t[0].length||1,"searching"}t?e.pos=t.index:e.skipToEnd()}function annotateScrollbar(e,t,n){getStateSafe(e).annotate=e.showMatchesOnScrollbar(t,n,f),(0,s.debounce)(showTally)}async function focusDialog(e,t){await Promise.resolve().then(o.bind(o,7601)),setActiveEditor(t);let n=$&&$.contains(document.activeElement)?"":getSelection().toString()||t&&t.getSelection();n=!n.includes("\n")&&!n.includes("\r")&&n,n&&(D=n),dialogShown(e)?n&&(0,r.setInputValue)(A,n):(destroyDialog(),createDialog(e),"0"===W.textContent&&(W.textContent="")),A.focus(),A.select(),D&&doSearch({canAdvance:!1})}function dialogShown(e){return document.body.contains(A)&&(!e||$.dataset.type===e)}function createDialog(e){P=document.activeElement,B=!0;const t=$=i.template.searchReplaceDialog.cloneNode(!0);Object.assign(t,Y),t.on("focusout",G.onfocusout),t.dataset.type=e,t.style.pointerEvents="auto";const n=(0,c.$)('[data-type="content"]',t);n.parentNode.replaceChild(i.template[e].cloneNode(!0),n),A=createInput(0,J,D),T=createInput(1,K,H),(0,c.toggleDataset)((0,c.$)('[data-action="case"]',t),"enabled",!U),W=(0,c.$)('[data-type="tally"]',t);const o={body:(0,a.default)(document.body,{bg:"backgroundColor"}),input:(0,a.default)((0,c.$)("input:not(:disabled)"),{bg:"backgroundColor"}),icon:(0,a.default)((0,c.$$)("i.i-info")[1])};return c.$.root.appendChild((0,c.$)(h)||(0,c.$create)("style"+h)).textContent=`\n    #search-replace-dialog {\n      background-color: ${o.body.bg};\n    }\n    #search-replace-dialog textarea {\n      color: ${o.body.fore};\n      background-color: ${o.input.bg};\n    }\n    #search-replace-dialog i {\n      color: ${o.icon.fore};\n    }\n    #search-replace-dialog [data-action="case"] {\n      color: ${o.icon.fore};\n    }\n    #search-replace-dialog[data-type="replace"] button:hover i,\n    #search-replace-dialog i:hover {\n      color: var(--cmin);\n    }\n    #search-replace-dialog [data-action="case"]:hover {\n      color: var(--cmin);\n    }\n    #search-replace-dialog [data-action="clear"] {\n      background-color: ${o.input.bg.replace(/[^,]+$/,"")+".75)"};\n    }\n  `,document.body.appendChild(t),dispatchEvent(new Event("showHotkeyInTooltip")),adjustTextareaSize(A),"replace"===e&&(adjustTextareaSize(T),enableReplaceButtons(""!==D),enableUndoButton(_.length)),t}function createInput(e,t,n){const o=(0,c.$$)("textarea",$)[e];if(o)return o.value=n,Object.assign(o,t),o.parentElement.appendChild(i.template.clearSearch.cloneNode(!0)),(0,c.$)("[data-action]",o.parentElement)._input=o,o}function destroyDialog({restoreFocus:e=!1}={}){A=null,(0,c.$remove)("#search-replace-dialog"),s.debounce.unregister(doSearch),makeTargetVisible(null),e?setTimeout(focusNoScroll,0,P):(saveWindowScrollPos(),restoreWindowScrollPos({immediately:!1}))}function adjustTextareaSize(t){const n=parseFloat(t.style.width)||t.clientWidth,o=t._widthHistory=t._widthHistory||new Map,a=o.get(t.value);let c;if(a)c=a;else{const e=t.scrollHeight>t.clientHeight;c=t.scrollWidth+(e?t.scrollWidth-t.clientWidth:0),c+=c>n?50:0,o.set(t.value,c)}if(c!==n){const n=parseFloat(getComputedStyle($).right),o=$.getBoundingClientRect().right,a=(T||A).getBoundingClientRect().right;c=Math.min(c,(e.innerWidth-n-(o-a))/(T?2:1)-20),t.style.width=c+"px"}const r=t.scrollWidth>t.clientWidth,i=t.value.split("\n").length+r;i!==Number(t.rows)&&(t.rows=i),t.style.overflowX=r?"":"hidden"}function enableReplaceButtons(e){if($&&"replace"===$.dataset.type)for(const t of(0,c.$$)('[data-action^="replace"]',$))t.disabled=!e}function enableUndoButton(e){if($&&"replace"===$.dataset.type)for(const t of(0,c.$$)('[data-action="undo"]',$))t.disabled=!e}function focusUndoButton(){for(const e of(0,c.$$)('[data-action="undo"]',$))if("none"!==getComputedStyle(e).display){e.focus();break}}function getStateSafe(e){return e.stateSearch||(e.stateSearch={})}function getContinuationPos({cm:e,reverse:t}){const n=getStateSafe(e),o=t?"from":"to",a=n.searchPos?.[o],c=e.getCursor(o);return!a||u().cmpPos(c,n.cursorPos[o])?c:a}function getEOF(e){const t=e.doc.size-1;return{line:t,ch:e.getLine(t).length}}function getNextEditor(e,t=1){const n=C;return n[(n.indexOf(e)+t+n.length)%n.length]}function setActiveEditor(e){e.display.wrapper.contains(document.activeElement)&&(O=e,P=e)}function makeTargetVisible(e){const t=(0,c.$)("."+g);t!==e&&(t&&(t.classList.remove(g),document.body.classList.remove("find-open")),e&&(e.classList.add(g),document.body.classList.add("find-open")))}function makeMatchVisible(e,t){const n=!(B||$&&$.contains(document.activeElement));O=e;const o=t.pos;Object.assign(getStateSafe(e),{cursorPos:{from:e.getCursor("from"),to:e.getCursor("to")},searchPos:o,unclosedOp:!e.curOp}),e.curOp||e.startOperation(),B||e.jumpToPos(o.from,o.to),clearMarker(),n?(e.focus(),makeTargetVisible(null)):(makeTargetVisible(e.display.wrapper),R=e.stateSearch.marker=e.markText(o.from,o.to,{className:m,clearOnEnter:!0}))}function clearMarker(){R&&R.clear()}function showTally(e,t){if(!W)return;if(void 0===e){e=0;for(const t of C){const{annotate:n,overlay:o}=getStateSafe(t);e+=n?.matches?.length||o?.numFound||0}z=e}if(void 0===t&&q&&L<0){t=0;const e=D?document.getElementsByClassName(S):[];for(const n of e){const e=n.value;if(v){v.lastIndex=0;for(let n;(n=v.exec(e))&&++t&&v.lastIndex>n.index;);}else{let n=-1;for(;(n=e.indexOf(D,n+1))>=0;)t++}}L=t}else t=L;const n=e+(t>0?"+"+t:"");if(W.textContent!==n){W.textContent=n;const e=(0,i.t)("searchNumberOfResults"+(t?"2":""));W.title!==e&&(W.title=e)}}function trimUndoHistory(){const e=_;for(let t;t=e[e.length-1];){const n=t.filter(([e,t])=>document.body.contains(e.display.wrapper)&&!e.isClean(t));if(n.length){e[e.length-1]=n;break}e.length--}}function focusNoScroll(e){e&&(saveWindowScrollPos(),e.focus({preventScroll:!0}),restoreWindowScrollPos({immediately:!1}))}function saveWindowScrollPos(){N=scrollX,V=scrollY}function restoreWindowScrollPos({immediately:e=!0}={}){e?scrollX===N&&scrollY===V||scrollTo(N,V):Promise.resolve().then(restoreWindowScrollPos)}function radiateArray(e,t){const n=e[t];if(!n)return e;const o=[n],a=e.length;for(let n=1;n<a;n++)t+n<a&&o.push(e[t+n]),t-n>=0&&o.push(e[t-n]);return o}function writeStorage(){l.chromeLocal.getValue("editor").then((e={})=>l.chromeLocal.setValue("editor",Object.assign(e,{find:D,replace:H,icase:U})))}Q.replaceAll=Q.replace,Object.assign(u().commands,Q),l.chromeLocal.getValue("editor").then((e={})=>{D=e.find||"",H=e.replace||"",U=e.icase||U})},7601:(e,t,n)=>{n.r(t)}}])}