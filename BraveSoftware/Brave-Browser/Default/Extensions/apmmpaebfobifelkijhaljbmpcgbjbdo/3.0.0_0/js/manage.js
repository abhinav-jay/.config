{const e=this;(self.webpackChunkStylus=self.webpackChunkStylus||[]).push([["manage"],{2062:(e,t,s)=>{s.d(t,{filterAndAppend:()=>filterAndAppend,filtersSelector:()=>h,showFiltersStats:()=>showFiltersStats});var n=s(6001),a=s(9030),l=s(6308),r=s(9204),i=s(2691),o=s(9521),c=s(6413),d=s(7088),u=s(7286),p=s(1976);const h={hide:"",unhide:"",numShown:0,numTotal:0},f="search",m="searchMode",g="manage.searchMode";let y,b;function filterOnChange({target:e,forceRefilter:t,alreadySearched:s}){const getValue=e=>"checkbox"===e.type?e.checked:e.value.trim();if(!t){const t=getValue(e);if(t===e.lastValue)return;e.lastValue=t}const a=[...(0,n.$$)("#header [data-filter]")].filter(e=>getValue(e)),buildFilter=e=>(e?"":".entry.hidden")+[...a.map(t=>t.dataset[e?"filterHide":"filter"].split(/,\s*/).map(t=>(e?".entry:not(.hidden)":"")+t).join(","))].join(e?",":"");Object.assign(h,{hide:buildFilter(!0),unhide:buildFilter(!1)}),reapplyFilter(p.installed,s).then(u.updateStripes)}function filterAndAppend({entry:e,container:t}){return t||(t=[e],h.hide&&e.matches(h.hide)||e.classList.add("hidden"),(0,c.fitNameColumn)(void 0,e.styleMeta),(0,c.fitSizeColumn)(void 0,e)),reapplyFilter(t)}async function reapplyFilter(e=p.installed,t){!t&&y.value.trim()&&await searchStyles({immediately:!0,container:e});let s=[],a=[];if(h.hide?filterContainer({hide:!1}):a=e,a instanceof DocumentFragment)p.installed.appendChild(a);else{for(const e of a.children||a)e.parentNode||p.installed.appendChild(e),e.classList.contains("hidden")&&e.classList.remove("hidden");if(h.hide&&filterContainer({hide:!0}),s.length){for(const e of s)e.classList.add("hidden");if(e instanceof DocumentFragment)return p.installed.appendChild(e),void showFiltersStats();1===s.length&&s[0].parentElement!==p.installed&&p.installed.appendChild(s[0]),showFiltersStats()}else showFiltersStats()}function filterContainer({hide:t}){const l=h[t?"hide":"unhide"];if(e.filter){if(t)return;for(const t of e)(t.matches(l)?a:s).push(t)}else t?s=[...(0,n.$$)(l,e)]:a=[...(0,n.$$)(l,e)]}}function showFiltersStats(){const e=""!==h.hide;(0,n.$)("#filters summary").classList.toggle("active",e),(0,n.$)("#reset-filters").disabled=!e;const t=p.installed.childElementCount,s=t-p.installed.getElementsByClassName("entry hidden").length;h.numShown===s&&h.numTotal===t||(h.numShown=s,h.numTotal=t,(0,n.$)("#filters-stats").textContent=(0,l.t)("filteredStyles",[s,t]),document.body.classList.toggle("all-styles-hidden-by-filters",!s&&t&&h.hide))}async function searchStyles({immediately:e,container:t}={}){const s=y.value.trim(),n=b.value;if(s===y.lastValue&&n===b.lastValue&&!e&&!t)return;if(!e)return void(0,o.debounce)(searchStyles,150,{immediately:!0});y.lastValue=s,b.lastValue=n;const a=p.installed.children,l=t&&t.children||t||a,i=l!==a&&[...l].map(e=>e.styleId),c=l[0]?await r.API.styles.searchDb({query:s,mode:n,ids:i}):[];let d=!1;for(const e of l){const t=c.includes(e.styleId);e.classList.contains("not-matching")!==!t&&(e.classList.toggle("not-matching",!t),d=!0)}return d&&!t&&filterOnChange({forceRefilter:!0,alreadySearched:!0}),t}d.watch({search:[f,m]},([e,t])=>{const s=!y;s&&(y=(0,n.$)("#search"),b=(0,n.$)("#"+g),b.on("change",e=>{"url"===b.value&&e.stopPropagation()},!0),y.oninput=()=>d.updateSearch(f,y.value),b.oninput=()=>d.updateSearch(m,b.value),(0,n.$)("#search-help").onclick=e=>{e.preventDefault(),a.messageBox.show({className:"help-text center-dialog",title:(0,l.t)(f),contents:(0,n.$create)("ul",(0,l.t)("searchStylesHelp").split("\n").map(e=>(0,n.$create)("li",e.split(/(<.*?>)/).map((e,t,s)=>{if(e.startsWith("<")){const a=s.length,l=t!==a-2||s[a-1]?"":".last";return(0,n.$create)("mark"+l,e.slice(1,-1))}return e})))),buttons:[(0,l.t)("confirmOK")]})},(0,n.$$)('select[id$=".invert"]').forEach(e=>{const t=(0,n.$)("#"+e.id.replace(".invert","")),s=t.dataset,a=new Map([[!1,s.filter],[!0,s.filterHide]]);e.oninput=()=>{t.checked||setTimeout(()=>{t.checked||(t.checked=!0,t.dispatchEvent(new Event("change",{bubbles:!0})))})},e.onchange=t=>{const n="true"===e.value,l=a.get(n);s.filter!==l&&(s.filter=l,s.filterHide=a.get(!n),(0,o.debounce)(filterOnChange,0,t))},e.onchange({target:e})}),(0,n.$$)("[data-filter]").forEach(e=>{e.onchange=filterOnChange,e.closest(".hidden")&&(e.checked=!1)}),(0,n.$)("#reset-filters").onclick=e=>{if(e.preventDefault(),h.hide){for(const e of(0,n.$$)("#filters [data-filter]")){let t;"checkbox"===e.type&&e.checked?t=e.checked=!1:e.value&&(t=e.value=""),void 0!==t&&(e.lastValue=t,i.knownKeys.includes(e.id)&&i.set(e.id,!1))}"url"===b.value&&(b.value=i.get(g)),filterOnChange({forceRefilter:!0}),d.updateSearch({[f]:"",[m]:""})}}),y.value=e||"",(t||"url"===b.value)&&(b.value=t||i.get(g)),s?filterOnChange({forceRefilter:!0}):searchStyles()})},3225:(e,t,s)=>{s(4404);var n=s(6001),a=s(9030),l=s(6308),r=s(2691),i=(s(4435),s(9521)),o=s(6413),c=s(7088),d=s(7286),u=s(1976);function init(e){return(0,a.setupLivePrefs)(),u.newUI.render(!0),r.subscribe(u.newUI.ids.map(u.newUI.prefKeyForId),()=>u.newUI.render()),r.subscribe("newStyleAsUsercss",(e,t)=>{(0,n.$)("#add-style-label").textContent=(0,l.t)(t?"optionsAdvancedNewStyleAsUsercss":"addStyleLabel")},!0),d.init(),c.update(),u.newUI.hasFavs()&&(0,o.readBadFavs)(e)}(0,l.tBody)(),(async()=>{const{badFavs:e,ids:t,styles:n}=r.clientData;init(e),(0,o.showStyles)(n,t),document.styleSheets[0].insertRule(`:root {${["genericDisabledLabel","updateAllCheckSucceededSomeEdited","filteredStylesAllHidden"].map(e=>`--${e}:"${CSS.escape((0,l.t)(e))}";`).join("")}}`),await(0,i.sleep)(),s.e("manage_lazy-init_js").then(s.bind(s,213))})()},6413:(t,s,n)=>{n.d(s,{createStyleElement:()=>createStyleElement,createTargetsElement:()=>createTargetsElement,favsBusy:()=>$,fitNameColumn:()=>fitNameColumn,fitSizeColumn:()=>fitSizeColumn,partEntry:()=>E,readBadFavs:()=>readBadFavs,renderFavs:()=>renderFavs,renderMissingFavs:()=>renderMissingFavs,showStyles:()=>showStyles,updateTotal:()=>updateTotal});var a=n(6001),l=n(9030),r=n(6308),i=n(1679),o=n(9521),c=n(2062),d=n(7286),u=n(1976),p=n(9204),h=n(4523);const f="badFavs";let m,g;async function renderFavs(e=u.installed){if(!u.newUI.hasFavs())return;m||initBadFavs(),m.then&&await m;const t=/(\?!([^)]+\))|\(\?![\w(]+[^)]+[\w|)]+)/g,s=/[\\(]|((\|\w+)+\))/g,n=/[\w-]+[.(]+(com|org|co|net|im|io|edu|gov|biz|info|de|cn|uk|nl|eu|ru)\b/g,l=/^.*?:\/\/\W*([-.\w]+)/;for(const r of(0,a.$$)(".target",e)){const e=r.dataset.type,o=r.textContent;if(!o)continue;let c="";if("domains"===e?c=o:/-extension:\\?\//.test(o)?c=h.MF_ICON:"regexps"===e?(c=o.replace(t,"").replace(s,"").match(n),c=c?c.shift():""):/^(f|ht)tps?:/.test(o)&&(c=o.match(l),c=c?c[1].replace(/\W+$/,""):""),!c||m.includes(c)){r.firstElementChild||r.prepend((0,a.$create)("b"));continue}c!==h.MF_ICON&&(c=i.favicon(c));const d=(0,a.$)(":scope > img:first-child",r)||r.insertAdjacentElement("afterbegin",(0,a.$create)("img",{loading:"lazy"}));(d.dataset.src||d.src)!==c&&(d.src=c)}}async function readBadFavs(e){return e||(e=await(g||(g=p.API.prefsDb.get(f))),g=!1),u.newUI.cfg[f]=Array.isArray(e)?e:[]}async function initBadFavs(){const{put:e}=p.API.prefsDb,t=new RegExp(`^${(0,o.stringAsRegExpStr)(i.favicon("\n")).replace("\n","(.*)")}$`);m=u.newUI.cfg[f]||await(m=readBadFavs());const fn=s=>{const n=s.statusCode,a=n&&200!==n&&s.url.match(t)[1];a&&!m.includes(a)&&(m.push(a),(0,o.debounce)(e,250,m,f))},s={urls:[i.favicon("*")],types:["image"],tabId:(await(0,h.getOwnTab)()).id};chrome.webRequest.onCompleted.addListener(fn,s),chrome.webRequest.onErrorOccurred.addListener(fn,s)}function renderMissingFavs(e,t,s){for(const n of u.installed.children)(0,a.$)(".applies-to",n).classList.toggle("has-more",n._numTargets>e),!n._allTargetsRendered&&e>(0,a.$)(".targets",n).childElementCount?(createTargetsElement({entry:n}),t|=s):(+n.style.getPropertyValue("--num-targets")||1e9)>e&&n.style.setProperty("--num-targets",e);return t}const y=["domains","urls","urlPrefixes","regexps"],b=[[24,"h",(0,r.t)("dateAbbrHour","")],[30,"d",(0,r.t)("dateAbbrDay","")],[12,"m",(0,r.t)("dateAbbrMonth","")],[1/0,"y",(0,r.t)("dateAbbrYear","")]],v=CSS.supports("content-visibility","auto"),groupThousands=e=>`${e}`.replace(/\d(?=(\d{3})+$)/g,"$&Â "),renderSize=e=>groupThousands(Math.round(e/1024))+"k",S=new Map,C="edit.html?id=",w={urlPrefixesAfter:"*",regexpsBefore:"/",regexpsAfter:"/"};let $,E,I,x,F,L,O,T,N,A,D,M,k,j,z=0;function createAgeText(e,t){let s=t.updateDate||t.installDate;if(s){s=(Date.now()-s)/36e5;for(const[t,n,a]of b){const l=Math.round(s);if(l<t){e.textContent=a.replace("",l),e.dataset.value=(0,u.padLeft)(Math.round(l),2)+n;break}s/=t}}else e.firstChild&&(e.textContent="",delete e.dataset.value)}function createParts(e){return D=e,E=r.template[e?"styleNewUI":"style"].cloneNode(!0),F=E.className,I=(0,a.$)("input",E)||{},A=(0,a.$)(".style-name-link",E),x=(0,a.$)(".style-edit-link",E)||{},L=(0,a.$)(".homepage",E),O=(0,a.$)("[data-type=age]",E),T=(0,a.$)("[data-type=size]",E),N=(0,a.$)("[data-type=version]",E),j=(0,a.$)(".targets",E),k=!e&&(0,a.$)(".configure-usercss",E),M=!e&&(0,a.$)(".check-update",E),E}function createStyleElement({styleMeta:e,styleNameLC:t,styleSize:s}){const n=e.usercssData,{updateUrl:l}=e,c=n&&n.vars&&!(0,o.isEmptyObj)(n.vars),d=e.customName||e.name,p=u.newUI.cfg.enabled;p!==D&&createParts(p),I.checked=e.enabled,A.firstChild.textContent=(0,r.breakWord)(d),A.href=x.href=C+e.id,L.href=L.title=e.url||"",N.textContent=n?n.version:"",N.dataset.value=n?n.version:"",(0,a.toggleDataset)(N,"isDate",n&&(e.md5Url||(0,i.extractUsoaId)(l))),createAgeText(O,e),T.dataset.value=0|Math.log10(s||1),T.textContent=renderSize(s),T.title=`${(0,r.t)("genericSize")}: ${groupThousands(s)} B`,p||(k.classList.toggle("hidden",!c),M.classList.toggle("hidden",!l)),(0,u.removeStyleCode)(e);const h=E.cloneNode(!0);return h.id=u.ENTRY_ID_PREFIX_RAW+e.id,h.styleId=e.id,h.styleNameLC=t,h.styleMeta=e,h.styleSize=s,h.className=F+" "+(e.enabled?"enabled":"disabled")+(l?" updatable":"")+(n?" usercss":""),p&&(l||c)&&(0,a.$)(".actions",h).append(...[l&&r.template.updaterIcons.cloneNode(!0),c&&r.template.configureIcon.cloneNode(!0)].filter(Boolean)),createTargetsElement({entry:h,style:e}),h}function createTargetsElement({entry:e,expanded:t,style:s=e.styleMeta}){const n=u.newUI.cfg.enabled,l=t?1e3:n?u.newUI.cfg.targets:10;if(!l)return void(e._numTargets=0);const i=new Set,o=(0,a.$)(".targets",e),c=(0,a.$)(".applies-to",e).classList,d=j.cloneNode(!0);let p=d,h=o.firstElementChild,f=0,m=!0;for(const e of y)for(const a of s.sections)for(const s of a[e]||[]){if(i.has(s))continue;if(++f>l){m=t;break}i.add(s);const a=(w[e+"Before"]||"")+s+(w[e+"After"]||"");if(h&&h.dataset.type===e&&h.lastChild.textContent===a){const e=h.nextElementSibling;p.appendChild(h),h=e;continue}const o=r.template.appliesToTarget.cloneNode(!0);n||(f===l?p=p.appendChild(r.template.extraAppliesTo.cloneNode(!0)):f>1&&p.appendChild(r.template.appliesToSeparator.cloneNode(!0))),o.dataset.type=e,o.append(a),p.appendChild(o)}n&&f>u.newUI.cfg.targets&&c.add("has-more"),f?o.parentElement.replaceChild(d,o):e.classList.contains("global")&&o.firstElementChild||(o.firstElementChild&&(o.textContent=""),o.appendChild(r.template.appliesToEverything.cloneNode(!0))),e.classList.toggle("global",!f),e._allTargetsRendered=m,e._numTargets=f,n&&e.style.setProperty("--num-targets",Math.min(f,u.newUI.cfg.targets))}function highlightEditedStyle(){if(!o.sessionStore.justEditedStyleId)return;const e=(0,u.$entry)(o.sessionStore.justEditedStyleId);delete o.sessionStore.justEditedStyleId,e&&((0,l.animateElement)(e),requestAnimationFrame(()=>(0,l.scrollElementIntoView)(e)))}function fitNameColumn(e,t){t&&calcNameLenKey(t),e=e?e.map(calcNameLenKey):[...S.values()];const s=d.columns>1?.8:.95,n=S.res=e.sort()[S.size*s|0]+5-1e9;a.$.root.style.setProperty("--name-width",n+"ch")}function calcNameLenKey(e){const t=e.displayName||e.name||"",s=1e9+(e.enabled?1.05:1)*(t.length+t.replace(/[^\u3000-\uFE00]+/g,"").length)|0;return S.set(e.id,s),s}function fitSizeColumn(e=u.installed.children,t){let s=t&&renderSize(t.styleSize).length||0;if(s){if(s<=parseInt(a.$.root.style.getPropertyValue("--size-width")))return}else{for(const t of e)s=Math.max(s,t.styleSize);s=renderSize(s).length}a.$.root.style.setProperty("--size-width",s+"ch")}function showStyles(t=[],s){const n=t.map(u.styleToDummyEntry),a=d.sort(n);let l=0,r=!0;const i=history.state?.scrollY,p=i>e.innerHeight||o.sessionStore.justEditedStyleId||v,h=document.createDocumentFragment();$=u.newUI.hasFavs(),fitNameColumn(t),fitSizeColumn(n),function renderStyles(){const e=!p&&performance.now();for(;l<a.length&&(p||(7&l)<7||performance.now()-e<50);){const e=createStyleElement(a[l++]);s&&!s.includes(e.styleMeta.id)&&e.classList.add("not-matching"),h.appendChild(e)}if((0,c.filterAndAppend)({container:h}).then(d.updateStripes),l<a.length)return requestAnimationFrame(renderStyles),r&&$&&renderFavs(),void(r=!1);$&&renderFavs().then(()=>$=!1),o.sessionStore.justEditedStyleId&&setTimeout(highlightEditedStyle)}(),updateTotal(t.length)}function updateTotal(e){if(e&&(z+=e),+u.installed.dataset.total===z)return;u.installed.dataset.total=z;let t=(0,a.$)("#manage-text-empty");if(z&&t)t.remove();else{if(z||t)return;t=(0,a.$)("#manage-text").cloneNode(!0),t.id+="-empty",u.installed.after(t)}a.$.rootCL.toggle("empty",!z)}},7088:(t,s,n)=>{n.d(s,{makeToggle:()=>makeToggle,update:()=>update,updateSearch:()=>updateSearch,watch:()=>watch});var a=n(6001),l=n(9204),r=n(9521);const i=history.state?.buffer||[],o=[];function makeToggle(e,t,s){const n="#"+e,l="."+e;return watch({hash:n},async e=>{const n=(0,a.$)(l);!e!=!n&&(e&&s&&!t&&(t=await s()),await t(e,n,l),e&&updateHash(""))}),updateHash.bind(null,n)}function push(e){const t=history.state||{};t.buffer=i,history.pushState(t,null,e)}function update(){if(i.length){if(i[i.length-1]===location.href)return void(o.some(e=>!e.init)&&callWatchers());i.length>1&&i[i.length-2]===location.href?i.pop():i.push(location.href)}else i.push(location.href);callWatchers()}function callWatchers(){for(const e of o){const{options:t,callback:s}=e;let n;if(e.init=!0,t.hash)n=t.hash===location.hash;else if(t.search){const e=new URLSearchParams(location.search);n=t.search.map(t=>e.get(t))}(0,r.deepEqual)(n,t.currentState)||(t.currentState=n,s(n))}}function updateHash(e){i.length>1&&(!e&&!i[i.length-2].includes("#")||e&&i[i.length-2].endsWith(e))?history.back():(e||(e=" "),push(e),update())}function updateSearch(e,t){const s=new URL(location),n="object"==typeof e?Object.entries(e):[[e,t]];for(const[e,t]of n)t?s.searchParams.set(e,t):s.searchParams.delete(e);history.replaceState(history.state,null,`${s}`),i.pop(),update()}function watch(e,t){o.push({options:e,callback:t})}e.on("popstate",update),e.on("hashchange",update),(0,l.onMessage)(e=>{if("pushState"===e.method&&e.url!==location.href)return push(e.url),update(),!0})},7286:(t,s,n)=>{n.d(s,{columns:()=>b,init:()=>init,sort:()=>sort,update:()=>update,updateStripes:()=>updateStripes});var a=n(6001),l=n(9030),r=n(6308),i=n(1976),o=n(2691);const c=300,d=9999,u="--columns",p={alpha:(e,t)=>e<t?-1:e===t?0:1,number:(e,t)=>(e||0)-(t||0)},h={title:{text:(0,r.t)("genericTitle"),parse:e=>e.styleNameLC,sorter:p.alpha},usercss:{text:"Usercss",parse:e=>e.styleMeta.usercssData?0:1,sorter:p.number},disabled:{text:"",parse:e=>e.styleMeta.enabled?1:0,sorter:p.number},dateInstalled:{text:(0,r.t)("dateInstalled"),parse:e=>e.styleMeta.installDate,sorter:p.number},dateUpdated:{text:(0,r.t)("dateUpdated"),parse:({styleMeta:e})=>e.updateDate||e.installDate,sorter:p.number},size:{text:(0,r.t)("genericSize"),parse:e=>e.styleSize,sorter:p.number}},f=["{groupAsc}","title,asc","dateInstalled,desc, title,asc","dateInstalled,asc, title,asc","dateUpdated,desc, title,asc","dateUpdated,asc, title,asc","usercss,asc, title,asc","usercss,desc, title,asc","disabled,asc, title,asc","disabled,desc, title,asc","disabled,desc, usercss,asc, title,asc","size,desc, title,asc","{groupDesc}","title,desc","usercss,asc, title,desc","usercss,desc, title,desc","disabled,desc, title,desc","disabled,desc, usercss,asc, title,desc"],m=/\s*,\s*/,g="manage.newUI.sort",getPref=()=>o.get(g)||o.defaults[g];let y,b=1;function init(){o.subscribe(g,update),(0,a.$)("#sorter-help").onclick=showHelp,addOptions(),o.subscribe("manage.minColumnWidth",updateColumnWidth,!0)}function addOptions(){let e;const t=(0,a.$)("#"+g),s=document.createDocumentFragment(),n=(0,a.$create)("option"),l=(0,a.$create)("optgroup"),i={desc:" ð ",enabled:(0,r.t)("genericEnabledLabel"),disabled:(0,r.t)("genericDisabledLabel"),dateNew:` (${(0,r.t)("sortDateNewestFirst")})`,dateOld:` (${(0,r.t)("sortDateOldestFirst")})`,groupAsc:(0,r.t)("sortLabelTitleAsc"),groupDesc:(0,r.t)("sortLabelTitleDesc")};f.forEach(t=>{if(/{\w+}/.test(t))return e&&s.appendChild(e),e=l.cloneNode(),void(e.label=i[t.substring(1,t.length-1)]);let a="";const r=n.cloneNode();r.textContent=t.split(m).reduce((e,t)=>h[t]?(a=t,e+(""!==e?" + ":"")+h[t].text):a.indexOf("date")>-1?e+i["desc"===t?"dateNew":"dateOld"]:"disabled"===a?e+i["desc"===t?"enabled":"disabled"]:e+(i[t]||""),""),r.value=t,e.appendChild(r)}),s.appendChild(e),t.appendChild(s),t.value=getPref()}function sort(e){const t=getPref().split(m),s=t.length;return e.sort((e,n)=>{let a,l,r=0,i=0;for(;0===r&&i<s;)a=h[t[i++]],l="asc"===t[i++]?1:-1,r=a.sorter(a.parse(e),a.parse(n))*l;return r})}function update(){const e=[...i.installed.children],t=sort([...e]);e.some((e,s)=>e!==t[s])&&i.installed.append(...t),updateStripes()}function updateStripes({onlyWhenColumnsChanged:e}={}){if(e&&!updateColumnCount())return;let t=0,s=!1;const n=b%2==0;for(const{classList:e}of i.installed.children)e.contains("hidden")||(e.toggle("odd",s),e.toggle("even",!s),n&&++t>=b?t=0:s=!s)}function updateColumnCount(){const e=[].some.call(a.$.root.children,e=>"STYLE"===e.tagName&&e.textContent.includes(u+":"))?Math.max(1,0|getComputedStyle(a.$.root).getPropertyValue(u)):y?onResize():b;if(b!==e)return b=e,!0}function updateColumnWidth(t,s){y=Math.max(s,c),s<d?e.on("resize",onResize):(e.off("resize",onResize),a.$.root.style.removeProperty(u)),updateStripes({onlyWhenColumnsChanged:!0})}function onResize(t){const s=Math.max(1,(e.innerWidth-a.dom.HWval)/y|0);return b!==s&&(a.$.root.style.setProperty(u,s),t&&(b=s,updateStripes())),s}async function showHelp(e){e.preventDefault(),l.messageBox.show({className:"help-text center-dialog",title:(0,r.t)("sortStylesHelpTitle"),contents:(0,a.$create)("div",(0,r.t)("sortStylesHelp").split("\n").map(e=>(0,a.$create)("p",e))),buttons:[(0,r.t)("confirmOK")]})}},1976:(e,t,s)=>{s.d(t,{$entry:()=>$entry,ENTRY_ID_PREFIX_RAW:()=>g,installed:()=>y,newUI:()=>n,objectDiff:()=>objectDiff,padLeft:()=>padLeft,queue:()=>b,removeStyleCode:()=>removeStyleCode,styleToDummyEntry:()=>styleToDummyEntry});var n={};s.r(n),s.d(n,{cfg:()=>p,hasFavs:()=>hasFavs,ids:()=>h,prefKeyForId:()=>prefKeyForId,readPrefs:()=>readPrefs,render:()=>new_ui_render,renderClass:()=>renderClass});var a=s(6001),l=s(6308),r=s(9030),i=s(9204),o=s(2691),c=s(7136),d=s(9521),u=s(6413);const p={enabled:null,favicons:null,faviconsGray:null,targets:null},h=Object.keys(p),hasFavs=()=>p.enabled&&p.favicons,prefKeyForId=e=>`manage.newUI.${e}`.replace(/\.enabled$/,""),f="newui";let m;function readPrefs(e=p,t){for(const s of h){const n=e[s]=o.get(prefKeyForId(s));t&&t(s,n)}}function renderClass(){const e=!!p.enabled;m||(0,r.getCssMediaRuleByName)(f,e=>!(m=e)),a.$.rootCL.toggle("newUI",e),a.$.rootCL.toggle("oldUI",!e),e!==(m[0]===c.MEDIA_ON)&&(m.mediaText=`${e?c.MEDIA_ON:c.MEDIA_OFF},${f}`)}function new_ui_render(e){const t={},s={};if(readPrefs(t,(e,n)=>{s[e]=n!==p[e]&&("enabled"===e||t.enabled)}),!e&&(0,d.isEmptyObj)(s))return;if(Object.assign(p,t),renderClass(),y.classList.toggle("has-favicons",hasFavs()),y.classList.toggle("favicons-grayed",p.enabled&&p.faviconsGray),y.classList.toggle("has-targets",!p.enabled||!!p.targets),e)return;const n=hasFavs();let l=n&&!(0,a.$)(".applies-to img");if(s.enabled||l&&!u.favsBusy&&!u.partEntry)return y.textContent="",void requestAnimationFrame(()=>i.API.styles.getAll().then(u.showStyles));s.targets&&(l=(0,u.renderMissingFavs)(p.targets,l,n)),l&&(0,d.debounce)(u.renderFavs)}const g="style-",y=(0,a.$)("#installed",l.template.body),$entry=(e,t=y)=>(0,a.$)(`#${g}${e.id||e}`,t),b=Object.assign([],{THROTTLE:100,styles:new Map,time:0});function calcObjSize(e){if(!0===e||null==e)return 4;if(!1===e)return 5;let t=typeof e;if("string"===t)return e.length+2;if("number"===t)return(t=e)>=0&&t<10?1:Math.ceil(Math.log10(t<0?-t:t));if("object"!==t)return`${e}`.length;let s=1;if(Array.isArray(e))for(t of e)s+=calcObjSize(t)+1;else for(const t in e)s+=t.length+3+calcObjSize(e[t])+1;return s}function padLeft(e,t){return e=`${e}`," ".repeat(Math.max(0,t-e.length))+e}function removeStyleCode(e){let t=(e.sourceCode||"").length||0;e.sections.forEach(e=>{t+=(e.code||"").length,e.code=null}),e.sourceCode=null,Object.defineProperty(e,"_codeSize",{value:t,writable:!0})}function objectDiff(e,t,s=""){const n=[];for(const a in e){const l=e[a],r=t[a];l!==r&&(void 0!==r?l&&"function"==typeof l.filter&&r&&"function"==typeof r.filter?(l.length!==r.length||l.some((e,t)=>e&&"object"==typeof e?objectDiff(e,r[t],s+a+"["+t+"].").length:e!==r[t]))&&n.push({path:s,key:a,values:[l,r],type:"changed"}):l&&r&&"object"==typeof l&&"object"==typeof r?n.push(...objectDiff(l,r,s+a+".")):n.push({path:s,key:a,values:[l,r],type:"changed"}):n.push({path:s,key:a,values:[l],type:"removed"}))}for(const a in t)a in e||n.push({path:s,key:a,values:[t[a]],type:"added"});return n}function styleToDummyEntry(e){const t=e.customName||e.name||"";return{styleMeta:e,styleSize:calcObjSize(e)+(e._codeSize||0),styleNameLC:t.toLocaleLowerCase()+"\n"+t}}if(self.fitSelectBox=CSS.supports("field-sizing","content")?()=>{}:((e={},t=function(t){if(t.button||this[1])return;const s=Object.values(e),n=s.indexOf(e[this.value]);this.style.width=this.offsetWidth+"px",n>0&&this.prepend(...s.slice(0,n)),this.append(...s.slice(n+1))},s=function(e){for(const e of[...this.options])e.value!==this.value&&e.remove();if(this.style.removeProperty("width"),e&&e.isTrusted)return this.offsetWidth},n=function(n){for(const t of n.options)e[t.value]=t;n.on("keydown",t),n.on("mousedown",t),n.on("blur",s),n.on("input",s);const a=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(n),"value");Object.defineProperty(n,"value",{get:a.get,set:t=>{const l=e["string"==typeof t?t:t=`${t}`];l.isConnected||(n[0]?n[0].replaceWith(l):n.append(l)),a.set.call(n,t),s.call(n,{})}})})=>(e,t,s)=>{s&&n(e),e.value=t})(),!("loading"in HTMLImageElement.prototype)){const e=HTMLImageElement.prototype,t=Object.getOwnPropertyDescriptor(e,"src"),s=new IntersectionObserver(e=>{for(const n of e)if(n.intersectionRatio){const e=n.target;t.set.call(e,e.dataset.src),s.unobserve(e),delete e.dataset.src}},{rootMargin:"200px"});Object.defineProperty(e,"src",Object.assign({},t,{set(e){"lazy"===this.loading?(this.dataset.src=e,s.observe(this)):t.set.call(this,e)}}))}}},e=>{e.O(0,["common-ui","css_global-dark_css-css_global_css-css_spinner_css"],()=>e(e.s=3225)),e.O()}])}