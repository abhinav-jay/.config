{const e=this;(()=>{var t={374:e=>{function createLock({maxActiveReader:e=1/0}={}){let t,r,n=0;const o={read:e=>que(e,!1),write:e=>que(e,!0),length:0};return o;function que(e,n){const a=createTask({fn:e,block:n});return r?(r.next=a,a.prev=r,r=a,t||(t=r)):t=r=a,o.length++,deque(),a.q.promise}function defer(){const e={};return e.promise=new Promise((t,r)=>{e.resolve=t,e.reject=r}),e}function createTask({fn:e,block:t=!1,prev:r,next:n,q:o=defer(),q2:a=(e.length?defer():null)}){return{fn:e,block:t,prev:r,next:n,q:o,q2:a}}function deque(){const a=t;if(!a||a.block&&a.prev||a.prev&&a.prev.block||n>=e)return;let c;a.block||n++,t=a.next;try{c=a.fn(a.q2&&a.q2.resolve)}catch(e){return a.q.reject(e),void onDone()}if(a.q2&&a.q2.promise.then(_onDone),c&&c.then){const e=c.then(a.q.resolve,a.q.reject);a.q2||e.then(onDone)}else if(a.q.resolve(c),!a.q2)return void onDone();function onDone(){_onDone()}function _onDone(e){a.prev&&(a.prev.next=a.next),a.next&&(a.next.prev=a.prev),r===a&&(r=a.prev),a.block||n--,o.length--,e&&e(),deque()}deque()}}e.exports={createLock,createLockPool:function(e){const t=new Map;return{read:(e,t)=>op(e,t,"read"),write:(e,t)=>op(e,t,"write"),locks:t};async function op(r,n,o){const a=[],c=[];for(const n of r){let r=t.get(n);r||(r=createLock(e),t.set(n,r));const s={lock:r,scope:n,relase:null};c.push(r[o](e=>{s.release=e})),a.push(s)}let s;await Promise.all(c);try{s=n(n.length&&onDone)}catch(e){throw onDone(),e}return s&&s.then?(n.length||s.then(onDone,onDone),await s):(n.length||onDone(),s);function onDone(){for(const e of a)e.release(()=>{e.lock.length||t.delete(e.scope)});a.length=0}}}}},4:(e,t)=>{"use strict";function percentToByte(e){return String.fromCharCode(parseInt(e.slice(1),16))}function byteToPercent(e){return`%${`00${e.charCodeAt(0).toString(16)}`.slice(-2)}`}Object.defineProperty(t,"__esModule",{value:!0}),t.encode=function(e){return btoa(encodeURIComponent(e).replace(/%[0-9A-F]{2}/g,percentToByte))},t.decode=function(e){return decodeURIComponent(Array.from(atob(e),byteToPercent).join(""))}},814:(e,t,r)=>{"use strict";r.r(t),r.d(t,{RequestError:()=>c,createRequest:()=>createRequest});const{createLock:n}=r(374),o=r(4),{delay:a}=r(423);class c extends Error{constructor(e,t,r=t&&t.status){super(e),this.code=r,this.origin=t,Error.captureStackTrace&&Error.captureStackTrace(this,c)}}function createRequest({fetch:e,cooldown:t=0,getAccessToken:r,username:s,password:i}){const u=n(),l=s||i?`Basic ${o.encode(`${s}:${i}`)}`:null;return e=>u.write(async r=>{try{return await doRequest(e)}finally{t&&e.method&&"GET"!==e.method?setTimeout(r,t):r()}});async function doRequest({path:t,contentType:n,headers:o,format:s,raw:i=!1,...u}){const f={};for(r&&(f.Authorization=`Bearer ${await r()}`),l&&(f.Authorization=l),n&&(f["Content-Type"]=n),Object.assign(f,o);;){const r=await e(t,{headers:f,...u});if(!r.ok){const e=r.headers.get("Retry-After");if(e){const t=Number(e);if(t){await a(1e3*t);continue}}const t=await r.text();throw new c(`failed to fetch [${r.status}]: ${t}`,r)}if(i)return r;if(s)return await r[s]();const n=r.headers.get("Content-Type");return/application\/json/.test(n)?await r.json():await r.text()}}}},423:(e,t,r)=>{"use strict";function debounced(e){let t,r=0;return()=>(r&&clearTimeout(r),r=setTimeout(run),t||(t=defer()),t.promise);function run(){Promise.resolve(e()).then(t.resolve,t.reject),r=0,t=null}function defer(){const e={};return e.promise=new Promise((t,r)=>{e.resolve=t,e.reject=r}),e}}function delay(e){return new Promise(t=>setTimeout(t,e))}r.r(t),r.d(t,{debounced:()=>debounced,delay:()=>delay})},245:(e,t,r)=>{"use strict";function dirname(e){const t=e.replace(/[/\\][^/\\]+[/\\]?$/,"");return t===e?".":t}r.r(t),r.d(t,{dirname:()=>dirname})}},r={};function __webpack_require__(e){var n=r[e];if(void 0!==n)return n.exports;var o=r[e]={exports:{}};return t[e](o,o.exports,__webpack_require__),o.exports}__webpack_require__.d=(e,t)=>{for(var r in t)__webpack_require__.o(t,r)&&!__webpack_require__.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};(()=>{"use strict";__webpack_require__.d(n,{default:()=>webdav});const{dirname:t}=__webpack_require__(245),{createRequest:r}=__webpack_require__(814);function webdav_arrayify(e){return Array.isArray(e)?e:[e]}function webdav_xmlToJSON(e){const t=Array.prototype.filter.call(e.childNodes,e=>1===e.nodeType);if(!t.length)return e.textContent;const r={};for(const e of t){const t=webdav_xmlToJSON(e);if(r[e.localName])if(Array.isArray(r[e.localName]))r[e.localName].push(t);else{const n=[r[e.localName]];n.push(t),r[e.localName]=n}else r[e.localName]=t}return r}const webdav=function({username:n,password:o,url:a,fetch:c=("undefined"!=typeof self?self:e).fetch,DOMParser:s=("undefined"!=typeof self?self:e).DOMParser}){a.endsWith("/")||(a+="/");const i=r({fetch:c,username:n,password:o});return{name:"webdav",get:async function(e){return await requestDAV({method:"GET",path:e,format:"text"})},put:async function(e,r){return await withDir(t(e),()=>requestDAV({method:"PUT",path:e,contentType:"application/octet-stream",body:r}))},post:async function(e,r){try{return await withDir(t(e),()=>requestDAV({method:"PUT",path:e,body:r,contentType:"octet-stream",headers:{"If-None-Match":"*"}}))}catch(e){throw 412===e.code&&(e.code="EEXIST"),e}},delete:async function(e){try{await requestDAV({method:"DELETE",path:e})}catch(e){if(404===e.code)return;throw e}},list:async function(e){e.endsWith("/")||(e+="/");const t=await requestDAV({method:"PROPFIND",path:e,contentType:"application/xml",body:'<?xml version="1.0" encoding="utf-8" ?> \n        <propfind xmlns="DAV:">\n          <allprop/>\n        </propfind>',headers:{Depth:"1"}}),r=[];for(const n of webdav_arrayify(t.multistatus.response)){if(webdav_arrayify(n.propstat).some(e=>e.prop.resourcetype&&void 0!==e.prop.resourcetype.collection))continue;const t=`${a}${e}`,o=new URL(n.href,t).href.slice(t.length);r.push(o)}return r}};async function requestDAV({path:e,...t}){const r=await i({path:`${a}${e}`,...t});if(t.format||"string"!=typeof r||!r)return r;const n=webdav_xmlToJSON((new s).parseFromString(r,"application/xml"));if(n.error)throw new Error(`Failed requesting DAV at ${a}${e}: ${JSON.stringify(n.error)}`);if(n.multistatus){n.multistatus.response=webdav_arrayify(n.multistatus.response);for(const t of n.multistatus.response)if(t.error)throw new Error(`Failed requesting DAV at ${a}${e}: ${t.href} ${t.error}`)}return n}async function withDir(e,r){try{return await r()}catch(t){if(409!==t.code&&404!==t.code||"."===e)throw t}return await withDir(t(e),()=>requestDAV({method:"MKCOL",path:e})),await r()}}})(),self.webdav=n.default})()}