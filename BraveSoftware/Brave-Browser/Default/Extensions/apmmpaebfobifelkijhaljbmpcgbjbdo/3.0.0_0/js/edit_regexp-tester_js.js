(self.webpackChunkStylus=self.webpackChunkStylus||[]).push([["edit_regexp-tester_js"],{2421:(e,t,a)=>{a.r(t),a.d(t,{toggle:()=>toggle}),a(7337);var n=a(6001),o=a(6308),s=a(9204),l=a(1679),r=a(9521),c=a(4523),d=a(9250),p=a(6100);const u=new Map,i=d.default.regexps,observe=(e,t)=>e[t?"on":"off"]("input",update);let f,h,g=!1;function toggle(e=!f){if(e&&!f){if(!g){g=!0,chrome.tabs.onRemoved.addListener(onTabRemoved),chrome.tabs.onUpdated.addListener(onTabUpdated);for(const e of i)observe(e,!0)}f=p.helpPopup.show((0,o.t)("styleRegexpTestTitle")," ",{className:"regexp-report"}),f.onClose.add(()=>toggle(!1)),update()}else!e&&f&&(unwatch(),f._close.click(),f=null)}async function update(){if(!f)return void unwatch();const e=new Map,t=document.activeElement;for(const a of i){const n=a.value,o=e.get(n),s=o||Object.assign({text:n},u.get(n));s.urls||u.set(n,Object.assign(s,{rx:(0,r.tryRegExp)("^"+n+"$"),urls:new Map})),o&&a!==t||(s.el=a),o||e.set(n,s)}const a=(await browser.tabs.query({})).map(e=>e.pendingUrl||e.url).filter(l.supported),s=[...new Set(a).values()];for(const t of e.values()){const{rx:e,urls:a}=t;if(e){const n=new Map;for(const t of s){const o=a.get(t)||(d=t.match(e))&&{text:d[0],pos:d.index};o&&n.set(t,o)}t.urls=n}}var d;const p={full:{data:[],label:(0,o.t)("styleRegexpTestFull")},partial:{data:[],label:[(0,o.t)("styleRegexpTestPartial"),o.template.regexpTestPartial.cloneNode(!0)]},none:{data:[],label:(0,o.t)("styleRegexpTestNone")},invalid:{data:[],label:(0,o.t)("styleRegexpTestInvalid")}};for(const{el:t,text:a,rx:o,urls:s}of e.values()){if(!o){p.invalid.data.push({el:t,text:a});continue}if(!s.size){p.none.data.push({el:t,text:a});continue}const e=[],r=[];for(const[t,a]of s.entries()){const o=t.startsWith(l.ownRoot)?c.MF_ICON:l.favicon(new URL(t).hostname),s=(0,n.$create)("img",{src:o});a.text.length===t.length?e.push((0,n.$create)("a",{tabIndex:0},[s,t])):r.push((0,n.$create)("a",{tabIndex:0},[s,t.substr(0,a.pos),(0,n.$create)("mark",a.text),t.substr(a.pos+a.text.length)]))}e.length&&p.full.data.push({el:t,text:a,urls:e}),r.length&&p.partial.data.push({el:t,text:a,urls:r})}const g=(0,n.$create)("div");for(const e in p){const{label:t,data:a}=p[e];if(!a.length)continue;const o=(0,n.$create)("h3",{"data-num":a.length},t),s=g.appendChild((0,n.$create)("details",{"data-type":e,open:!g.firstChild},(0,n.$create)("summary",o)));for(const{el:e,text:t,urls:o}of a)o?s.appendChild((0,n.$create)("article",[(0,n.$create)("h4",{_source:e},t),...o])):s.appendChild((0,n.$create)("a",{tabIndex:0,_source:e},t))}h||(h=(0,n.$create)("div.regexp-report-note",`${(0,o.t)("styleRegexpTestNoteStar")} ${(0,o.t)("styleRegexpTestNote")}`.split(/(<[^>]+>|\\+)/).map((e,t)=>t%2?(0,n.$create)("code","<"===e[0]?e.slice(1,-1):e):e))),f._contents.firstChild.replaceWith(g),g.onclick=onClick,g.contains(h)||g.append(h)}function onClick(e){let t=e.target;t._source?t._source.focus():(t=t.closest("a"))&&(e.preventDefault(),s.API.openURL({url:t.href||t.textContent,currentWindow:null}))}function onTabRemoved(){update()}function onTabUpdated(e,t){t.url&&update()}function unwatch(){if(g){chrome.tabs.onRemoved.removeListener(onTabRemoved),chrome.tabs.onUpdated.removeListener(onTabUpdated);for(const e of i)observe(e,!1);g=!1}}["add","delete"].forEach((e,t)=>{const a=i[e];i[e]=e=>{const n=a.call(i,e);return g&&(observe(e,!t),update()),n}})}}]);