{const e=this;(self.webpackChunkStylus=self.webpackChunkStylus||[]).push([["js_dlg_config-dialog_js"],{7262:(t,a,n)=>{n.r(a),n.d(a,{default:()=>configDialog});var o=n(6001),s=n(9030),i=n(6308),l=n(9204),c=n(2691),u=n(9521),r=n(4435),p=n(1679);async function configDialog(t){let a,d=!1;const f=t.usercssData,g=(0,u.deepCopy)(f.vars)||{},h=Object.keys(g),v=h.map(e=>g[e]);let m=getInitialValues(g);const y=[],b=location.pathname.slice(1),C=b===p.installUsercss,$="popup.html"===b,x=v.some(e=>"color"===e.type)?(await Promise.all([n.e("js_color_color-picker_js"),n.e("js_color_color-picker_css")]).then(n.bind(n,9209))).default():null,k={};return function(){let e=(0,o.$create)("a.config-reset-icon",{tabIndex:0,title:(0,i.t)("genericResetLabel")},(0,o.$create)("i.i-close"));for(const t of v){let a;switch(t.type){case"color":a=[(0,o.$create)(".colorview-swatch.config-value",[t.input=(0,o.$create)("a.color-swatch",{va:t,tabIndex:0,onclick:showColorpicker})])];break;case"checkbox":a=[t.input=(0,o.$create)("input.slider.config-value",{va:t,type:"checkbox",onchange:updateVarOnChange})];break;case"select":case"dropdown":case"image":a=[(0,o.$create)(".select-wrapper.config-value",[t.input=(0,o.$create)("select",{va:t,onchange:updateVarOnChange},t.options.map(e=>(0,o.$create)("option",{value:e.name},e.label)))])];break;case"range":case"number":{const e={va:t,type:t.type,onfocus:"number"===t.type?selectAllOnFocus:null,onblur:"number"===t.type?updateVarOnBlur:null,onchange:updateVarOnChange,oninput:updateVarOnChange,required:!0};"number"==typeof t.min&&(e.min=t.min),"number"==typeof t.max&&(e.max=t.max),"number"==typeof t.step&&isFinite(t.step)&&(e.step=t.step),a=["range"===t.type&&(0,o.$create)("span.current-value"),t.input=(0,o.$create)("input.config-value",e)];break}default:a=[t.input=(0,o.$create)("input.config-value",{va:t,type:t.type,onchange:updateVarOnChange,oninput:updateVarOnChange,onfocus:selectAllOnFocus})]}e=e.cloneNode(!0),e.va=t,e.onclick=resetOnClick,y.push((0,o.$create)(`label.config-${t.type}`,[(0,o.$create)("span.config-name",(0,i.breakWord)(t.label)),...a,e])),t.savedValue=t.value}}(),renderValues(),v.forEach(renderValueState),s.messageBox.show({title:`${t.customName||t.name} v${f.version}`,className:"config-dialog",contents:[(0,o.$create)(".config-heading",f.supportURL&&(0,o.$createLink)({className:".external-support",href:f.supportURL},(0,i.t)("externalFeedback"))),(0,o.$create)(".config-body",y)],buttons:[{textContent:(0,i.t)("confirmSave"),"data-cmd":"save",disabled:!0,onclick:save},{textContent:(0,i.t)("genericResetLabel"),title:(0,i.t)("optionsReset"),"data-cmd":"default",onclick:function(){for(const e of v)e.value=null,onchange({target:e.input});renderValues()}},{textContent:(0,i.t)("confirmClose"),"data-cmd":"close"}],onshow:function(e){var t;(0,o.$)("#message-box-buttons button").after((0,o.$create)("label#config-autosave-wrapper",{title:(0,i.t)("configOnChangeTooltip")},[(0,o.$create)("input",{id:"config.autosave",type:"checkbox"}),(0,i.t)("configOnChange")])),(0,s.setupLivePrefs)(["config.autosave"]),e.style.setProperty("--num",v.length),$&&!r.MOBILE&&adjustSizeForPopup(e),e.on("change",onchange),k.save=(0,o.$)('[data-cmd="save"]',e),k.default=(0,o.$)('[data-cmd="default"]',e),k.close=(0,o.$)('[data-cmd="close"]',e),updateButtons(),(t=(0,o.$)("#message-box-contents")).classList.toggle("sb-overlay",t.offsetWidth===t.clientWidth&&t.scrollHeight>t.clientHeight)}}).then(onhide);function getInitialValues(e){const t={};for(const a of h){const n=e[a];t[a]=isDefault(n)?n.default:n.value}return t}function onhide(){null!=a&&(document.body.style.cssText=a),x?.hide()}function onchange({target:e,justSaved:t=!1}){const a=e.va;if(a){if(a.dirty=m[a.name]!==(isDefault(a)?a.default:a.value),c.get("config.autosave")&&!t)return void(0,u.debounce)(save,400,{anyChangeIsDirty:!0});renderValueState(a),t||updateButtons()}}function updateButtons(){const e=v.some(e=>e.dirty);k.save.disabled=!e,k.default.disabled=v.every(isDefault),k.close.textContent=(0,i.t)(e?"confirmCancel":"confirmClose")}async function save({anyChangeIsDirty:e=!1}={}){for(let e=1;d&&e<1e3;e*=2)await(0,u.sleep)(e);if(d)throw"Could not save: still saving previous results...";if(!v.some(t=>t.dirty||e&&t.value!==t.savedValue))return;const a=!C&&await l.API.styles.get(t.id).catch(()=>({}));(t=t.sections?Object.assign({},t):t).enabled=!0,t.sourceCode=null,t.sections=null;const n=t.usercssData.vars,c=C?n:a.usercssData?.vars||{},r=[];let p=0;for(const t of v){const a=c[t.name];let s;if(a)if(a.type!==t.type)s=["type ","*"+t.type," != ","*"+a.type];else{if("select"!==t.type&&"dropdown"!==t.type||isDefault(t)||!a.options.every(e=>e.name!==t.value)){if(t.dirty||e&&t.value!==t.savedValue){n[t.name].value=t.value,t.savedValue=t.value,p++;continue}continue}s=`'${t.value}' not in the updated '${t.type}' list`}else s="deleted",delete n[t.name];r.push(["*"+t.name,": ",...s].map(e=>"*"===e[0]&&(0,o.$create)("b",e.slice(1))||e)),a&&(n[t.name].value=(0,u.deepCopy)(a))}if(r.length&&(onhide(),s.messageBox.alert([(0,o.$create)("div",{style:"max-width: 34em"},(0,i.t)("usercssConfigIncomplete")),(0,o.$create)("ol",{style:"text-align: left"},r.map(e=>(0,o.$create)({tag:"li"},e)))],"pre")),p){d=!0;try{const e=C?n:await l.API.usercss.configVars(t.id,n);m=getInitialValues(e),v.forEach(e=>onchange({target:e.input,justSaved:!0})),renderValues(),updateButtons(),(0,o.$remove)(".config-error")}catch(e){const t=(0,o.$)(".config-error",s.messageBox.element)||(0,o.$)("#message-box-buttons").insertAdjacentElement("afterbegin",(0,o.$create)(".config-error"));t.textContent=t.title=(Array.isArray(e)?e:[e]).map(e=>e.stack||e.message||`${e}`).join("\n")}d=!1}}function isDefault(e){return null===e.value||void 0===e.value||e.value===e.default}function updateVarOnBlur(){this.value=isDefault(this.va)?this.va.default:this.va.value}function updateVarOnChange(e){let t;if("text"===this.type)t=this.value;else if("range"===this.type)t=this.valueAsNumber,updateRangeCurrentValue(this.va,this.value);else{if("number"!==this.type)return void(this.va.value="checkbox"!==this.type?this.value:this.checked?"1":"0");if(!this.reportValidity())return;t=this.valueAsNumber}Number.isNaN(t)||(this.va.value=t,"input"===e.type&&onchange(e))}function updateRangeCurrentValue(e,t){const a=(0,o.$)(".current-value",e.input.closest(".config-range"));a&&(a.textContent=t+(e.units||""))}function selectAllOnFocus(){this.select()}function renderValues(e=v){for(const t of e){if(t.input===document.activeElement)continue;const e=isDefault(t)?t.default:t.value;"color"===t.type?(t.input.style.backgroundColor=e,x.options.va===t&&x.setColor(e)):"checkbox"===t.type?t.input.checked=Number(e):"range"===t.type?(t.input.value=e,updateRangeCurrentValue(t,t.input.value)):t.input.value=e,c.get("config.autosave")||renderValueState(t)}}function renderValueState(e){const t=e.input.closest("label");t.classList.toggle("dirty",Boolean(e.dirty)),t.classList.toggle("nondefault",!isDefault(e)),(0,o.$)(".config-reset-icon",t).disabled=isDefault(e)}function resetOnClick(e){e.preventDefault(),this.va.value=null,renderValues([this.va]),onchange({target:this.va.input})}function showColorpicker(t){t.preventDefault(),e.off("keydown",s.messageBox.listeners.key,!0);const a=(0,o.$)("#message-box-contents"),n=this.getBoundingClientRect();x.show({va:this.va,color:this.va.value||this.va.default,top:Math.min(n.bottom,innerHeight-220),right:innerWidth-n.left-10,guessBrightness:a,callback:onColorChanged})}function onColorChanged(e){e&&(this.va.value=e,this.va.input.style.backgroundColor=e,this.va.input.dispatchEvent(new Event("change",{bubbles:!0}))),(0,u.debounce)(restoreEscInDialog)}function restoreEscInDialog(){!(0,o.$)(".colorpicker-popup")&&s.messageBox.element&&e.on("keydown",s.messageBox.listeners.key,!0)}function adjustSizeForPopup(e){const t=e.firstElementChild;t.style=(0,s.important)("max-width: none; max-height: none;");let{offsetWidth:n,offsetHeight:i}=t;t.style="";const l=devicePixelRatio,c=document.body.appendChild((0,o.$create)(".colorpicker-popup",{style:"display: none!important"})),r=50/l,p=parseFloat(getComputedStyle(c).width)||350/l,d=250/l+r;c.remove();const f=document.body.style;n=(0,u.clamp)(n+r,p,798/l),i=(0,u.clamp)(i+r,d,parseInt(f.maxHeight)||598/l),a=f.cssText,f.cssText=a.replace(/((min|max)-width|min-height)\s*:[^;]+|;\s*$/g,"")+`;\n      min-width:${n}px !important;\n      min-height:${i}px !important;`}}}}])}